{"version":3,"sources":["../../../src/common/guards/jwt-auth.guard.ts"],"sourcesContent":["import {\r\n    Injectable,\r\n    CanActivate,\r\n    ExecutionContext,\r\n    UnauthorizedException,\r\n} from '@nestjs/common';\r\nimport { Reflector } from '@nestjs/core';\r\nimport { JwtService } from '@nestjs/jwt';\r\nimport { ConfigService } from '@nestjs/config';\r\nimport { IS_PUBLIC_KEY } from '../decorators';\r\n\r\n@Injectable()\r\nexport class JwtAuthGuard implements CanActivate {\r\n    constructor(\r\n        private reflector: Reflector,\r\n        private jwtService: JwtService,\r\n        private configService: ConfigService,\r\n    ) { }\r\n\r\n    async canActivate(context: ExecutionContext): Promise<boolean> {\r\n        // Check if route is public\r\n        const isPublic = this.reflector.getAllAndOverride<boolean>(IS_PUBLIC_KEY, [\r\n            context.getHandler(),\r\n            context.getClass(),\r\n        ]);\r\n\r\n        if (isPublic) {\r\n            return true;\r\n        }\r\n\r\n        const request = context.switchToHttp().getRequest();\r\n        const token = this.extractTokenFromHeader(request);\r\n\r\n        if (!token) {\r\n            throw new UnauthorizedException('Access token is required');\r\n        }\r\n\r\n        try {\r\n            const payload = await this.jwtService.verifyAsync(token, {\r\n                secret: this.configService.get<string>('JWT_SECRET'),\r\n            });\r\n\r\n            // Attach user to request\r\n            request.user = payload;\r\n        } catch (error) {\r\n            throw new UnauthorizedException('Invalid or expired token');\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    private extractTokenFromHeader(request: any): string | undefined {\r\n        const [type, token] = request.headers.authorization?.split(' ') ?? [];\r\n        return type === 'Bearer' ? token : undefined;\r\n    }\r\n}\r\n"],"names":["JwtAuthGuard","canActivate","context","isPublic","reflector","getAllAndOverride","IS_PUBLIC_KEY","getHandler","getClass","request","switchToHttp","getRequest","token","extractTokenFromHeader","UnauthorizedException","payload","jwtService","verifyAsync","secret","configService","get","user","error","type","headers","authorization","split","undefined"],"mappings":";;;;+BAYaA;;;eAAAA;;;wBAPN;sBACmB;qBACC;wBACG;4BACA;;;;;;;;;;AAGvB,IAAA,AAAMA,eAAN,MAAMA;IAOT,MAAMC,YAAYC,OAAyB,EAAoB;QAC3D,2BAA2B;QAC3B,MAAMC,WAAW,IAAI,CAACC,SAAS,CAACC,iBAAiB,CAAUC,yBAAa,EAAE;YACtEJ,QAAQK,UAAU;YAClBL,QAAQM,QAAQ;SACnB;QAED,IAAIL,UAAU;YACV,OAAO;QACX;QAEA,MAAMM,UAAUP,QAAQQ,YAAY,GAAGC,UAAU;QACjD,MAAMC,QAAQ,IAAI,CAACC,sBAAsB,CAACJ;QAE1C,IAAI,CAACG,OAAO;YACR,MAAM,IAAIE,6BAAqB,CAAC;QACpC;QAEA,IAAI;YACA,MAAMC,UAAU,MAAM,IAAI,CAACC,UAAU,CAACC,WAAW,CAACL,OAAO;gBACrDM,QAAQ,IAAI,CAACC,aAAa,CAACC,GAAG,CAAS;YAC3C;YAEA,yBAAyB;YACzBX,QAAQY,IAAI,GAAGN;QACnB,EAAE,OAAOO,OAAO;YACZ,MAAM,IAAIR,6BAAqB,CAAC;QACpC;QAEA,OAAO;IACX;IAEQD,uBAAuBJ,OAAY,EAAsB;QAC7D,MAAM,CAACc,MAAMX,MAAM,GAAGH,QAAQe,OAAO,CAACC,aAAa,EAAEC,MAAM,QAAQ,EAAE;QACrE,OAAOH,SAAS,WAAWX,QAAQe;IACvC;IAzCA,YACI,AAAQvB,SAAoB,EAC5B,AAAQY,UAAsB,EAC9B,AAAQG,aAA4B,CACtC;aAHUf,YAAAA;aACAY,aAAAA;aACAG,gBAAAA;IACR;AAsCR"}