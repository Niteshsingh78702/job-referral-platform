{"version":3,"sources":["../../../src/common/guards/roles.guard.ts"],"sourcesContent":["import {\r\n  Injectable,\r\n  CanActivate,\r\n  ExecutionContext,\r\n  ForbiddenException,\r\n} from '@nestjs/common';\r\nimport { Reflector } from '@nestjs/core';\r\nimport { ROLES_KEY } from '../decorators';\r\nimport { UserRole } from '../constants';\r\n\r\n@Injectable()\r\nexport class RolesGuard implements CanActivate {\r\n  constructor(private reflector: Reflector) {}\r\n\r\n  canActivate(context: ExecutionContext): boolean {\r\n    const requiredRoles = this.reflector.getAllAndOverride<UserRole[]>(\r\n      ROLES_KEY,\r\n      [context.getHandler(), context.getClass()],\r\n    );\r\n\r\n    if (!requiredRoles || requiredRoles.length === 0) {\r\n      return true;\r\n    }\r\n\r\n    const { user } = context.switchToHttp().getRequest();\r\n\r\n    if (!user) {\r\n      throw new ForbiddenException('User not authenticated');\r\n    }\r\n\r\n    const hasRole = requiredRoles.some((role) => user.role === role);\r\n\r\n    if (!hasRole) {\r\n      throw new ForbiddenException(\r\n        `Access denied. Required roles: ${requiredRoles.join(', ')}`,\r\n      );\r\n    }\r\n\r\n    return true;\r\n  }\r\n}\r\n"],"names":["RolesGuard","canActivate","context","requiredRoles","reflector","getAllAndOverride","ROLES_KEY","getHandler","getClass","length","user","switchToHttp","getRequest","ForbiddenException","hasRole","some","role","join"],"mappings":";;;;+BAWaA;;;eAAAA;;;wBANN;sBACmB;4BACA;;;;;;;;;;AAInB,IAAA,AAAMA,aAAN,MAAMA;IAGXC,YAAYC,OAAyB,EAAW;QAC9C,MAAMC,gBAAgB,IAAI,CAACC,SAAS,CAACC,iBAAiB,CACpDC,qBAAS,EACT;YAACJ,QAAQK,UAAU;YAAIL,QAAQM,QAAQ;SAAG;QAG5C,IAAI,CAACL,iBAAiBA,cAAcM,MAAM,KAAK,GAAG;YAChD,OAAO;QACT;QAEA,MAAM,EAAEC,IAAI,EAAE,GAAGR,QAAQS,YAAY,GAAGC,UAAU;QAElD,IAAI,CAACF,MAAM;YACT,MAAM,IAAIG,0BAAkB,CAAC;QAC/B;QAEA,MAAMC,UAAUX,cAAcY,IAAI,CAAC,CAACC,OAASN,KAAKM,IAAI,KAAKA;QAE3D,IAAI,CAACF,SAAS;YACZ,MAAM,IAAID,0BAAkB,CAC1B,CAAC,+BAA+B,EAAEV,cAAcc,IAAI,CAAC,OAAO;QAEhE;QAEA,OAAO;IACT;IA3BA,YAAY,AAAQb,SAAoB,CAAE;aAAtBA,YAAAA;IAAuB;AA4B7C"}