{"version":3,"sources":["../../../src/common/validators/email-domain.validator.ts"],"sourcesContent":["import {\r\n    registerDecorator,\r\n    ValidationOptions,\r\n    ValidationArguments,\r\n} from 'class-validator';\r\n\r\n/**\r\n * Common email domain typos and their corrections\r\n */\r\nconst DOMAIN_TYPOS: Record<string, string> = {\r\n    // Gmail typos\r\n    'gmai.com': 'gmail.com',\r\n    'gmial.com': 'gmail.com',\r\n    'gamil.com': 'gmail.com',\r\n    'gmal.com': 'gmail.com',\r\n    'gmil.com': 'gmail.com',\r\n    'gmail.co': 'gmail.com',\r\n    'gmail.cm': 'gmail.com',\r\n    'gmailcom': 'gmail.com',\r\n    'gmaill.com': 'gmail.com',\r\n    'gmail.con': 'gmail.com',\r\n    'gmail.om': 'gmail.com',\r\n    'gnail.com': 'gmail.com',\r\n    'gmsil.com': 'gmail.com',\r\n    'gmqil.com': 'gmail.com',\r\n    // Yahoo typos\r\n    'yaho.com': 'yahoo.com',\r\n    'yahooo.com': 'yahoo.com',\r\n    'yahoo.co': 'yahoo.com',\r\n    'yahoo.cm': 'yahoo.com',\r\n    'yhaoo.com': 'yahoo.com',\r\n    'yaoo.com': 'yahoo.com',\r\n    // Hotmail typos\r\n    'hotmal.com': 'hotmail.com',\r\n    'hotmai.com': 'hotmail.com',\r\n    'hotmial.com': 'hotmail.com',\r\n    'hotmail.co': 'hotmail.com',\r\n    'hotmail.cm': 'hotmail.com',\r\n    'hotamil.com': 'hotmail.com',\r\n    'htmail.com': 'hotmail.com',\r\n    // Outlook typos\r\n    'outlok.com': 'outlook.com',\r\n    'outloo.com': 'outlook.com',\r\n    'outlook.co': 'outlook.com',\r\n    'outlook.cm': 'outlook.com',\r\n    'outlool.com': 'outlook.com',\r\n    'outllook.com': 'outlook.com',\r\n    // Rediffmail typos (common in India)\r\n    'rediff.com': 'rediffmail.com',\r\n    'redifmail.com': 'rediffmail.com',\r\n    'redifffmail.com': 'rediffmail.com',\r\n};\r\n\r\n/**\r\n * Extracts domain from email address\r\n */\r\nfunction getEmailDomain(email: string): string {\r\n    const parts = email.toLowerCase().split('@');\r\n    return parts.length === 2 ? parts[1] : '';\r\n}\r\n\r\n/**\r\n * Custom decorator to validate email domains and catch common typos\r\n */\r\nexport function IsValidEmailDomain(validationOptions?: ValidationOptions) {\r\n    return function (object: Object, propertyName: string) {\r\n        registerDecorator({\r\n            name: 'isValidEmailDomain',\r\n            target: object.constructor,\r\n            propertyName: propertyName,\r\n            options: validationOptions,\r\n            validator: {\r\n                validate(value: any, args: ValidationArguments) {\r\n                    if (typeof value !== 'string') return false;\r\n\r\n                    const domain = getEmailDomain(value);\r\n                    if (!domain) return false;\r\n\r\n                    // Check if domain is a known typo\r\n                    const correction = DOMAIN_TYPOS[domain];\r\n                    if (correction) {\r\n                        return false; // Fail validation for typos\r\n                    }\r\n\r\n                    return true;\r\n                },\r\n                defaultMessage(args: ValidationArguments) {\r\n                    if (typeof args.value !== 'string') {\r\n                        return 'Please enter a valid email address';\r\n                    }\r\n\r\n                    const domain = getEmailDomain(args.value);\r\n                    const correction = DOMAIN_TYPOS[domain];\r\n\r\n                    if (correction) {\r\n                        return `Did you mean @${correction}? The domain \"@${domain}\" appears to be a typo.`;\r\n                    }\r\n\r\n                    return 'Please enter a valid email address';\r\n                },\r\n            },\r\n        });\r\n    };\r\n}\r\n"],"names":["IsValidEmailDomain","DOMAIN_TYPOS","getEmailDomain","email","parts","toLowerCase","split","length","validationOptions","object","propertyName","registerDecorator","name","target","options","validator","validate","value","args","domain","correction","defaultMessage"],"mappings":";;;;+BAgEgBA;;;eAAAA;;;gCA5DT;AAEP;;CAEC,GACD,MAAMC,eAAuC;IACzC,cAAc;IACd,YAAY;IACZ,aAAa;IACb,aAAa;IACb,YAAY;IACZ,YAAY;IACZ,YAAY;IACZ,YAAY;IACZ,YAAY;IACZ,cAAc;IACd,aAAa;IACb,YAAY;IACZ,aAAa;IACb,aAAa;IACb,aAAa;IACb,cAAc;IACd,YAAY;IACZ,cAAc;IACd,YAAY;IACZ,YAAY;IACZ,aAAa;IACb,YAAY;IACZ,gBAAgB;IAChB,cAAc;IACd,cAAc;IACd,eAAe;IACf,cAAc;IACd,cAAc;IACd,eAAe;IACf,cAAc;IACd,gBAAgB;IAChB,cAAc;IACd,cAAc;IACd,cAAc;IACd,cAAc;IACd,eAAe;IACf,gBAAgB;IAChB,qCAAqC;IACrC,cAAc;IACd,iBAAiB;IACjB,mBAAmB;AACvB;AAEA;;CAEC,GACD,SAASC,eAAeC,KAAa;IACjC,MAAMC,QAAQD,MAAME,WAAW,GAAGC,KAAK,CAAC;IACxC,OAAOF,MAAMG,MAAM,KAAK,IAAIH,KAAK,CAAC,EAAE,GAAG;AAC3C;AAKO,SAASJ,mBAAmBQ,iBAAqC;IACpE,OAAO,SAAUC,MAAc,EAAEC,YAAoB;QACjDC,IAAAA,iCAAiB,EAAC;YACdC,MAAM;YACNC,QAAQJ,OAAO,WAAW;YAC1BC,cAAcA;YACdI,SAASN;YACTO,WAAW;gBACPC,UAASC,KAAU,EAAEC,IAAyB;oBAC1C,IAAI,OAAOD,UAAU,UAAU,OAAO;oBAEtC,MAAME,SAASjB,eAAee;oBAC9B,IAAI,CAACE,QAAQ,OAAO;oBAEpB,kCAAkC;oBAClC,MAAMC,aAAanB,YAAY,CAACkB,OAAO;oBACvC,IAAIC,YAAY;wBACZ,OAAO,OAAO,4BAA4B;oBAC9C;oBAEA,OAAO;gBACX;gBACAC,gBAAeH,IAAyB;oBACpC,IAAI,OAAOA,KAAKD,KAAK,KAAK,UAAU;wBAChC,OAAO;oBACX;oBAEA,MAAME,SAASjB,eAAegB,KAAKD,KAAK;oBACxC,MAAMG,aAAanB,YAAY,CAACkB,OAAO;oBAEvC,IAAIC,YAAY;wBACZ,OAAO,CAAC,cAAc,EAAEA,WAAW,eAAe,EAAED,OAAO,uBAAuB,CAAC;oBACvF;oBAEA,OAAO;gBACX;YACJ;QACJ;IACJ;AACJ"}