{"version":3,"sources":["../../../src/modules/admin/admin.service.ts"],"sourcesContent":["import {\r\n  Injectable,\r\n  NotFoundException,\r\n  BadRequestException,\r\n} from '@nestjs/common';\r\nimport * as crypto from 'crypto';\r\nimport { PrismaService } from '../../prisma/prisma.service';\r\nimport {\r\n  UserStatus,\r\n  UserRole,\r\n  JobStatus,\r\n  HRApprovalStatus,\r\n  RefundStatus,\r\n  PaymentStatus,\r\n  AuditAction,\r\n} from '../../common/constants';\r\n\r\n@Injectable()\r\nexport class AdminService {\r\n  constructor(private prisma: PrismaService) { }\r\n\r\n  // ===========================================\r\n  // DASHBOARD\r\n  // ===========================================\r\n\r\n  async getDashboardMetrics() {\r\n    const [\r\n      totalUsers,\r\n      totalCandidates,\r\n      totalHRs,\r\n      totalEmployees,\r\n      totalJobs,\r\n      activeJobs,\r\n      totalPayments,\r\n      totalRevenue,\r\n      pendingRefunds,\r\n      todayApplications,\r\n    ] = await Promise.all([\r\n      this.prisma.user.count(),\r\n      this.prisma.user.count({ where: { role: UserRole.CANDIDATE } }),\r\n      this.prisma.user.count({ where: { role: UserRole.HR } }),\r\n      this.prisma.user.count({ where: { role: UserRole.EMPLOYEE } }),\r\n      this.prisma.job.count(),\r\n      this.prisma.job.count({ where: { status: JobStatus.ACTIVE } }),\r\n      this.prisma.payment.count({ where: { status: PaymentStatus.SUCCESS } }),\r\n      this.prisma.payment.aggregate({\r\n        where: { status: PaymentStatus.SUCCESS },\r\n        _sum: { amount: true },\r\n      }),\r\n      this.prisma.refund.count({ where: { status: RefundStatus.REQUESTED } }),\r\n      this.prisma.jobApplication.count({\r\n        where: {\r\n          createdAt: { gte: new Date(new Date().setHours(0, 0, 0, 0)) },\r\n        },\r\n      }),\r\n    ]);\r\n\r\n    return {\r\n      users: {\r\n        total: totalUsers,\r\n        candidates: totalCandidates,\r\n        hrs: totalHRs,\r\n        employees: totalEmployees,\r\n      },\r\n      jobs: {\r\n        total: totalJobs,\r\n        active: activeJobs,\r\n      },\r\n      revenue: {\r\n        totalPayments,\r\n        totalAmount: totalRevenue._sum.amount || 0,\r\n        pendingRefunds,\r\n      },\r\n      activity: {\r\n        todayApplications,\r\n      },\r\n    };\r\n  }\r\n\r\n  // ===========================================\r\n  // USER MANAGEMENT\r\n  // ===========================================\r\n\r\n  async getAllUsers(\r\n    page = 1,\r\n    limit = 20,\r\n    role?: UserRole,\r\n    status?: UserStatus,\r\n  ) {\r\n    const where: any = {};\r\n    if (role) where.role = role;\r\n    if (status) where.status = status;\r\n\r\n    const skip = (page - 1) * limit;\r\n\r\n    const [users, total] = await Promise.all([\r\n      this.prisma.user.findMany({\r\n        where,\r\n        skip,\r\n        take: limit,\r\n        include: {\r\n          Candidate: { select: { firstName: true, lastName: true } },\r\n          HR: { select: { companyName: true, approvalStatus: true } },\r\n          Employee: { select: { companyName: true, referralCount: true } },\r\n        },\r\n        orderBy: { createdAt: 'desc' },\r\n      }),\r\n      this.prisma.user.count({ where }),\r\n    ]);\r\n\r\n    return {\r\n      data: users,\r\n      meta: { page, limit, total, totalPages: Math.ceil(total / limit) },\r\n    };\r\n  }\r\n\r\n  async blockUser(userId: string, adminId: string) {\r\n    const user = await this.prisma.user.findUnique({ where: { id: userId } });\r\n    if (!user) throw new NotFoundException('User not found');\r\n\r\n    await this.prisma.$transaction(async (tx) => {\r\n      await tx.user.update({\r\n        where: { id: userId },\r\n        data: { status: UserStatus.BLOCKED },\r\n      });\r\n\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: adminId,\r\n          action: AuditAction.ADMIN_OVERRIDE,\r\n          entityType: 'User',\r\n          entityId: userId,\r\n          metadata: { action: 'block' },\r\n        },\r\n      });\r\n    });\r\n\r\n    return { success: true, message: 'User blocked' };\r\n  }\r\n\r\n  async unblockUser(userId: string, adminId: string) {\r\n    const user = await this.prisma.user.findUnique({ where: { id: userId } });\r\n    if (!user) throw new NotFoundException('User not found');\r\n\r\n    await this.prisma.$transaction(async (tx) => {\r\n      await tx.user.update({\r\n        where: { id: userId },\r\n        data: { status: UserStatus.ACTIVE },\r\n      });\r\n\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: adminId,\r\n          action: AuditAction.ADMIN_OVERRIDE,\r\n          entityType: 'User',\r\n          entityId: userId,\r\n          metadata: { action: 'unblock' },\r\n        },\r\n      });\r\n    });\r\n\r\n    return { success: true, message: 'User unblocked' };\r\n  }\r\n\r\n  // ===========================================\r\n  // HR APPROVAL\r\n  // ===========================================\r\n\r\n  async getPendingHRApprovals() {\r\n    return this.prisma.hR.findMany({\r\n      where: { approvalStatus: HRApprovalStatus.PENDING },\r\n      include: {\r\n        User: { select: { email: true, createdAt: true } },\r\n      },\r\n      orderBy: { createdAt: 'asc' },\r\n    });\r\n  }\r\n\r\n  async approveHR(hrId: string, adminId: string) {\r\n    const hr = await this.prisma.hR.findUnique({ where: { id: hrId } });\r\n    if (!hr) throw new NotFoundException('HR not found');\r\n\r\n    await this.prisma.$transaction(async (tx) => {\r\n      await tx.hR.update({\r\n        where: { id: hrId },\r\n        data: {\r\n          approvalStatus: HRApprovalStatus.APPROVED,\r\n          approvedBy: adminId,\r\n          approvedAt: new Date(),\r\n        },\r\n      });\r\n\r\n      await tx.user.update({\r\n        where: { id: hr.userId },\r\n        data: { status: UserStatus.ACTIVE },\r\n      });\r\n\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: adminId,\r\n          action: AuditAction.ADMIN_OVERRIDE,\r\n          entityType: 'HR',\r\n          entityId: hrId,\r\n          metadata: { action: 'approve' },\r\n        },\r\n      });\r\n    });\r\n\r\n    return { success: true, message: 'HR approved' };\r\n  }\r\n\r\n  async rejectHR(hrId: string, adminId: string, reason: string) {\r\n    const hr = await this.prisma.hR.findUnique({ where: { id: hrId } });\r\n    if (!hr) throw new NotFoundException('HR not found');\r\n\r\n    await this.prisma.$transaction(async (tx) => {\r\n      await tx.hR.update({\r\n        where: { id: hrId },\r\n        data: {\r\n          approvalStatus: HRApprovalStatus.REJECTED,\r\n          rejectionReason: reason,\r\n        },\r\n      });\r\n\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: adminId,\r\n          action: AuditAction.ADMIN_OVERRIDE,\r\n          entityType: 'HR',\r\n          entityId: hrId,\r\n          metadata: { action: 'reject', reason },\r\n        },\r\n      });\r\n    });\r\n\r\n    return { success: true, message: 'HR rejected' };\r\n  }\r\n\r\n  // ===========================================\r\n  // JOB MANAGEMENT\r\n  // ===========================================\r\n\r\n  async getAllJobs(page = 1, limit = 20, status?: JobStatus) {\r\n    const where: any = {};\r\n    if (status) where.status = status;\r\n\r\n    const skip = (page - 1) * limit;\r\n\r\n    const [jobs, total] = await Promise.all([\r\n      this.prisma.job.findMany({\r\n        where,\r\n        skip,\r\n        take: limit,\r\n        include: {\r\n          HR: { select: { companyName: true } },\r\n          _count: { select: { JobApplication: true } },\r\n        },\r\n        orderBy: { createdAt: 'desc' },\r\n      }),\r\n      this.prisma.job.count({ where }),\r\n    ]);\r\n\r\n    return {\r\n      data: jobs,\r\n      meta: { page, limit, total, totalPages: Math.ceil(total / limit) },\r\n    };\r\n  }\r\n\r\n  async approveJob(jobId: string, adminId: string) {\r\n    await this.prisma.$transaction(async (tx) => {\r\n      await tx.job.update({\r\n        where: { id: jobId },\r\n        data: {\r\n          status: JobStatus.ACTIVE,\r\n          postedAt: new Date(),\r\n          expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days\r\n        },\r\n      });\r\n\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: adminId,\r\n          action: AuditAction.ADMIN_OVERRIDE,\r\n          entityType: 'Job',\r\n          entityId: jobId,\r\n          metadata: { action: 'approve' },\r\n        },\r\n      });\r\n    });\r\n\r\n    return { success: true, message: 'Job approved' };\r\n  }\r\n\r\n  async expireJob(jobId: string, adminId: string) {\r\n    await this.prisma.$transaction(async (tx) => {\r\n      await tx.job.update({\r\n        where: { id: jobId },\r\n        data: { status: JobStatus.EXPIRED },\r\n      });\r\n\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: adminId,\r\n          action: AuditAction.ADMIN_OVERRIDE,\r\n          entityType: 'Job',\r\n          entityId: jobId,\r\n          metadata: { action: 'expire' },\r\n        },\r\n      });\r\n    });\r\n\r\n    return { success: true, message: 'Job expired' };\r\n  }\r\n\r\n  async createJob(jobData: any, adminId: string) {\r\n    // Generate slug from title\r\n    const baseSlug = (jobData.title || 'job')\r\n      .toLowerCase()\r\n      .replace(/[^a-z0-9]+/g, '-')\r\n      .replace(/^-|-$/g, '');\r\n    const randomSuffix = Math.random().toString(36).substring(2, 8);\r\n    const slug = `${baseSlug}-${randomSuffix}`;\r\n\r\n    const newJob = await this.prisma.job.create({\r\n      data: {\r\n        id: crypto.randomUUID(),\r\n        slug,\r\n        title: jobData.title,\r\n        description: jobData.description || '',\r\n        companyName: jobData.companyName,\r\n        location: jobData.location,\r\n        salaryMin: jobData.salaryMin,\r\n        salaryMax: jobData.salaryMax,\r\n        experienceMin: jobData.experienceMin || 0,\r\n        experienceMax: jobData.experienceMax,\r\n        referralFee: jobData.referralFee || 499,\r\n        status: JobStatus.ACTIVE,\r\n        postedAt: new Date(),\r\n        expiresAt: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000), // 30 days\r\n        updatedAt: new Date(),\r\n        // hrId is optional for admin-created jobs\r\n      },\r\n    });\r\n\r\n    await this.prisma.auditLog.create({\r\n      data: {\r\n        id: crypto.randomUUID(),\r\n        userId: adminId,\r\n        action: AuditAction.ADMIN_OVERRIDE,\r\n        entityType: 'Job',\r\n        entityId: newJob.id,\r\n        metadata: { action: 'create', jobData },\r\n      },\r\n    });\r\n\r\n    return { success: true, message: 'Job created successfully', data: newJob };\r\n  }\r\n\r\n  async updateJob(jobId: string, jobData: any, adminId: string) {\r\n    const job = await this.prisma.job.findUnique({ where: { id: jobId } });\r\n    if (!job) throw new NotFoundException('Job not found');\r\n\r\n    const updatedJob = await this.prisma.job.update({\r\n      where: { id: jobId },\r\n      data: jobData,\r\n    });\r\n\r\n    await this.prisma.auditLog.create({\r\n      data: {\r\n        id: crypto.randomUUID(),\r\n        userId: adminId,\r\n        action: AuditAction.ADMIN_OVERRIDE,\r\n        entityType: 'Job',\r\n        entityId: jobId,\r\n        metadata: { action: 'update', changes: jobData },\r\n      },\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: 'Job updated successfully',\r\n      data: updatedJob,\r\n    };\r\n  }\r\n\r\n  async deleteJob(jobId: string, adminId: string) {\r\n    const job = await this.prisma.job.findUnique({\r\n      where: { id: jobId },\r\n      include: {\r\n        JobApplication: {\r\n          include: {\r\n            Interview: true,\r\n            Payment: { include: { Refund: true } },\r\n            Referral: { include: { EmployeeEarning: true } },\r\n            TestSession: true,\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!job) throw new NotFoundException('Job not found');\r\n\r\n    await this.prisma.$transaction(async (tx) => {\r\n      // Cascade-delete all application-related records\r\n      for (const app of job.JobApplication) {\r\n        // Delete Interview\r\n        if (app.Interview) {\r\n          await tx.interview.delete({ where: { id: app.Interview.id } });\r\n        }\r\n        // Delete TestSession records (answers and events)\r\n        if (app.TestSession.length > 0) {\r\n          const sessionIds = app.TestSession.map((s) => s.id);\r\n          await tx.testAnswer.deleteMany({ where: { sessionId: { in: sessionIds } } });\r\n          await tx.testEvent.deleteMany({ where: { sessionId: { in: sessionIds } } });\r\n          await tx.testSession.deleteMany({ where: { id: { in: sessionIds } } });\r\n        }\r\n        // Delete Payment refunds, then payments\r\n        for (const payment of app.Payment) {\r\n          if (payment.Refund) {\r\n            await tx.refund.delete({ where: { id: payment.Refund.id } });\r\n          }\r\n        }\r\n        await tx.payment.deleteMany({ where: { applicationId: app.id } });\r\n        // Delete Referral earnings, then referral\r\n        if (app.Referral) {\r\n          if (app.Referral.EmployeeEarning) {\r\n            await tx.employeeEarning.delete({ where: { id: app.Referral.EmployeeEarning.id } });\r\n          }\r\n          await tx.referral.delete({ where: { id: app.Referral.id } });\r\n        }\r\n      }\r\n\r\n      // Delete all applications for this job\r\n      await tx.jobApplication.deleteMany({ where: { jobId } });\r\n\r\n      // Delete job skills\r\n      await tx.jobSkill.deleteMany({ where: { jobId } });\r\n\r\n      // Delete the job itself\r\n      await tx.job.delete({ where: { id: jobId } });\r\n\r\n      // Audit log\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: adminId,\r\n          action: AuditAction.ADMIN_OVERRIDE,\r\n          entityType: 'Job',\r\n          entityId: jobId,\r\n          metadata: { action: 'delete', jobTitle: job.title },\r\n        },\r\n      });\r\n    });\r\n\r\n    return { success: true, message: 'Job deleted successfully' };\r\n  }\r\n\r\n  // ===========================================\r\n  // CANDIDATE MANAGEMENT\r\n  // ===========================================\r\n\r\n  async getAllCandidates(page = 1, limit = 20, search?: string) {\r\n    const where: any = { role: UserRole.CANDIDATE };\r\n\r\n    if (search) {\r\n      where.OR = [\r\n        { email: { contains: search, mode: 'insensitive' } },\r\n        { Candidate: { firstName: { contains: search, mode: 'insensitive' } } },\r\n        { Candidate: { lastName: { contains: search, mode: 'insensitive' } } },\r\n      ];\r\n    }\r\n\r\n    const skip = (page - 1) * limit;\r\n\r\n    const [candidates, total] = await Promise.all([\r\n      this.prisma.user.findMany({\r\n        where,\r\n        skip,\r\n        take: limit,\r\n        include: {\r\n          Candidate: {\r\n            include: {\r\n              JobApplication: {\r\n                include: {\r\n                  Job: { select: { title: true, companyName: true } },\r\n                },\r\n                orderBy: { createdAt: 'desc' },\r\n                take: 5,\r\n              },\r\n            },\r\n          },\r\n        },\r\n        orderBy: { createdAt: 'desc' },\r\n      }),\r\n      this.prisma.user.count({ where }),\r\n    ]);\r\n\r\n    return {\r\n      data: candidates,\r\n      meta: { page, limit, total, totalPages: Math.ceil(total / limit) },\r\n    };\r\n  }\r\n\r\n  async deleteUser(userId: string, adminId: string) {\r\n    const user = await this.prisma.user.findUnique({\r\n      where: { id: userId },\r\n      include: {\r\n        Candidate: {\r\n          include: {\r\n            _count: {\r\n              select: {\r\n                JobApplication: true,\r\n                SkillTestAttempt: true\r\n              }\r\n            }\r\n          },\r\n        },\r\n        HR: {\r\n          include: { _count: { select: { Job: true } } },\r\n        },\r\n        Employee: {\r\n          include: {\r\n            _count: {\r\n              select: {\r\n                Referral: true,\r\n                EmployeeEarning: true\r\n              }\r\n            }\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!user) throw new NotFoundException('User not found');\r\n    if (user.role === UserRole.ADMIN) {\r\n      throw new BadRequestException('Cannot delete admin users');\r\n    }\r\n\r\n    // Check for active applications (candidates)\r\n    if (user.Candidate && user.Candidate._count.JobApplication > 0) {\r\n      throw new BadRequestException(\r\n        'Cannot delete user with active applications. Please block the user instead.',\r\n      );\r\n    }\r\n\r\n    // Check for jobs (HR)\r\n    if (user.HR && user.HR._count.Job > 0) {\r\n      throw new BadRequestException(\r\n        'Cannot delete HR with posted jobs. Please block the user instead.',\r\n      );\r\n    }\r\n\r\n    // Check for referrals or earnings (Employee)\r\n    if (user.Employee && (user.Employee._count.Referral > 0 || user.Employee._count.EmployeeEarning > 0)) {\r\n      throw new BadRequestException(\r\n        'Cannot delete employee with referrals or earnings. Please block the user instead.',\r\n      );\r\n    }\r\n\r\n    await this.prisma.$transaction(async (tx) => {\r\n      // Delete related authentication and session records first\r\n      await tx.oTPToken.deleteMany({ where: { userId } });\r\n      await tx.refreshToken.deleteMany({ where: { userId } });\r\n      await tx.passwordResetToken.deleteMany({ where: { userId } });\r\n      await tx.deviceLog.deleteMany({ where: { userId } });\r\n      await tx.notification.deleteMany({ where: { userId } });\r\n\r\n      // Delete audit logs where user is the actor (set userId to null instead since FK allows null)\r\n      await tx.auditLog.updateMany({\r\n        where: { userId },\r\n        data: { userId: null }\r\n      });\r\n\r\n      // Handle suspicious activities (set userId to null)\r\n      await tx.suspiciousActivity.updateMany({\r\n        where: { userId },\r\n        data: { userId: null }\r\n      });\r\n\r\n      // Delete role-specific records\r\n      if (user.Candidate) {\r\n        // Delete skill test attempts (no cascade delete on this table)\r\n        await tx.skillTestAttempt.deleteMany({ where: { candidateId: user.Candidate.id } });\r\n        // CandidateSkill, Education, Experience have onDelete: Cascade, they auto-delete\r\n        // CandidateTestAttempt has onDelete: Cascade, auto-deletes\r\n        // Now delete the candidate\r\n        await tx.candidate.delete({ where: { userId } });\r\n      }\r\n      if (user.HR) {\r\n        await tx.hR.delete({ where: { userId } });\r\n      }\r\n      if (user.Employee) {\r\n        await tx.employee.delete({ where: { userId } });\r\n      }\r\n\r\n      // Finally delete the user\r\n      await tx.user.delete({ where: { id: userId } });\r\n\r\n      // Log the action (with adminId as the actor)\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: adminId,\r\n          action: AuditAction.ADMIN_OVERRIDE,\r\n          entityType: 'User',\r\n          entityId: userId,\r\n          metadata: { action: 'delete', email: user.email, role: user.role },\r\n        },\r\n      });\r\n    });\r\n\r\n    return { success: true, message: 'User deleted successfully' };\r\n  }\r\n\r\n  // ===========================================\r\n  // APPLICATION MANAGEMENT\r\n  // ===========================================\r\n\r\n  async getAllApplications(\r\n    page = 1,\r\n    limit = 20,\r\n    status?: string,\r\n    jobId?: string,\r\n    search?: string,\r\n  ) {\r\n    const where: any = {};\r\n\r\n    if (status) where.status = status;\r\n    if (jobId) where.jobId = jobId;\r\n\r\n    if (search) {\r\n      where.OR = [\r\n        { Candidate: { firstName: { contains: search, mode: 'insensitive' } } },\r\n        { Candidate: { lastName: { contains: search, mode: 'insensitive' } } },\r\n        { Job: { title: { contains: search, mode: 'insensitive' } } },\r\n        { Job: { companyName: { contains: search, mode: 'insensitive' } } },\r\n      ];\r\n    }\r\n\r\n    const skip = (page - 1) * limit;\r\n\r\n    const [applications, total] = await Promise.all([\r\n      this.prisma.jobApplication.findMany({\r\n        where,\r\n        skip,\r\n        take: limit,\r\n        include: {\r\n          Candidate: {\r\n            select: {\r\n              id: true,\r\n              firstName: true,\r\n              lastName: true,\r\n              headline: true,\r\n              totalExperience: true,\r\n            },\r\n          },\r\n          Job: {\r\n            select: {\r\n              id: true,\r\n              title: true,\r\n              companyName: true,\r\n              status: true,\r\n            },\r\n          },\r\n          Interview: {\r\n            select: {\r\n              id: true,\r\n              status: true,\r\n              paymentStatus: true,\r\n              scheduledDate: true,\r\n            },\r\n          },\r\n        },\r\n        orderBy: { createdAt: 'desc' },\r\n      }),\r\n      this.prisma.jobApplication.count({ where }),\r\n    ]);\r\n\r\n    return {\r\n      data: applications,\r\n      meta: { page, limit, total, totalPages: Math.ceil(total / limit) },\r\n    };\r\n  }\r\n\r\n  async updateApplicationStatus(\r\n    applicationId: string,\r\n    newStatus: string,\r\n    adminId: string,\r\n    reason?: string,\r\n  ) {\r\n    const application = await this.prisma.jobApplication.findUnique({\r\n      where: { id: applicationId },\r\n    });\r\n\r\n    if (!application) throw new NotFoundException('Application not found');\r\n\r\n    const oldStatus = application.status;\r\n\r\n    await this.prisma.$transaction(async (tx) => {\r\n      await tx.jobApplication.update({\r\n        where: { id: applicationId },\r\n        data: { status: newStatus as any },\r\n      });\r\n\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: adminId,\r\n          action: AuditAction.ADMIN_OVERRIDE,\r\n          entityType: 'JobApplication',\r\n          entityId: applicationId,\r\n          oldValue: { status: oldStatus },\r\n          newValue: { status: newStatus },\r\n          metadata: { action: 'status_override', reason },\r\n        },\r\n      });\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: `Application status updated to ${newStatus}`,\r\n    };\r\n  }\r\n\r\n  // ===========================================\r\n  // PAYMENT & REFUND\r\n  // ===========================================\r\n\r\n  async getAllPayments(page = 1, limit = 20, status?: PaymentStatus) {\r\n    const where: any = {};\r\n    if (status) where.status = status;\r\n\r\n    const skip = (page - 1) * limit;\r\n\r\n    const [payments, total] = await Promise.all([\r\n      this.prisma.payment.findMany({\r\n        where,\r\n        skip,\r\n        take: limit,\r\n        include: {\r\n          JobApplication: {\r\n            include: {\r\n              Candidate: { select: { firstName: true, lastName: true } },\r\n              Job: { select: { title: true, companyName: true } },\r\n            },\r\n          },\r\n          Refund: true,\r\n        },\r\n        orderBy: { createdAt: 'desc' },\r\n      }),\r\n      this.prisma.payment.count({ where }),\r\n    ]);\r\n\r\n    return {\r\n      data: payments,\r\n      meta: { page, limit, total, totalPages: Math.ceil(total / limit) },\r\n    };\r\n  }\r\n\r\n  async getPendingRefunds() {\r\n    return this.prisma.refund.findMany({\r\n      where: { status: RefundStatus.REQUESTED },\r\n      include: {\r\n        Payment: {\r\n          include: {\r\n            JobApplication: {\r\n              include: {\r\n                Candidate: { select: { firstName: true, lastName: true } },\r\n                Job: { select: { title: true, companyName: true } },\r\n              },\r\n            },\r\n          },\r\n        },\r\n      },\r\n      orderBy: { createdAt: 'asc' },\r\n    });\r\n  }\r\n\r\n  async approveRefund(refundId: string, adminId: string, notes?: string) {\r\n    const refund = await this.prisma.refund.findUnique({\r\n      where: { id: refundId },\r\n      include: { Payment: true },\r\n    });\r\n\r\n    if (!refund) throw new NotFoundException('Refund not found');\r\n    if (refund.status !== RefundStatus.REQUESTED) {\r\n      throw new BadRequestException('Refund already processed');\r\n    }\r\n\r\n    await this.prisma.$transaction(async (tx) => {\r\n      await tx.refund.update({\r\n        where: { id: refundId },\r\n        data: {\r\n          status: RefundStatus.APPROVED,\r\n          processedBy: adminId,\r\n          processedAt: new Date(),\r\n          adminNotes: notes,\r\n        },\r\n      });\r\n\r\n      await tx.payment.update({\r\n        where: { id: refund.paymentId },\r\n        data: { status: PaymentStatus.REFUNDED },\r\n      });\r\n\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: adminId,\r\n          action: AuditAction.REFUND_PROCESSED,\r\n          entityType: 'Refund',\r\n          entityId: refundId,\r\n          metadata: { action: 'approve', notes },\r\n        },\r\n      });\r\n    });\r\n\r\n    // TODO: Process actual Razorpay refund\r\n\r\n    return { success: true, message: 'Refund approved' };\r\n  }\r\n\r\n  async rejectRefund(refundId: string, adminId: string, reason: string) {\r\n    const refund = await this.prisma.refund.findUnique({\r\n      where: { id: refundId },\r\n    });\r\n\r\n    if (!refund) throw new NotFoundException('Refund not found');\r\n    if (refund.status !== RefundStatus.REQUESTED) {\r\n      throw new BadRequestException('Refund already processed');\r\n    }\r\n\r\n    await this.prisma.$transaction(async (tx) => {\r\n      await tx.refund.update({\r\n        where: { id: refundId },\r\n        data: {\r\n          status: RefundStatus.REJECTED,\r\n          processedBy: adminId,\r\n          processedAt: new Date(),\r\n          adminNotes: reason,\r\n        },\r\n      });\r\n\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: adminId,\r\n          action: AuditAction.REFUND_PROCESSED,\r\n          entityType: 'Refund',\r\n          entityId: refundId,\r\n          metadata: { action: 'reject', reason },\r\n        },\r\n      });\r\n    });\r\n\r\n    return { success: true, message: 'Refund rejected' };\r\n  }\r\n\r\n  // ===========================================\r\n  // AUDIT LOGS\r\n  // ===========================================\r\n\r\n  async getAuditLogs(page = 1, limit = 50, action?: AuditAction) {\r\n    const where: any = {};\r\n    if (action) where.action = action;\r\n\r\n    const skip = (page - 1) * limit;\r\n\r\n    const [logs, total] = await Promise.all([\r\n      this.prisma.auditLog.findMany({\r\n        where,\r\n        skip,\r\n        take: limit,\r\n        include: {\r\n          User: { select: { email: true } },\r\n        },\r\n        orderBy: { createdAt: 'desc' },\r\n      }),\r\n      this.prisma.auditLog.count({ where }),\r\n    ]);\r\n\r\n    return {\r\n      data: logs,\r\n      meta: { page, limit, total, totalPages: Math.ceil(total / limit) },\r\n    };\r\n  }\r\n\r\n  // ===========================================\r\n  // INTERVIEW MANAGEMENT\r\n  // ===========================================\r\n\r\n  async getAllInterviews(page = 1, limit = 20, status?: string) {\r\n    const where: any = {};\r\n    if (status) where.status = status;\r\n\r\n    const skip = (page - 1) * limit;\r\n\r\n    const [interviews, total] = await Promise.all([\r\n      this.prisma.interview.findMany({\r\n        where,\r\n        skip,\r\n        take: limit,\r\n        include: {\r\n          JobApplication: {\r\n            include: {\r\n              Candidate: { select: { firstName: true, lastName: true } },\r\n              Job: { select: { title: true, companyName: true } },\r\n            },\r\n          },\r\n        },\r\n        orderBy: { createdAt: 'desc' },\r\n      }),\r\n      this.prisma.interview.count({ where }),\r\n    ]);\r\n\r\n    return {\r\n      data: interviews,\r\n      meta: { page, limit, total, totalPages: Math.ceil(total / limit) },\r\n    };\r\n  }\r\n\r\n  async getInterviewStats() {\r\n    const [\r\n      total,\r\n      interviewConfirmed,\r\n      paymentSuccess,\r\n      completed,\r\n      candidateNoShow,\r\n      hrNoShow,\r\n      cancelled,\r\n    ] = await Promise.all([\r\n      this.prisma.interview.count(),\r\n      this.prisma.interview.count({ where: { status: 'INTERVIEW_CONFIRMED' } }),\r\n      this.prisma.interview.count({ where: { status: 'PAYMENT_SUCCESS' } }),\r\n      this.prisma.interview.count({ where: { status: 'INTERVIEW_COMPLETED' } }),\r\n      this.prisma.interview.count({ where: { status: 'CANDIDATE_NO_SHOW' } }),\r\n      this.prisma.interview.count({ where: { status: 'HR_NO_SHOW' } }),\r\n      this.prisma.interview.count({ where: { status: 'CANCELLED' } }),\r\n    ]);\r\n\r\n    // Calculate no-show rate\r\n    const totalCompleted = completed + candidateNoShow + hrNoShow;\r\n    const noShowRate =\r\n      totalCompleted > 0\r\n        ? (((candidateNoShow + hrNoShow) / totalCompleted) * 100).toFixed(2)\r\n        : '0.00';\r\n\r\n    return {\r\n      total,\r\n      byStatus: {\r\n        interviewConfirmed,\r\n        paymentSuccess,\r\n        completed,\r\n        candidateNoShow,\r\n        hrNoShow,\r\n        cancelled,\r\n      },\r\n      noShowRate: `${noShowRate}%`,\r\n      completionRate:\r\n        total > 0 ? `${((completed / total) * 100).toFixed(2)}%` : '0.00%',\r\n    };\r\n  }\r\n\r\n  async updateInterviewStatus(\r\n    interviewId: string,\r\n    newStatus: string,\r\n    adminId: string,\r\n    reason?: string,\r\n  ) {\r\n    const interview = await this.prisma.interview.findUnique({\r\n      where: { id: interviewId },\r\n    });\r\n\r\n    if (!interview) throw new NotFoundException('Interview not found');\r\n\r\n    const oldStatus = interview.status;\r\n\r\n    await this.prisma.$transaction(async (tx) => {\r\n      const updateData: any = { status: newStatus };\r\n\r\n      // Set appropriate timestamps based on new status\r\n      if (newStatus === 'INTERVIEW_COMPLETED') {\r\n        updateData.completedAt = new Date();\r\n      }\r\n\r\n      await tx.interview.update({\r\n        where: { id: interviewId },\r\n        data: updateData,\r\n      });\r\n\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: adminId,\r\n          action: AuditAction.ADMIN_OVERRIDE,\r\n          entityType: 'Interview',\r\n          entityId: interviewId,\r\n          oldValue: { status: oldStatus },\r\n          newValue: { status: newStatus },\r\n          metadata: { action: 'status_change', reason },\r\n        },\r\n      });\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: `Interview status updated to ${newStatus}`,\r\n    };\r\n  }\r\n\r\n  async markInterviewCompleted(\r\n    interviewId: string,\r\n    adminId: string,\r\n    notes?: string,\r\n  ) {\r\n    return this.updateInterviewStatus(\r\n      interviewId,\r\n      'INTERVIEW_COMPLETED',\r\n      adminId,\r\n      notes,\r\n    );\r\n  }\r\n\r\n  async markInterviewNoShow(\r\n    interviewId: string,\r\n    adminId: string,\r\n    noShowType: 'CANDIDATE' | 'HR',\r\n    notes?: string,\r\n  ) {\r\n    const interview = await this.prisma.interview.findUnique({\r\n      where: { id: interviewId },\r\n      include: {\r\n        JobApplication: {\r\n          include: {\r\n            Candidate: { select: { userId: true } },\r\n            Job: { include: { HR: { select: { userId: true } } } },\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!interview) throw new NotFoundException('Interview not found');\r\n\r\n    await this.prisma.$transaction(async (tx) => {\r\n      // Mark interview with appropriate no-show status\r\n      const noShowStatus =\r\n        noShowType === 'CANDIDATE' ? 'CANDIDATE_NO_SHOW' : 'HR_NO_SHOW';\r\n      await tx.interview.update({\r\n        where: { id: interviewId },\r\n        data: { status: noShowStatus },\r\n      });\r\n\r\n      // Log the no-show with details\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: adminId,\r\n          action: AuditAction.ADMIN_OVERRIDE,\r\n          entityType: 'Interview',\r\n          entityId: interviewId,\r\n          metadata: {\r\n            action: 'no_show',\r\n            noShowType,\r\n            notes,\r\n            candidateId: interview.JobApplication?.candidateId || null,\r\n            jobId: interview.JobApplication?.jobId || null,\r\n          },\r\n        },\r\n      });\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: `Interview marked as no-show (${noShowType})`,\r\n    };\r\n  }\r\n\r\n  // ===========================================\r\n  // SKILL BUCKET MANAGEMENT\r\n  // ===========================================\r\n\r\n  async getAllSkillBuckets(includeInactive = false) {\r\n    const buckets = await this.prisma.skillBucket.findMany({\r\n      where: includeInactive ? {} : { isActive: true },\r\n      include: {\r\n        Test: {\r\n          select: {\r\n            id: true,\r\n            title: true,\r\n            duration: true,\r\n            totalQuestions: true,\r\n          },\r\n        },\r\n        TestTemplate: {\r\n          select: {\r\n            id: true,\r\n            name: true,\r\n            duration: true,\r\n            passingCriteria: true,\r\n            questionPoolSize: true,\r\n            selectionRoleType: true,\r\n          },\r\n        },\r\n        _count: {\r\n          select: {\r\n            Job: true,\r\n            SkillTestAttempt: true,\r\n            JobRequiredSkillBucket: true,\r\n          },\r\n        },\r\n      },\r\n      orderBy: { code: 'asc' },\r\n    });\r\n\r\n    // For each bucket, count available questions from QuestionBank\r\n    const bucketsWithQuestionCount = await Promise.all(\r\n      buckets.map(async (bucket) => {\r\n        // Use TestTemplate.selectionRoleType if set, otherwise use bucket.code\r\n        const roleType = bucket.TestTemplate?.selectionRoleType || bucket.code;\r\n        const availableQuestions = await this.prisma.questionBank.count({\r\n          where: {\r\n            roleType: roleType,\r\n            isActive: true,\r\n          },\r\n        });\r\n        return {\r\n          ...bucket,\r\n          availableQuestions,\r\n        };\r\n      }),\r\n    );\r\n\r\n    return bucketsWithQuestionCount;\r\n  }\r\n\r\n  async createSkillBucket(\r\n    data: {\r\n      code: string;\r\n      name: string;\r\n      description?: string;\r\n      displayName?: string;\r\n      experienceMin?: number;\r\n      experienceMax?: number;\r\n      testId?: string;\r\n      testTemplateId?: string;\r\n    },\r\n    adminId: string,\r\n  ) {\r\n    // Check if code already exists\r\n    const existing = await this.prisma.skillBucket.findUnique({\r\n      where: { code: data.code },\r\n    });\r\n\r\n    if (existing) {\r\n      throw new BadRequestException(\r\n        `Skill bucket with code '${data.code}' already exists`,\r\n      );\r\n    }\r\n\r\n    const skillBucket = await this.prisma.skillBucket.create({\r\n      data: {\r\n        id: crypto.randomUUID(),\r\n        code: data.code,\r\n        name: data.name,\r\n        description: data.description,\r\n        displayName: data.displayName || `HR Shortlisting Check - ${data.name}`,\r\n        experienceMin: data.experienceMin ?? 0,\r\n        experienceMax: data.experienceMax ?? 3,\r\n        ...(data.testId && { Test: { connect: { id: data.testId } } }),\r\n        ...(data.testTemplateId && { TestTemplate: { connect: { id: data.testTemplateId } } }),\r\n        updatedAt: new Date(),\r\n      },\r\n    });\r\n\r\n    await this.prisma.auditLog.create({\r\n      data: {\r\n        userId: adminId,\r\n        action: AuditAction.CREATE,\r\n        entityType: 'SkillBucket',\r\n        entityId: skillBucket.id,\r\n        newValue: data as any,\r\n      },\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: 'Skill bucket created',\r\n      data: skillBucket,\r\n    };\r\n  }\r\n\r\n  async updateSkillBucket(id: string, data: any, adminId: string) {\r\n    const existing = await this.prisma.skillBucket.findUnique({\r\n      where: { id },\r\n    });\r\n    if (!existing) throw new NotFoundException('Skill bucket not found');\r\n\r\n    const updated = await this.prisma.skillBucket.update({\r\n      where: { id },\r\n      data,\r\n    });\r\n\r\n    await this.prisma.auditLog.create({\r\n      data: {\r\n        userId: adminId,\r\n        action: AuditAction.UPDATE,\r\n        entityType: 'SkillBucket',\r\n        entityId: id,\r\n        oldValue: existing as any,\r\n        newValue: data,\r\n      },\r\n    });\r\n\r\n    return { success: true, message: 'Skill bucket updated', data: updated };\r\n  }\r\n\r\n  async deleteSkillBucket(id: string, adminId: string) {\r\n    const bucket = await this.prisma.skillBucket.findUnique({\r\n      where: { id },\r\n      include: {\r\n        _count: {\r\n          select: {\r\n            Job: true,\r\n            SkillTestAttempt: true,\r\n            JobRequiredSkillBucket: true,\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!bucket) throw new NotFoundException('Skill bucket not found');\r\n\r\n    // Check if skill bucket is in use\r\n    if (bucket._count.Job > 0 || bucket._count.JobRequiredSkillBucket > 0) {\r\n      throw new BadRequestException(\r\n        `Cannot delete skill bucket: it is assigned to ${bucket._count.Job + bucket._count.JobRequiredSkillBucket} job(s). Deactivate it instead.`,\r\n      );\r\n    }\r\n\r\n    // If there are attempts, just deactivate instead of hard delete\r\n    if (bucket._count.SkillTestAttempt > 0) {\r\n      await this.prisma.skillBucket.update({\r\n        where: { id },\r\n        data: { isActive: false },\r\n      });\r\n\r\n      await this.prisma.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: adminId,\r\n          action: AuditAction.UPDATE,\r\n          entityType: 'SkillBucket',\r\n          entityId: id,\r\n          metadata: { action: 'deactivate', reason: 'has_attempts' },\r\n        },\r\n      });\r\n\r\n      return {\r\n        success: true,\r\n        message: 'Skill bucket deactivated (has test attempts)',\r\n      };\r\n    }\r\n\r\n    // Safe to hard delete\r\n    await this.prisma.skillBucket.delete({ where: { id } });\r\n\r\n    await this.prisma.auditLog.create({\r\n      data: {\r\n        id: crypto.randomUUID(),\r\n        userId: adminId,\r\n        action: AuditAction.DELETE,\r\n        entityType: 'SkillBucket',\r\n        entityId: id,\r\n        oldValue: bucket as any,\r\n      },\r\n    });\r\n\r\n    return { success: true, message: 'Skill bucket deleted' };\r\n  }\r\n\r\n  // ===========================================\r\n  // JOB SKILL REQUIREMENTS\r\n  // ===========================================\r\n\r\n  async addSkillRequirementToJob(\r\n    jobId: string,\r\n    skillBucketId: string,\r\n    adminId: string,\r\n  ) {\r\n    const job = await this.prisma.job.findUnique({ where: { id: jobId } });\r\n    if (!job) throw new NotFoundException('Job not found');\r\n\r\n    const bucket = await this.prisma.skillBucket.findUnique({\r\n      where: { id: skillBucketId },\r\n    });\r\n    if (!bucket) throw new NotFoundException('Skill bucket not found');\r\n\r\n    const requirement = await this.prisma.jobRequiredSkillBucket.upsert({\r\n      where: {\r\n        jobId_skillBucketId: { jobId, skillBucketId },\r\n      },\r\n      create: {\r\n        id: crypto.randomUUID(),\r\n        jobId,\r\n        skillBucketId,\r\n      },\r\n      update: {},\r\n      include: {\r\n        SkillBucket: true,\r\n      },\r\n    });\r\n\r\n    await this.prisma.auditLog.create({\r\n      data: {\r\n        id: crypto.randomUUID(),\r\n        userId: adminId,\r\n        action: AuditAction.CREATE,\r\n        entityType: 'JobRequiredSkillBucket',\r\n        entityId: requirement.id,\r\n        metadata: { jobId, skillBucketId, skillBucketCode: bucket.code },\r\n      },\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: 'Skill requirement added to job',\r\n      data: requirement,\r\n    };\r\n  }\r\n\r\n  async removeSkillRequirementFromJob(\r\n    jobId: string,\r\n    skillBucketId: string,\r\n    adminId: string,\r\n  ) {\r\n    const requirement = await this.prisma.jobRequiredSkillBucket.findUnique({\r\n      where: {\r\n        jobId_skillBucketId: { jobId, skillBucketId },\r\n      },\r\n    });\r\n\r\n    if (!requirement)\r\n      throw new NotFoundException('Skill requirement not found for this job');\r\n\r\n    await this.prisma.jobRequiredSkillBucket.delete({\r\n      where: {\r\n        jobId_skillBucketId: { jobId, skillBucketId },\r\n      },\r\n    });\r\n\r\n    await this.prisma.auditLog.create({\r\n      data: {\r\n        id: crypto.randomUUID(),\r\n        userId: adminId,\r\n        action: AuditAction.DELETE,\r\n        entityType: 'JobRequiredSkillBucket',\r\n        entityId: requirement.id,\r\n        metadata: { jobId, skillBucketId },\r\n      },\r\n    });\r\n\r\n    return { success: true, message: 'Skill requirement removed from job' };\r\n  }\r\n\r\n  async getJobSkillRequirements(jobId: string) {\r\n    const job = await this.prisma.job.findUnique({\r\n      where: { id: jobId },\r\n      include: {\r\n        SkillBucket: true, // Legacy single bucket\r\n        JobRequiredSkillBucket: {\r\n          include: {\r\n            SkillBucket: true,\r\n          },\r\n          orderBy: { displayOrder: 'asc' },\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!job) throw new NotFoundException('Job not found');\r\n\r\n    return {\r\n      jobId: job.id,\r\n      jobTitle: job.title,\r\n      legacySkillBucket: job.SkillBucket,\r\n      compositeRequirements: job.JobRequiredSkillBucket,\r\n    };\r\n  }\r\n\r\n  // ===========================================\r\n  // PAYMENT CONTROL (ADMIN OVERRIDE)\r\n  // ===========================================\r\n\r\n  async updatePaymentStatus(\r\n    paymentId: string,\r\n    newStatus: PaymentStatus,\r\n    adminId: string,\r\n    reason?: string,\r\n  ) {\r\n    const payment = await this.prisma.payment.findUnique({\r\n      where: { id: paymentId },\r\n    });\r\n\r\n    if (!payment) throw new NotFoundException('Payment not found');\r\n\r\n    const oldStatus = payment.status;\r\n\r\n    await this.prisma.$transaction(async (tx) => {\r\n      await tx.payment.update({\r\n        where: { id: paymentId },\r\n        data: {\r\n          status: newStatus,\r\n          ...(newStatus === PaymentStatus.SUCCESS && { paidAt: new Date() }),\r\n        },\r\n      });\r\n\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: adminId,\r\n          action: AuditAction.ADMIN_OVERRIDE,\r\n          entityType: 'Payment',\r\n          entityId: paymentId,\r\n          oldValue: { status: oldStatus },\r\n          newValue: { status: newStatus },\r\n          metadata: { action: 'status_override', reason },\r\n        },\r\n      });\r\n    });\r\n\r\n    return { success: true, message: `Payment status updated to ${newStatus}` };\r\n  }\r\n\r\n  async issueManualRefund(paymentId: string, adminId: string, reason: string) {\r\n    const payment = await this.prisma.payment.findUnique({\r\n      where: { id: paymentId },\r\n      include: { Refund: true },\r\n    });\r\n\r\n    if (!payment) throw new NotFoundException('Payment not found');\r\n    if (payment.status !== PaymentStatus.SUCCESS) {\r\n      throw new BadRequestException('Can only refund successful payments');\r\n    }\r\n    if (payment.Refund) {\r\n      throw new BadRequestException('Payment already has a refund request');\r\n    }\r\n\r\n    await this.prisma.$transaction(async (tx) => {\r\n      // Create refund record\r\n      const refund = await tx.refund.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          paymentId,\r\n          amount: payment.amount,\r\n          reason: `ADMIN Refund: ${reason}`,\r\n          status: RefundStatus.APPROVED,\r\n          processedBy: adminId,\r\n          processedAt: new Date(),\r\n          adminNotes: 'Manual refund by admin',\r\n          updatedAt: new Date(),\r\n        },\r\n      });\r\n\r\n      // Update payment status\r\n      await tx.payment.update({\r\n        where: { id: paymentId },\r\n        data: { status: PaymentStatus.REFUNDED },\r\n      });\r\n\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: adminId,\r\n          action: AuditAction.REFUND_PROCESSED,\r\n          entityType: 'Refund',\r\n          entityId: refund.id,\r\n          metadata: { action: 'manual_refund', reason, amount: payment.amount },\r\n        },\r\n      });\r\n    });\r\n\r\n    // TODO: Process actual Razorpay refund\r\n\r\n    return { success: true, message: 'Manual refund issued successfully' };\r\n  }\r\n\r\n  // ===========================================\r\n  // REVENUE REPORTS\r\n  // ===========================================\r\n\r\n  async getRevenueReport(startDate?: Date, endDate?: Date) {\r\n    const dateFilter: any = {};\r\n    if (startDate) dateFilter.gte = startDate;\r\n    if (endDate) dateFilter.lte = endDate;\r\n\r\n    const payments = await this.prisma.payment.findMany({\r\n      where: {\r\n        status: PaymentStatus.SUCCESS,\r\n        ...(Object.keys(dateFilter).length > 0 && { paidAt: dateFilter }),\r\n      },\r\n      select: {\r\n        amount: true,\r\n        paidAt: true,\r\n        currency: true,\r\n      },\r\n      orderBy: { paidAt: 'desc' },\r\n    });\r\n\r\n    const totalRevenue = payments.reduce((sum, p) => sum + p.amount, 0);\r\n    const refunds = await this.prisma.refund.aggregate({\r\n      where: {\r\n        status: RefundStatus.APPROVED,\r\n        ...(Object.keys(dateFilter).length > 0 && { processedAt: dateFilter }),\r\n      },\r\n      _sum: { amount: true },\r\n    });\r\n\r\n    const netRevenue = totalRevenue - (refunds._sum.amount || 0);\r\n\r\n    // Group by date for charting\r\n    const dailyRevenue: Record<string, number> = {};\r\n    for (const p of payments) {\r\n      if (p.paidAt) {\r\n        const dateKey = p.paidAt.toISOString().split('T')[0];\r\n        dailyRevenue[dateKey] = (dailyRevenue[dateKey] || 0) + p.amount;\r\n      }\r\n    }\r\n\r\n    return {\r\n      summary: {\r\n        totalRevenue,\r\n        totalRefunds: refunds._sum.amount || 0,\r\n        netRevenue,\r\n        transactionCount: payments.length,\r\n      },\r\n      dailyBreakdown: Object.entries(dailyRevenue).map(([date, amount]) => ({\r\n        date,\r\n        amount,\r\n      })),\r\n    };\r\n  }\r\n\r\n  // ===========================================\r\n  // ENHANCED ANALYTICS\r\n  // ===========================================\r\n\r\n  async getEnhancedAnalytics() {\r\n    const [\r\n      // User metrics\r\n      totalCandidates,\r\n      totalHRs,\r\n      activeUsers,\r\n      blockedUsers,\r\n\r\n      // Test metrics\r\n      totalTestAttempts,\r\n      passedTests,\r\n      failedTests,\r\n\r\n      // Interview metrics\r\n      totalInterviews,\r\n      completedInterviews,\r\n      scheduledInterviews,\r\n\r\n      // Payment metrics\r\n      totalPayments,\r\n      successfulPayments,\r\n      refundedPayments,\r\n    ] = await Promise.all([\r\n      this.prisma.user.count({ where: { role: UserRole.CANDIDATE } }),\r\n      this.prisma.user.count({ where: { role: UserRole.HR } }),\r\n      this.prisma.user.count({ where: { status: UserStatus.ACTIVE } }),\r\n      this.prisma.user.count({ where: { status: UserStatus.BLOCKED } }),\r\n\r\n      this.prisma.skillTestAttempt.count(),\r\n      this.prisma.skillTestAttempt.count({ where: { isPassed: true } }),\r\n      this.prisma.skillTestAttempt.count({ where: { isPassed: false } }),\r\n\r\n      this.prisma.interview.count(),\r\n      this.prisma.interview.count({ where: { status: 'INTERVIEW_COMPLETED' } }),\r\n      this.prisma.interview.count({ where: { status: 'PAYMENT_SUCCESS' } }),\r\n\r\n      this.prisma.payment.count(),\r\n      this.prisma.payment.count({ where: { status: PaymentStatus.SUCCESS } }),\r\n      this.prisma.payment.count({ where: { status: PaymentStatus.REFUNDED } }),\r\n    ]);\r\n\r\n    const testPassRate =\r\n      totalTestAttempts > 0\r\n        ? ((passedTests / totalTestAttempts) * 100).toFixed(2)\r\n        : '0.00';\r\n\r\n    const interviewCompletionRate =\r\n      totalInterviews > 0\r\n        ? ((completedInterviews / totalInterviews) * 100).toFixed(2)\r\n        : '0.00';\r\n\r\n    return {\r\n      users: {\r\n        totalCandidates,\r\n        totalHRs,\r\n        activeUsers,\r\n        blockedUsers,\r\n      },\r\n      tests: {\r\n        totalAttempts: totalTestAttempts,\r\n        passed: passedTests,\r\n        failed: failedTests,\r\n        passRate: `${testPassRate}%`,\r\n      },\r\n      interviews: {\r\n        total: totalInterviews,\r\n        completed: completedInterviews,\r\n        scheduled: scheduledInterviews,\r\n        completionRate: `${interviewCompletionRate}%`,\r\n      },\r\n      Payment: {\r\n        total: totalPayments,\r\n        successful: successfulPayments,\r\n        refunded: refundedPayments,\r\n      },\r\n    };\r\n  }\r\n\r\n  // ===========================================\r\n  // TEST OVERRIDE CONTROLS (ADMIN POWER FEATURES)\r\n  // ===========================================\r\n\r\n  /**\r\n   * Admin manually marks a candidate as PASSED for a skill test\r\n   * Creates a SkillTestAttempt with isPassed: true\r\n   */\r\n  async manuallyPassTest(\r\n    candidateId: string,\r\n    skillBucketId: string,\r\n    adminId: string,\r\n    reason: string,\r\n    validityDays: number = 7,\r\n  ) {\r\n    // Verify candidate exists\r\n    const candidate = await this.prisma.candidate.findUnique({\r\n      where: { id: candidateId },\r\n    });\r\n    if (!candidate) throw new NotFoundException('Candidate not found');\r\n\r\n    // Verify skill bucket exists\r\n    const skillBucket = await this.prisma.skillBucket.findUnique({\r\n      where: { id: skillBucketId },\r\n    });\r\n    if (!skillBucket) throw new NotFoundException('Skill bucket not found');\r\n\r\n    const now = new Date();\r\n    const validTill = new Date(\r\n      now.getTime() + validityDays * 24 * 60 * 60 * 1000,\r\n    );\r\n\r\n    const attempt = await this.prisma.skillTestAttempt.create({\r\n      data: {\r\n        id: crypto.randomUUID(),\r\n        candidateId,\r\n        skillBucketId,\r\n        isPassed: true,\r\n        score: 100, // Admin-granted pass\r\n        validTill,\r\n        retestAllowedAt: null,\r\n      },\r\n    });\r\n\r\n    await this.prisma.auditLog.create({\r\n      data: {\r\n        userId: adminId,\r\n        action: AuditAction.ADMIN_OVERRIDE,\r\n        entityType: 'SkillTestAttempt',\r\n        entityId: attempt.id,\r\n        newValue: { isPassed: true, validTill, validityDays, reason },\r\n        metadata: { action: 'manual_pass', candidateId, skillBucketId },\r\n      },\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: `Candidate manually passed for ${skillBucket.name}. Valid until ${validTill.toISOString()}`,\r\n      attempt,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Admin manually marks a candidate as FAILED for a skill test\r\n   * Creates a SkillTestAttempt with isPassed: false and immediate retest allowed\r\n   */\r\n  async manuallyFailTest(\r\n    candidateId: string,\r\n    skillBucketId: string,\r\n    adminId: string,\r\n    reason: string,\r\n  ) {\r\n    // Verify candidate exists\r\n    const candidate = await this.prisma.candidate.findUnique({\r\n      where: { id: candidateId },\r\n    });\r\n    if (!candidate) throw new NotFoundException('Candidate not found');\r\n\r\n    // Verify skill bucket exists\r\n    const skillBucket = await this.prisma.skillBucket.findUnique({\r\n      where: { id: skillBucketId },\r\n    });\r\n    if (!skillBucket) throw new NotFoundException('Skill bucket not found');\r\n\r\n    const now = new Date();\r\n\r\n    const attempt = await this.prisma.skillTestAttempt.create({\r\n      data: {\r\n        candidateId,\r\n        skillBucketId,\r\n        isPassed: false,\r\n        score: 0, // Admin-forced fail\r\n        validTill: null,\r\n        retestAllowedAt: now, // Immediate retest allowed since admin forced it\r\n      },\r\n    });\r\n\r\n    await this.prisma.auditLog.create({\r\n      data: {\r\n        userId: adminId,\r\n        action: AuditAction.ADMIN_OVERRIDE,\r\n        entityType: 'SkillTestAttempt',\r\n        entityId: attempt.id,\r\n        newValue: { isPassed: false, reason },\r\n        metadata: { action: 'manual_fail', candidateId, skillBucketId },\r\n      },\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: `Candidate manually failed for ${skillBucket.name}. Immediate retest allowed.`,\r\n      attempt,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Admin extends the validity of an existing test attempt\r\n   */\r\n  async extendTestValidity(\r\n    attemptId: string,\r\n    newValidTill: Date,\r\n    adminId: string,\r\n    reason: string,\r\n  ) {\r\n    const attempt = await this.prisma.skillTestAttempt.findUnique({\r\n      where: { id: attemptId },\r\n      include: { SkillBucket: true },\r\n    });\r\n\r\n    if (!attempt) throw new NotFoundException('Test attempt not found');\r\n    if (!attempt.isPassed)\r\n      throw new BadRequestException(\r\n        'Can only extend validity for passed tests',\r\n      );\r\n\r\n    const oldValidTill = attempt.validTill;\r\n\r\n    const updated = await this.prisma.skillTestAttempt.update({\r\n      where: { id: attemptId },\r\n      data: { validTill: newValidTill },\r\n    });\r\n\r\n    await this.prisma.auditLog.create({\r\n      data: {\r\n        userId: adminId,\r\n        action: AuditAction.ADMIN_OVERRIDE,\r\n        entityType: 'SkillTestAttempt',\r\n        entityId: attemptId,\r\n        oldValue: { validTill: oldValidTill },\r\n        newValue: { validTill: newValidTill, reason },\r\n        metadata: { action: 'extend_validity' },\r\n      },\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: `Validity extended to ${newValidTill.toISOString()}`,\r\n      attempt: updated,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Admin resets the retest cooldown for a failed test attempt\r\n   * Allows candidate to immediately retake the test\r\n   */\r\n  async resetRetestCooldown(\r\n    attemptId: string,\r\n    adminId: string,\r\n    reason: string,\r\n  ) {\r\n    const attempt = await this.prisma.skillTestAttempt.findUnique({\r\n      where: { id: attemptId },\r\n      include: { SkillBucket: true },\r\n    });\r\n\r\n    if (!attempt) throw new NotFoundException('Test attempt not found');\r\n    if (attempt.isPassed)\r\n      throw new BadRequestException(\r\n        'Cooldown reset only applies to failed tests',\r\n      );\r\n\r\n    const now = new Date();\r\n    const oldRetestAllowedAt = attempt.retestAllowedAt;\r\n\r\n    const updated = await this.prisma.skillTestAttempt.update({\r\n      where: { id: attemptId },\r\n      data: { retestAllowedAt: now },\r\n    });\r\n\r\n    await this.prisma.auditLog.create({\r\n      data: {\r\n        userId: adminId,\r\n        action: AuditAction.ADMIN_OVERRIDE,\r\n        entityType: 'SkillTestAttempt',\r\n        entityId: attemptId,\r\n        oldValue: { retestAllowedAt: oldRetestAllowedAt },\r\n        newValue: { retestAllowedAt: now, reason },\r\n        metadata: { action: 'reset_cooldown' },\r\n      },\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: 'Retest cooldown reset. Candidate can now retake the test.',\r\n      attempt: updated,\r\n    };\r\n  }\r\n\r\n  // ==========================================\r\n  // FRAUD DETECTION: Suspicious Activity Management\r\n  // ==========================================\r\n\r\n  async getSuspiciousActivities(\r\n    page = 1,\r\n    limit = 20,\r\n    isReviewed?: boolean,\r\n    activityType?: string,\r\n  ) {\r\n    const where: any = {};\r\n    if (isReviewed !== undefined) where.isReviewed = isReviewed;\r\n    if (activityType) where.activityType = activityType;\r\n\r\n    const skip = (page - 1) * limit;\r\n\r\n    const [activities, total] = await Promise.all([\r\n      this.prisma.suspiciousActivity.findMany({\r\n        where,\r\n        skip,\r\n        take: limit,\r\n        include: {\r\n          User: {\r\n            select: {\r\n              id: true,\r\n              email: true,\r\n              role: true,\r\n              status: true,\r\n            },\r\n          },\r\n        },\r\n        orderBy: { createdAt: 'desc' },\r\n      }),\r\n      this.prisma.suspiciousActivity.count({ where }),\r\n    ]);\r\n\r\n    return {\r\n      data: activities,\r\n      meta: { page, limit, total, totalPages: Math.ceil(total / limit) },\r\n    };\r\n  }\r\n\r\n  async reviewSuspiciousActivity(\r\n    activityId: string,\r\n    adminId: string,\r\n    action: 'dismiss' | 'block_user',\r\n    notes?: string,\r\n  ) {\r\n    const activity = await this.prisma.suspiciousActivity.findUnique({\r\n      where: { id: activityId },\r\n      include: { User: true },\r\n    });\r\n\r\n    if (!activity) {\r\n      throw new NotFoundException('Suspicious activity not found');\r\n    }\r\n\r\n    await this.prisma.$transaction(async (tx) => {\r\n      // Mark as reviewed\r\n      await tx.suspiciousActivity.update({\r\n        where: { id: activityId },\r\n        data: {\r\n          isReviewed: true,\r\n          reviewedBy: adminId,\r\n          reviewedAt: new Date(),\r\n          reviewNotes: notes,\r\n        },\r\n      });\r\n\r\n      // If action is block_user, block the associated user\r\n      if (action === 'block_user' && activity.userId) {\r\n        await tx.user.update({\r\n          where: { id: activity.userId },\r\n          data: { status: UserStatus.BLOCKED },\r\n        });\r\n      }\r\n\r\n      // Audit log\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: adminId,\r\n          action: AuditAction.ADMIN_OVERRIDE,\r\n          entityType: 'SuspiciousActivity',\r\n          entityId: activityId,\r\n          metadata: {\r\n            action,\r\n            notes,\r\n            userBlocked: action === 'block_user',\r\n          },\r\n        },\r\n      });\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message:\r\n        action === 'block_user'\r\n          ? 'Suspicious activity reviewed. User has been blocked.'\r\n          : 'Suspicious activity dismissed.',\r\n    };\r\n  }\r\n\r\n  async getHRFraudMetrics() {\r\n    const thirtyDaysAgo = new Date(Date.now() - 30 * 24 * 60 * 60 * 1000);\r\n\r\n    const hrStats = await this.prisma.hR.findMany({\r\n      include: {\r\n        Job: {\r\n          include: {\r\n            JobApplication: {\r\n              where: {\r\n                createdAt: { gte: thirtyDaysAgo },\r\n              },\r\n              include: {\r\n                Interview: true,\r\n              },\r\n            },\r\n          },\r\n        },\r\n        User: {\r\n          select: { email: true, status: true },\r\n        },\r\n      },\r\n    });\r\n\r\n    const metrics = hrStats.map((hr) => {\r\n      const allInterviews = hr.Job.flatMap((job) =>\r\n        job.JobApplication.map((app) => app.Interview).filter(Boolean),\r\n      );\r\n      const cancelledCount = allInterviews.filter(\r\n        (i: any) => i?.status === 'CANCELLED',\r\n      ).length;\r\n      const noShowCount = allInterviews.filter(\r\n        (i: any) => i?.status === 'HR_NO_SHOW',\r\n      ).length;\r\n      const totalInterviews = allInterviews.length;\r\n\r\n      return {\r\n        hrId: hr.id,\r\n        email: hr.User.email,\r\n        companyName: hr.companyName,\r\n        userStatus: hr.User.status,\r\n        totalInterviews,\r\n        cancelledCount,\r\n        noShowCount,\r\n        cancellationRate:\r\n          totalInterviews > 0\r\n            ? ((cancelledCount / totalInterviews) * 100).toFixed(1)\r\n            : 0,\r\n        noShowRate:\r\n          totalInterviews > 0\r\n            ? ((noShowCount / totalInterviews) * 100).toFixed(1)\r\n            : 0,\r\n        isFlagged: cancelledCount > 3 || noShowCount > 2,\r\n      };\r\n    });\r\n\r\n    return {\r\n      flaggedHRs: metrics.filter((m) => m.isFlagged),\r\n      allMetrics: metrics.sort(\r\n        (a, b) =>\r\n          b.cancelledCount + b.noShowCount - (a.cancelledCount + a.noShowCount),\r\n      ),\r\n    };\r\n  }\r\n\r\n  // ===========================================\r\n  // TESTIMONIAL MANAGEMENT\r\n  // ===========================================\r\n\r\n  async getAllTestimonials(page = 1, limit = 20) {\r\n    const skip = (page - 1) * limit;\r\n\r\n    const [testimonials, total] = await Promise.all([\r\n      this.prisma.testimonial.findMany({\r\n        skip,\r\n        take: limit,\r\n        orderBy: [{ displayOrder: 'asc' }, { createdAt: 'desc' }],\r\n      }),\r\n      this.prisma.testimonial.count(),\r\n    ]);\r\n\r\n    return {\r\n      data: testimonials,\r\n      meta: { page, limit, total, totalPages: Math.ceil(total / limit) },\r\n    };\r\n  }\r\n\r\n  async getPublicTestimonials(limit = 6) {\r\n    return this.prisma.testimonial.findMany({\r\n      where: { isActive: true },\r\n      orderBy: [{ displayOrder: 'asc' }, { createdAt: 'desc' }],\r\n      take: limit,\r\n    });\r\n  }\r\n\r\n  async createTestimonial(\r\n    data: {\r\n      candidateName: string;\r\n      role: string;\r\n      company: string;\r\n      interviewDate: string;\r\n      quote: string;\r\n      imageUrl?: string;\r\n      rating?: number;\r\n      displayOrder?: number;\r\n    },\r\n    adminId: string,\r\n  ) {\r\n    const testimonial = await this.prisma.testimonial.create({\r\n      data: {\r\n        candidateName: data.candidateName,\r\n        role: data.role,\r\n        company: data.company,\r\n        interviewDate: new Date(data.interviewDate),\r\n        quote: data.quote,\r\n        imageUrl: data.imageUrl,\r\n        rating: data.rating || 5,\r\n        displayOrder: data.displayOrder || 0,\r\n      },\r\n    });\r\n\r\n    await this.prisma.auditLog.create({\r\n      data: {\r\n        id: crypto.randomUUID(),\r\n        userId: adminId,\r\n        action: AuditAction.CREATE,\r\n        entityType: 'Testimonial',\r\n        entityId: testimonial.id,\r\n        metadata: { candidateName: data.candidateName },\r\n      },\r\n    });\r\n\r\n    return { success: true, message: 'Testimonial created', data: testimonial };\r\n  }\r\n\r\n  async updateTestimonial(id: string, data: any, adminId: string) {\r\n    const testimonial = await this.prisma.testimonial.findUnique({\r\n      where: { id },\r\n    });\r\n\r\n    if (!testimonial) throw new NotFoundException('Testimonial not found');\r\n\r\n    // Handle date conversion if present\r\n    if (data.interviewDate) {\r\n      data.interviewDate = new Date(data.interviewDate);\r\n    }\r\n\r\n    const updatedTestimonial = await this.prisma.testimonial.update({\r\n      where: { id },\r\n      data,\r\n    });\r\n\r\n    await this.prisma.auditLog.create({\r\n      data: {\r\n        id: crypto.randomUUID(),\r\n        userId: adminId,\r\n        action: AuditAction.UPDATE,\r\n        entityType: 'Testimonial',\r\n        entityId: id,\r\n        metadata: { changes: data },\r\n      },\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: 'Testimonial updated',\r\n      data: updatedTestimonial,\r\n    };\r\n  }\r\n\r\n  async deleteTestimonial(id: string, adminId: string) {\r\n    const testimonial = await this.prisma.testimonial.findUnique({\r\n      where: { id },\r\n    });\r\n\r\n    if (!testimonial) throw new NotFoundException('Testimonial not found');\r\n\r\n    await this.prisma.$transaction(async (tx) => {\r\n      await tx.testimonial.delete({ where: { id } });\r\n\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: adminId,\r\n          action: AuditAction.DELETE,\r\n          entityType: 'Testimonial',\r\n          entityId: id,\r\n          metadata: { candidateName: testimonial.candidateName },\r\n        },\r\n      });\r\n    });\r\n\r\n    return { success: true, message: 'Testimonial deleted' };\r\n  }\r\n\r\n  async toggleTestimonialStatus(id: string, adminId: string) {\r\n    const testimonial = await this.prisma.testimonial.findUnique({\r\n      where: { id },\r\n    });\r\n\r\n    if (!testimonial) throw new NotFoundException('Testimonial not found');\r\n\r\n    const updatedTestimonial = await this.prisma.testimonial.update({\r\n      where: { id },\r\n      data: { isActive: !testimonial.isActive },\r\n    });\r\n\r\n    await this.prisma.auditLog.create({\r\n      data: {\r\n        id: crypto.randomUUID(),\r\n        userId: adminId,\r\n        action: AuditAction.UPDATE,\r\n        entityType: 'Testimonial',\r\n        entityId: id,\r\n        metadata: { action: 'toggle_status', newStatus: !testimonial.isActive },\r\n      },\r\n    });\r\n\r\n    return {\r\n      success: true,\r\n      message: `Testimonial ${updatedTestimonial.isActive ? 'activated' : 'deactivated'}`,\r\n      data: updatedTestimonial,\r\n    };\r\n  }\r\n\r\n  // ==========================================\r\n  // SITE SETTINGS\r\n  // ==========================================\r\n\r\n  async getAllSettings() {\r\n    const settings = await this.prisma.siteSettings.findMany({\r\n      orderBy: { key: 'asc' },\r\n    });\r\n\r\n    // Return as key-value object for easy access\r\n    const settingsMap = {};\r\n    settings.forEach((s) => {\r\n      settingsMap[s.key] = s.value;\r\n    });\r\n\r\n    return { data: settings, map: settingsMap };\r\n  }\r\n\r\n  async getPublicSettings() {\r\n    // Get specific settings that are public (trust counters)\r\n    const settings = await this.prisma.siteSettings.findMany({\r\n      where: {\r\n        key: {\r\n          in: ['interviews_scheduled', 'candidates_selected'],\r\n        },\r\n      },\r\n    });\r\n\r\n    const result = {\r\n      interviewsScheduled: 127,\r\n      candidatesSelected: 38,\r\n    };\r\n\r\n    settings.forEach((s) => {\r\n      if (s.key === 'interviews_scheduled') result.interviewsScheduled = parseInt(s.value) || 127;\r\n      if (s.key === 'candidates_selected') result.candidatesSelected = parseInt(s.value) || 38;\r\n    });\r\n\r\n    return result;\r\n  }\r\n\r\n  async updateSetting(key: string, value: string, label?: string, adminId?: string) {\r\n    const setting = await this.prisma.siteSettings.upsert({\r\n      where: { key },\r\n      create: {\r\n        key,\r\n        value,\r\n        label: label || key,\r\n        type: 'number',\r\n      },\r\n      update: { value },\r\n    });\r\n\r\n    if (adminId) {\r\n      await this.prisma.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: adminId,\r\n          action: AuditAction.UPDATE,\r\n          entityType: 'SiteSettings',\r\n          entityId: key,\r\n          metadata: { key, value },\r\n        },\r\n      });\r\n    }\r\n\r\n    return { success: true, message: 'Setting updated', data: setting };\r\n  }\r\n\r\n  async initializeDefaultSettings() {\r\n    const defaults = [\r\n      { key: 'interviews_scheduled', value: '127', label: 'Interviews Scheduled This Month', type: 'number' },\r\n      { key: 'candidates_selected', value: '38', label: 'Candidates Selected', type: 'number' },\r\n    ];\r\n\r\n    for (const setting of defaults) {\r\n      await this.prisma.siteSettings.upsert({\r\n        where: { key: setting.key },\r\n        create: setting,\r\n        update: {},\r\n      });\r\n    }\r\n\r\n    return { success: true, message: 'Default settings initialized' };\r\n  }\r\n}\r\n\r\n"],"names":["AdminService","getDashboardMetrics","totalUsers","totalCandidates","totalHRs","totalEmployees","totalJobs","activeJobs","totalPayments","totalRevenue","pendingRefunds","todayApplications","Promise","all","prisma","user","count","where","role","UserRole","CANDIDATE","HR","EMPLOYEE","job","status","JobStatus","ACTIVE","payment","PaymentStatus","SUCCESS","aggregate","_sum","amount","refund","RefundStatus","REQUESTED","jobApplication","createdAt","gte","Date","setHours","users","total","candidates","hrs","employees","jobs","active","revenue","totalAmount","activity","getAllUsers","page","limit","skip","findMany","take","include","Candidate","select","firstName","lastName","companyName","approvalStatus","Employee","referralCount","orderBy","data","meta","totalPages","Math","ceil","blockUser","userId","adminId","findUnique","id","NotFoundException","$transaction","tx","update","UserStatus","BLOCKED","auditLog","create","crypto","randomUUID","action","AuditAction","ADMIN_OVERRIDE","entityType","entityId","metadata","success","message","unblockUser","getPendingHRApprovals","hR","HRApprovalStatus","PENDING","User","email","approveHR","hrId","hr","APPROVED","approvedBy","approvedAt","rejectHR","reason","REJECTED","rejectionReason","getAllJobs","_count","JobApplication","approveJob","jobId","postedAt","expiresAt","now","expireJob","EXPIRED","createJob","jobData","baseSlug","title","toLowerCase","replace","randomSuffix","random","toString","substring","slug","newJob","description","location","salaryMin","salaryMax","experienceMin","experienceMax","referralFee","updatedAt","updateJob","updatedJob","changes","deleteJob","Interview","Payment","Refund","Referral","EmployeeEarning","TestSession","app","interview","delete","length","sessionIds","map","s","testAnswer","deleteMany","sessionId","in","testEvent","testSession","applicationId","employeeEarning","referral","jobSkill","jobTitle","getAllCandidates","search","OR","contains","mode","Job","deleteUser","SkillTestAttempt","ADMIN","BadRequestException","oTPToken","refreshToken","passwordResetToken","deviceLog","notification","updateMany","suspiciousActivity","skillTestAttempt","candidateId","candidate","employee","getAllApplications","applications","headline","totalExperience","paymentStatus","scheduledDate","updateApplicationStatus","newStatus","application","oldStatus","oldValue","newValue","getAllPayments","payments","getPendingRefunds","approveRefund","refundId","notes","processedBy","processedAt","adminNotes","paymentId","REFUNDED","REFUND_PROCESSED","rejectRefund","getAuditLogs","logs","getAllInterviews","interviews","getInterviewStats","interviewConfirmed","paymentSuccess","completed","candidateNoShow","hrNoShow","cancelled","totalCompleted","noShowRate","toFixed","byStatus","completionRate","updateInterviewStatus","interviewId","updateData","completedAt","markInterviewCompleted","markInterviewNoShow","noShowType","noShowStatus","getAllSkillBuckets","includeInactive","buckets","skillBucket","isActive","Test","duration","totalQuestions","TestTemplate","name","passingCriteria","questionPoolSize","selectionRoleType","JobRequiredSkillBucket","code","bucketsWithQuestionCount","bucket","roleType","availableQuestions","questionBank","createSkillBucket","existing","displayName","testId","connect","testTemplateId","CREATE","updateSkillBucket","updated","UPDATE","deleteSkillBucket","DELETE","addSkillRequirementToJob","skillBucketId","requirement","jobRequiredSkillBucket","upsert","jobId_skillBucketId","SkillBucket","skillBucketCode","removeSkillRequirementFromJob","getJobSkillRequirements","displayOrder","legacySkillBucket","compositeRequirements","updatePaymentStatus","paidAt","issueManualRefund","getRevenueReport","startDate","endDate","dateFilter","lte","Object","keys","currency","reduce","sum","p","refunds","netRevenue","dailyRevenue","dateKey","toISOString","split","summary","totalRefunds","transactionCount","dailyBreakdown","entries","date","getEnhancedAnalytics","activeUsers","blockedUsers","totalTestAttempts","passedTests","failedTests","totalInterviews","completedInterviews","scheduledInterviews","successfulPayments","refundedPayments","isPassed","testPassRate","interviewCompletionRate","tests","totalAttempts","passed","failed","passRate","scheduled","successful","refunded","manuallyPassTest","validityDays","validTill","getTime","attempt","score","retestAllowedAt","manuallyFailTest","extendTestValidity","attemptId","newValidTill","oldValidTill","resetRetestCooldown","oldRetestAllowedAt","getSuspiciousActivities","isReviewed","activityType","undefined","activities","reviewSuspiciousActivity","activityId","reviewedBy","reviewedAt","reviewNotes","userBlocked","getHRFraudMetrics","thirtyDaysAgo","hrStats","metrics","allInterviews","flatMap","filter","Boolean","cancelledCount","i","noShowCount","userStatus","cancellationRate","isFlagged","flaggedHRs","m","allMetrics","sort","a","b","getAllTestimonials","testimonials","testimonial","getPublicTestimonials","createTestimonial","candidateName","company","interviewDate","quote","imageUrl","rating","updateTestimonial","updatedTestimonial","deleteTestimonial","toggleTestimonialStatus","getAllSettings","settings","siteSettings","key","settingsMap","forEach","value","getPublicSettings","result","interviewsScheduled","candidatesSelected","parseInt","updateSetting","label","setting","type","initializeDefaultSettings","defaults"],"mappings":"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"}