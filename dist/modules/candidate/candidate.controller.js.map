{"version":3,"sources":["../../../src/modules/candidate/candidate.controller.ts"],"sourcesContent":["import {\r\n  Controller,\r\n  Get,\r\n  Patch,\r\n  Post,\r\n  Delete,\r\n  Body,\r\n  Param,\r\n  Query,\r\n  UseInterceptors,\r\n  UploadedFile,\r\n  BadRequestException,\r\n} from '@nestjs/common';\r\nimport { FileInterceptor } from '@nestjs/platform-express';\r\nimport { CandidateService } from './candidate.service';\r\nimport {\r\n  UpdateCandidateProfileDto,\r\n  AddSkillDto,\r\n  AddExperienceDto,\r\n  AddEducationDto,\r\n} from './dto';\r\nimport { CurrentUser, Roles } from '../../common/decorators';\r\nimport { UserRole, ApplicationStatus } from '../../common/constants';\r\nimport { CloudinaryService } from '../cloudinary/cloudinary.service';\r\nimport { ResumeParserService } from '../resume-parser/resume-parser.service';\r\n\r\n@Controller('candidates')\r\n@Roles(UserRole.CANDIDATE)\r\nexport class CandidateController {\r\n  constructor(\r\n    private readonly candidateService: CandidateService,\r\n    private readonly cloudinaryService: CloudinaryService,\r\n    private readonly resumeParserService: ResumeParserService,\r\n  ) { }\r\n\r\n  @Get('me')\r\n  async getMe(@CurrentUser('sub') userId: string) {\r\n    return this.candidateService.getProfile(userId);\r\n  }\r\n\r\n  @Get('profile')\r\n  async getProfile(@CurrentUser('sub') userId: string) {\r\n    return this.candidateService.getProfile(userId);\r\n  }\r\n\r\n  @Patch('profile')\r\n  async updateProfile(\r\n    @CurrentUser('sub') userId: string,\r\n    @Body() dto: UpdateCandidateProfileDto,\r\n  ) {\r\n    return this.candidateService.updateProfile(userId, dto);\r\n  }\r\n\r\n  @Post('resume')\r\n  @UseInterceptors(\r\n    FileInterceptor('resume', {\r\n      limits: { fileSize: 5 * 1024 * 1024 }, // 5MB max\r\n      fileFilter: (req, file, cb) => {\r\n        const allowedMimes = [\r\n          'application/pdf',\r\n          'application/msword',\r\n          'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\r\n        ];\r\n        if (allowedMimes.includes(file.mimetype)) {\r\n          cb(null, true);\r\n        } else {\r\n          cb(\r\n            new BadRequestException('Only PDF and DOC/DOCX files are allowed'),\r\n            false,\r\n          );\r\n        }\r\n      },\r\n    }),\r\n  )\r\n  async uploadResume(\r\n    @CurrentUser('sub') userId: string,\r\n    @UploadedFile() file: Express.Multer.File,\r\n  ) {\r\n    if (!file) {\r\n      throw new BadRequestException('Resume file is required');\r\n    }\r\n\r\n    // Upload to Cloudinary\r\n    const { url, publicId } = await this.cloudinaryService.uploadResume(\r\n      file,\r\n      userId,\r\n    );\r\n\r\n    // Parse resume to extract skills, experience, education\r\n    const parsedData = await this.resumeParserService.parseResume(file);\r\n\r\n    // Update candidate with resume URL and parsed data\r\n    const candidate = await this.candidateService.updateResumeWithParsedData(\r\n      userId,\r\n      url,\r\n      publicId,\r\n      parsedData,\r\n    );\r\n\r\n    return {\r\n      resumeUrl: url,\r\n      fileName: file.originalname,\r\n      parsedData: {\r\n        JobSkill: parsedData.JobSkill,\r\n        experience: parsedData.experience,\r\n        education: parsedData.education,\r\n      },\r\n      candidate,\r\n    };\r\n  }\r\n\r\n  @Post('skills')\r\n  async addSkill(@CurrentUser('sub') userId: string, @Body() dto: AddSkillDto) {\r\n    return this.candidateService.addSkill(userId, dto);\r\n  }\r\n\r\n  @Delete('skills/:id')\r\n  async removeSkill(\r\n    @CurrentUser('sub') userId: string,\r\n    @Param('id') skillId: string,\r\n  ) {\r\n    return this.candidateService.removeSkill(userId, skillId);\r\n  }\r\n\r\n  @Post('experiences')\r\n  async addExperience(\r\n    @CurrentUser('sub') userId: string,\r\n    @Body() dto: AddExperienceDto,\r\n  ) {\r\n    return this.candidateService.addExperience(userId, dto);\r\n  }\r\n\r\n  @Delete('experiences/:id')\r\n  async removeExperience(\r\n    @CurrentUser('sub') userId: string,\r\n    @Param('id') experienceId: string,\r\n  ) {\r\n    return this.candidateService.removeExperience(userId, experienceId);\r\n  }\r\n\r\n  @Post('educations')\r\n  async addEducation(\r\n    @CurrentUser('sub') userId: string,\r\n    @Body() dto: AddEducationDto,\r\n  ) {\r\n    return this.candidateService.addEducation(userId, dto);\r\n  }\r\n\r\n  @Delete('educations/:id')\r\n  async removeEducation(\r\n    @CurrentUser('sub') userId: string,\r\n    @Param('id') educationId: string,\r\n  ) {\r\n    return this.candidateService.removeEducation(userId, educationId);\r\n  }\r\n\r\n  @Get('applications')\r\n  async getApplications(\r\n    @CurrentUser('sub') userId: string,\r\n    @Query('status') status?: string,\r\n  ) {\r\n    return this.candidateService.getApplications(userId, status as ApplicationStatus | undefined);\r\n  }\r\n\r\n  @Patch('applications/:id/withdraw')\r\n  async withdrawApplication(\r\n    @CurrentUser('sub') userId: string,\r\n    @Param('id') applicationId: string,\r\n  ) {\r\n    return this.candidateService.withdrawApplication(userId, applicationId);\r\n  }\r\n\r\n  @Get('tests')\r\n  async getTestHistory(@CurrentUser('sub') userId: string) {\r\n    return this.candidateService.getTestHistory(userId);\r\n  }\r\n\r\n  @Get('payments')\r\n  async getPaymentHistory(@CurrentUser('sub') userId: string) {\r\n    return this.candidateService.getPaymentHistory(userId);\r\n  }\r\n}\r\n"],"names":["CandidateController","getMe","userId","candidateService","getProfile","updateProfile","dto","uploadResume","file","BadRequestException","url","publicId","cloudinaryService","parsedData","resumeParserService","parseResume","candidate","updateResumeWithParsedData","resumeUrl","fileName","originalname","JobSkill","experience","education","addSkill","removeSkill","skillId","addExperience","removeExperience","experienceId","addEducation","removeEducation","educationId","getApplications","status","withdrawApplication","applicationId","getTestHistory","getPaymentHistory","limits","fileSize","fileFilter","req","cb","allowedMimes","includes","mimetype","CANDIDATE"],"mappings":"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"}