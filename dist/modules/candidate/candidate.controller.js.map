{"version":3,"sources":["../../../src/modules/candidate/candidate.controller.ts"],"sourcesContent":["import {\r\n    Controller,\r\n    Get,\r\n    Patch,\r\n    Post,\r\n    Delete,\r\n    Body,\r\n    Param,\r\n    Query,\r\n    UseInterceptors,\r\n    UploadedFile,\r\n    BadRequestException,\r\n} from '@nestjs/common';\r\nimport { FileInterceptor } from '@nestjs/platform-express';\r\nimport { CandidateService } from './candidate.service';\r\nimport {\r\n    UpdateCandidateProfileDto,\r\n    AddSkillDto,\r\n    AddExperienceDto,\r\n    AddEducationDto,\r\n} from './dto';\r\nimport { CurrentUser, Roles } from '../../common/decorators';\r\nimport { UserRole, ApplicationStatus } from '../../common/constants';\r\nimport { CloudinaryService } from '../cloudinary/cloudinary.service';\r\nimport { ResumeParserService } from '../resume-parser/resume-parser.service';\r\n\r\n@Controller('candidates')\r\n@Roles(UserRole.CANDIDATE)\r\nexport class CandidateController {\r\n    constructor(\r\n        private readonly candidateService: CandidateService,\r\n        private readonly cloudinaryService: CloudinaryService,\r\n        private readonly resumeParserService: ResumeParserService,\r\n    ) { }\r\n\r\n    @Get('profile')\r\n    async getProfile(@CurrentUser('sub') userId: string) {\r\n        return this.candidateService.getProfile(userId);\r\n    }\r\n\r\n    @Patch('profile')\r\n    async updateProfile(\r\n        @CurrentUser('sub') userId: string,\r\n        @Body() dto: UpdateCandidateProfileDto,\r\n    ) {\r\n        return this.candidateService.updateProfile(userId, dto);\r\n    }\r\n\r\n    @Post('resume')\r\n    @UseInterceptors(FileInterceptor('resume', {\r\n        limits: { fileSize: 5 * 1024 * 1024 }, // 5MB max\r\n        fileFilter: (req, file, cb) => {\r\n            const allowedMimes = [\r\n                'application/pdf',\r\n                'application/msword',\r\n                'application/vnd.openxmlformats-officedocument.wordprocessingml.document'\r\n            ];\r\n            if (allowedMimes.includes(file.mimetype)) {\r\n                cb(null, true);\r\n            } else {\r\n                cb(new BadRequestException('Only PDF and DOC/DOCX files are allowed'), false);\r\n            }\r\n        }\r\n    }))\r\n    async uploadResume(\r\n        @CurrentUser('sub') userId: string,\r\n        @UploadedFile() file: Express.Multer.File,\r\n    ) {\r\n        if (!file) {\r\n            throw new BadRequestException('Resume file is required');\r\n        }\r\n\r\n        // Upload to Cloudinary\r\n        const { url, publicId } = await this.cloudinaryService.uploadResume(file, userId);\r\n\r\n        // Parse resume to extract skills, experience, education\r\n        const parsedData = await this.resumeParserService.parseResume(file);\r\n\r\n        // Update candidate with resume URL and parsed data\r\n        const candidate = await this.candidateService.updateResumeWithParsedData(\r\n            userId,\r\n            url,\r\n            publicId,\r\n            parsedData,\r\n        );\r\n\r\n        return {\r\n            resumeUrl: url,\r\n            fileName: file.originalname,\r\n            parsedData: {\r\n                JobSkill: parsedData.JobSkill,\r\n                experience: parsedData.experience,\r\n                education: parsedData.education,\r\n            },\r\n            candidate,\r\n        };\r\n    }\r\n\r\n    @Post('skills')\r\n    async addSkill(@CurrentUser('sub') userId: string, @Body() dto: AddSkillDto) {\r\n        return this.candidateService.addSkill(userId, dto);\r\n    }\r\n\r\n    @Delete('skills/:id')\r\n    async removeSkill(\r\n        @CurrentUser('sub') userId: string,\r\n        @Param('id') skillId: string,\r\n    ) {\r\n        return this.candidateService.removeSkill(userId, skillId);\r\n    }\r\n\r\n    @Post('experiences')\r\n    async addExperience(\r\n        @CurrentUser('sub') userId: string,\r\n        @Body() dto: AddExperienceDto,\r\n    ) {\r\n        return this.candidateService.addExperience(userId, dto);\r\n    }\r\n\r\n    @Delete('experiences/:id')\r\n    async removeExperience(\r\n        @CurrentUser('sub') userId: string,\r\n        @Param('id') experienceId: string,\r\n    ) {\r\n        return this.candidateService.removeExperience(userId, experienceId);\r\n    }\r\n\r\n    @Post('educations')\r\n    async addEducation(\r\n        @CurrentUser('sub') userId: string,\r\n        @Body() dto: AddEducationDto,\r\n    ) {\r\n        return this.candidateService.addEducation(userId, dto);\r\n    }\r\n\r\n    @Delete('educations/:id')\r\n    async removeEducation(\r\n        @CurrentUser('sub') userId: string,\r\n        @Param('id') educationId: string,\r\n    ) {\r\n        return this.candidateService.removeEducation(userId, educationId);\r\n    }\r\n\r\n    @Get('applications')\r\n    async getApplications(\r\n        @CurrentUser('sub') userId: string,\r\n        @Query('status') status?: ApplicationStatus,\r\n    ) {\r\n        return this.candidateService.getApplications(userId, status);\r\n    }\r\n\r\n    @Get('tests')\r\n    async getTestHistory(@CurrentUser('sub') userId: string) {\r\n        return this.candidateService.getTestHistory(userId);\r\n    }\r\n\r\n    @Get('payments')\r\n    async getPaymentHistory(@CurrentUser('sub') userId: string) {\r\n        return this.candidateService.getPaymentHistory(userId);\r\n    }\r\n}\r\n"],"names":["CandidateController","getProfile","userId","candidateService","updateProfile","dto","uploadResume","file","BadRequestException","url","publicId","cloudinaryService","parsedData","resumeParserService","parseResume","candidate","updateResumeWithParsedData","resumeUrl","fileName","originalname","JobSkill","experience","education","addSkill","removeSkill","skillId","addExperience","removeExperience","experienceId","addEducation","removeEducation","educationId","getApplications","status","getTestHistory","getPaymentHistory","limits","fileSize","fileFilter","req","cb","allowedMimes","includes","mimetype","CANDIDATE"],"mappings":"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"}