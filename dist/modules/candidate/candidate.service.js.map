{"version":3,"sources":["../../../src/modules/candidate/candidate.service.ts"],"sourcesContent":["import { Injectable, NotFoundException, BadRequestException } from '@nestjs/common';\r\nimport { PrismaService } from '../../prisma/prisma.service';\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport {\r\n    UpdateCandidateProfileDto,\r\n    AddSkillDto,\r\n    AddExperienceDto,\r\n    AddEducationDto,\r\n} from './dto';\r\nimport { ApplicationStatus } from '../../common/constants';\r\n\r\n@Injectable()\r\nexport class CandidateService {\r\n    constructor(private prisma: PrismaService) { }\r\n\r\n    // Get candidate profile\r\n    async getProfile(userId: string) {\r\n        const candidate = await this.prisma.candidate.findUnique({\r\n            where: { userId },\r\n            include: {\r\n                CandidateSkill: true,\r\n                Experience: {\r\n                    orderBy: { startDate: 'desc' },\r\n                },\r\n                Education: {\r\n                    orderBy: { startYear: 'desc' },\r\n                },\r\n                User: {\r\n                    select: {\r\n                        email: true,\r\n                        phone: true,\r\n                        emailVerified: true,\r\n                        phoneVerified: true,\r\n                    },\r\n                },\r\n            },\r\n        });\r\n\r\n        if (!candidate) {\r\n            throw new NotFoundException('Candidate profile not found');\r\n        }\r\n\r\n        return candidate;\r\n    }\r\n\r\n    // Update profile\r\n    async updateProfile(userId: string, dto: UpdateCandidateProfileDto) {\r\n        const candidate = await this.prisma.candidate.findUnique({\r\n            where: { userId },\r\n        });\r\n\r\n        if (!candidate) {\r\n            throw new NotFoundException('Candidate profile not found');\r\n        }\r\n\r\n        // Extract phone from DTO (phone is stored in User table)\r\n        const { phone, linkedIn, ...candidateData } = dto;\r\n\r\n        // Use transaction to update both User and Candidate\r\n        const result = await this.prisma.$transaction(async (tx) => {\r\n            // Update phone in User table if provided\r\n            if (phone !== undefined) {\r\n                await tx.user.update({\r\n                    where: { id: userId },\r\n                    data: { phone },\r\n                });\r\n            }\r\n\r\n            // Update candidate data (including linkedIn)\r\n            const updatedCandidate = await tx.candidate.update({\r\n                where: { userId },\r\n                data: {\r\n                    ...candidateData,\r\n                    linkedIn,\r\n                },\r\n                include: {\r\n                    CandidateSkill: true,\r\n                    Experience: true,\r\n                    Education: true,\r\n                    User: {\r\n                        select: {\r\n                            email: true,\r\n                            phone: true,\r\n                        },\r\n                    },\r\n                },\r\n            });\r\n\r\n            return updatedCandidate;\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    // Upload resume\r\n    async updateResume(userId: string, resumeUrl: string) {\r\n        return this.prisma.candidate.update({\r\n            where: { userId },\r\n            data: { resumeUrl },\r\n        });\r\n    }\r\n\r\n    // Upload resume with parsed data from Cloudinary\r\n    async updateResumeWithParsedData(\r\n        userId: string,\r\n        resumeUrl: string,\r\n        cloudinaryPublicId: string,\r\n        parsedData: {\r\n            JobSkill: string[];\r\n            experience: { years: number; positions: string[] };\r\n            education: string[];\r\n        },\r\n    ) {\r\n        const candidate = await this.prisma.candidate.findUnique({\r\n            where: { userId },\r\n        });\r\n\r\n        if (!candidate) {\r\n            throw new NotFoundException('Candidate profile not found');\r\n        }\r\n\r\n        // Update candidate with resume URL\r\n        const updatedCandidate = await this.prisma.candidate.update({\r\n            where: { userId },\r\n            data: {\r\n                resumeUrl,\r\n                // Store Cloudinary public ID for future deletion\r\n                // You may want to add this field to your schema\r\n            },\r\n        });\r\n\r\n        // Auto-add parsed skills if they don't exist\r\n        for (const skillName of parsedData.jobSkill.slice(0, 10)) { // Limit to 10 skills\r\n            const existingSkill = await this.prisma.candidateSkill.findFirst({\r\n                where: {\r\n                    candidateId: candidate.id,\r\n                    name: { equals: skillName, mode: 'insensitive' },\r\n                },\r\n            });\r\n\r\n            if (!existingSkill) {\r\n                await this.prisma.candidateSkill.create({\r\n                    data: {\r\n                        candidateId: candidate.id,\r\n                        name: skillName,\r\n                        level: 3, // Default mid-level\r\n                    },\r\n                });\r\n            }\r\n        }\r\n\r\n        return this.prisma.candidate.findUnique({\r\n            where: { userId },\r\n            include: {\r\n                CandidateSkill: true,\r\n                Experience: true,\r\n                Education: true,\r\n            },\r\n        });\r\n    }\r\n\r\n    // Add skill\r\n    async addSkill(userId: string, dto: AddSkillDto) {\r\n        console.log(`Adding skill for user ${userId}:`, dto);\r\n        try {\r\n            const candidate = await this.prisma.candidate.findUnique({\r\n                where: { userId },\r\n            });\r\n\r\n            if (!candidate) {\r\n                console.error(`Candidate profile not found for user ${userId}`);\r\n                throw new NotFoundException('Candidate profile not found');\r\n            }\r\n\r\n            // Use upsert to handle duplicates gracefully\r\n            return await this.prisma.candidateSkill.upsert({\r\n                where: {\r\n                    candidateId_name: {\r\n                        candidateId: candidate.id,\r\n                        name: dto.name,\r\n                    },\r\n                },\r\n                update: {\r\n                    level: dto.level || 1,\r\n                    yearsOfExp: dto.yearsOfExp,\r\n                },\r\n                create: {\r\n                    id: uuidv4(),\r\n                    candidateId: candidate.id,\r\n                    name: dto.name,\r\n                    level: dto.level || 1,\r\n                    yearsOfExp: dto.yearsOfExp,\r\n                },\r\n            });\r\n        } catch (error) {\r\n            console.error('Error adding skill:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    // Remove skill\r\n    async removeSkill(userId: string, skillId: string) {\r\n        const candidate = await this.prisma.candidate.findUnique({\r\n            where: { userId },\r\n        });\r\n\r\n        if (!candidate) {\r\n            throw new NotFoundException('Candidate profile not found');\r\n        }\r\n\r\n        return this.prisma.candidateSkill.delete({\r\n            where: {\r\n                id: skillId,\r\n                candidateId: candidate.id,\r\n            },\r\n        });\r\n    }\r\n\r\n    // Add experience\r\n    async addExperience(userId: string, dto: AddExperienceDto) {\r\n        const candidate = await this.prisma.candidate.findUnique({\r\n            where: { userId },\r\n        });\r\n\r\n        if (!candidate) {\r\n            throw new NotFoundException('Candidate profile not found');\r\n        }\r\n\r\n        return this.prisma.experience.create({\r\n            data: {\r\n                candidateId: candidate.id,\r\n                company: dto.company,\r\n                role: dto.role,\r\n                description: dto.description,\r\n                location: dto.location,\r\n                startDate: new Date(dto.startDate),\r\n                endDate: dto.endDate ? new Date(dto.endDate) : null,\r\n                isCurrent: dto.isCurrent || false,\r\n            },\r\n        });\r\n    }\r\n\r\n    // Remove experience\r\n    async removeExperience(userId: string, experienceId: string) {\r\n        const candidate = await this.prisma.candidate.findUnique({\r\n            where: { userId },\r\n        });\r\n\r\n        if (!candidate) {\r\n            throw new NotFoundException('Candidate profile not found');\r\n        }\r\n\r\n        return this.prisma.experience.delete({\r\n            where: {\r\n                id: experienceId,\r\n                candidateId: candidate.id,\r\n            },\r\n        });\r\n    }\r\n\r\n    // Add education\r\n    async addEducation(userId: string, dto: AddEducationDto) {\r\n        const candidate = await this.prisma.candidate.findUnique({\r\n            where: { userId },\r\n        });\r\n\r\n        if (!candidate) {\r\n            throw new NotFoundException('Candidate profile not found');\r\n        }\r\n\r\n        return this.prisma.education.create({\r\n            data: {\r\n                candidateId: candidate.id,\r\n                institution: dto.institution,\r\n                degree: dto.degree,\r\n                field: dto.field,\r\n                grade: dto.grade,\r\n                startYear: dto.startYear,\r\n                endYear: dto.endYear,\r\n            },\r\n        });\r\n    }\r\n\r\n    // Remove education\r\n    async removeEducation(userId: string, educationId: string) {\r\n        const candidate = await this.prisma.candidate.findUnique({\r\n            where: { userId },\r\n        });\r\n\r\n        if (!candidate) {\r\n            throw new NotFoundException('Candidate profile not found');\r\n        }\r\n\r\n        return this.prisma.education.delete({\r\n            where: {\r\n                id: educationId,\r\n                candidateId: candidate.id,\r\n            },\r\n        });\r\n    }\r\n\r\n    // Get applications\r\n    async getApplications(userId: string, status?: ApplicationStatus) {\r\n        const candidate = await this.prisma.candidate.findUnique({\r\n            where: { userId },\r\n        });\r\n\r\n        if (!candidate) {\r\n            throw new NotFoundException('Candidate profile not found');\r\n        }\r\n\r\n        return this.prisma.jobApplication.findMany({\r\n            where: {\r\n                candidateId: candidate.id,\r\n                ...(status && { status }),\r\n            },\r\n            include: {\r\n                Job: {\r\n                    select: {\r\n                        id: true,\r\n                        title: true,\r\n                        companyName: true,\r\n                        location: true,\r\n                        salaryMin: true,\r\n                        salaryMax: true,\r\n                        status: true,\r\n                    },\r\n                },\r\n                Referral: {\r\n                    select: {\r\n                        status: true,\r\n                        type: true,\r\n                    },\r\n                },\r\n                Payment: {\r\n                    select: {\r\n                        status: true,\r\n                        amount: true,\r\n                        paidAt: true,\r\n                    },\r\n                },\r\n                Interview: {\r\n                    select: {\r\n                        id: true,\r\n                        status: true,\r\n                        paymentStatus: true,\r\n                        scheduledAt: true,\r\n                        scheduledDate: true,\r\n                        scheduledTime: true,\r\n                        mode: true,\r\n                        hrNotes: true,\r\n                        interviewLink: true,\r\n                        callDetails: true,\r\n                        paidAt: true,\r\n                    },\r\n                },\r\n                TestSession: {\r\n                    select: {\r\n                        id: true,\r\n                        status: true,\r\n                        score: true,\r\n                        isPassed: true,\r\n                        submittedAt: true,\r\n                    },\r\n                    take: 1,\r\n                    orderBy: { createdAt: 'desc' },\r\n                },\r\n            },\r\n            orderBy: { createdAt: 'desc' },\r\n        });\r\n    }\r\n\r\n    // Get test history\r\n    async getTestHistory(userId: string) {\r\n        const candidate = await this.prisma.candidate.findUnique({\r\n            where: { userId },\r\n        });\r\n\r\n        if (!candidate) {\r\n            throw new NotFoundException('Candidate profile not found');\r\n        }\r\n\r\n        const applications = await this.prisma.jobApplication.findMany({\r\n            where: { candidateId: candidate.id },\r\n            select: { id: true },\r\n        });\r\n\r\n        const applicationIds = applications.map((a) => a.id);\r\n\r\n        return this.prisma.testSession.findMany({\r\n            where: {\r\n                applicationId: { in: applicationIds },\r\n            },\r\n            include: {\r\n                Test: {\r\n                    select: {\r\n                        title: true,\r\n                        duration: true,\r\n                        passingScore: true,\r\n                    },\r\n                },\r\n                JobApplication: {\r\n                    include: {\r\n                        Job: {\r\n                            select: {\r\n                                title: true,\r\n                                companyName: true,\r\n                            },\r\n                        },\r\n                    },\r\n                },\r\n            },\r\n            orderBy: { createdAt: 'desc' },\r\n        });\r\n    }\r\n\r\n    // Get payment history\r\n    async getPaymentHistory(userId: string) {\r\n        const candidate = await this.prisma.candidate.findUnique({\r\n            where: { userId },\r\n        });\r\n\r\n        if (!candidate) {\r\n            throw new NotFoundException('Candidate profile not found');\r\n        }\r\n\r\n        const applications = await this.prisma.jobApplication.findMany({\r\n            where: { candidateId: candidate.id },\r\n            select: { id: true },\r\n        });\r\n\r\n        const applicationIds = applications.map((a) => a.id);\r\n\r\n        return this.prisma.payment.findMany({\r\n            where: {\r\n                applicationId: { in: applicationIds },\r\n            },\r\n            include: {\r\n                JobApplication: {\r\n                    include: {\r\n                        Job: {\r\n                            select: {\r\n                                title: true,\r\n                                companyName: true,\r\n                            },\r\n                        },\r\n                    },\r\n                },\r\n                Refund: true,\r\n            },\r\n            orderBy: { createdAt: 'desc' },\r\n        });\r\n    }\r\n}\r\n"],"names":["CandidateService","getProfile","userId","candidate","prisma","findUnique","where","include","CandidateSkill","Experience","orderBy","startDate","Education","startYear","User","select","email","phone","emailVerified","phoneVerified","NotFoundException","updateProfile","dto","linkedIn","candidateData","result","$transaction","tx","undefined","user","update","id","data","updatedCandidate","updateResume","resumeUrl","updateResumeWithParsedData","cloudinaryPublicId","parsedData","skillName","jobSkill","slice","existingSkill","candidateSkill","findFirst","candidateId","name","equals","mode","create","level","addSkill","console","log","error","upsert","candidateId_name","yearsOfExp","uuidv4","removeSkill","skillId","delete","addExperience","experience","company","role","description","location","Date","endDate","isCurrent","removeExperience","experienceId","addEducation","education","institution","degree","field","grade","endYear","removeEducation","educationId","getApplications","status","jobApplication","findMany","Job","title","companyName","salaryMin","salaryMax","Referral","type","Payment","amount","paidAt","Interview","paymentStatus","scheduledAt","scheduledDate","scheduledTime","hrNotes","interviewLink","callDetails","TestSession","score","isPassed","submittedAt","take","createdAt","getTestHistory","applications","applicationIds","map","a","testSession","applicationId","in","Test","duration","passingScore","JobApplication","getPaymentHistory","payment","Refund"],"mappings":"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"}