{"version":3,"sources":["../../../src/modules/cloudinary/cloudinary.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\r\nimport { v2 as cloudinary } from 'cloudinary';\r\nimport { Readable } from 'stream';\r\n\r\n@Injectable()\r\nexport class CloudinaryService {\r\n    constructor() {\r\n        cloudinary.config({\r\n            cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\r\n            api_key: process.env.CLOUDINARY_API_KEY,\r\n            api_secret: process.env.CLOUDINARY_API_SECRET,\r\n        });\r\n    }\r\n\r\n    async uploadResume(\r\n        file: Express.Multer.File,\r\n        userId: string,\r\n    ): Promise<{ url: string; publicId: string }> {\r\n        return new Promise((resolve, reject) => {\r\n            const uploadStream = cloudinary.uploader.upload_stream(\r\n                {\r\n                    folder: `jobrefer/resumes/${userId}`,\r\n                    resource_type: 'raw', // For PDF/DOC files\r\n                    public_id: `resume_${Date.now()}`,\r\n                    overwrite: true,\r\n                },\r\n                (error, result) => {\r\n                    if (error) return reject(error);\r\n                    if (!result) return reject(new Error('Upload failed - no result'));\r\n                    resolve({\r\n                        url: result.secure_url,\r\n                        publicId: result.public_id,\r\n                    });\r\n                },\r\n            );\r\n\r\n            // Convert buffer to stream and pipe to Cloudinary\r\n            const bufferStream = new Readable();\r\n            bufferStream.push(file.buffer);\r\n            bufferStream.push(null);\r\n            bufferStream.pipe(uploadStream);\r\n        });\r\n    }\r\n\r\n    async deleteResume(publicId: string): Promise<void> {\r\n        await cloudinary.uploader.destroy(publicId, { resource_type: 'raw' });\r\n    }\r\n}\r\n"],"names":["CloudinaryService","uploadResume","file","userId","Promise","resolve","reject","uploadStream","cloudinary","uploader","upload_stream","folder","resource_type","public_id","Date","now","overwrite","error","result","Error","url","secure_url","publicId","bufferStream","Readable","push","buffer","pipe","deleteResume","destroy","config","cloud_name","process","env","CLOUDINARY_CLOUD_NAME","api_key","CLOUDINARY_API_KEY","api_secret","CLOUDINARY_API_SECRET"],"mappings":";;;;+BAKaA;;;eAAAA;;;wBALc;4BACM;wBACR;;;;;;;;;;AAGlB,IAAA,AAAMA,oBAAN,MAAMA;IAST,MAAMC,aACFC,IAAyB,EACzBC,MAAc,EAC4B;QAC1C,OAAO,IAAIC,QAAQ,CAACC,SAASC;YACzB,MAAMC,eAAeC,cAAU,CAACC,QAAQ,CAACC,aAAa,CAClD;gBACIC,QAAQ,CAAC,iBAAiB,EAAER,QAAQ;gBACpCS,eAAe;gBACfC,WAAW,CAAC,OAAO,EAAEC,KAAKC,GAAG,IAAI;gBACjCC,WAAW;YACf,GACA,CAACC,OAAOC;gBACJ,IAAID,OAAO,OAAOX,OAAOW;gBACzB,IAAI,CAACC,QAAQ,OAAOZ,OAAO,IAAIa,MAAM;gBACrCd,QAAQ;oBACJe,KAAKF,OAAOG,UAAU;oBACtBC,UAAUJ,OAAOL,SAAS;gBAC9B;YACJ;YAGJ,kDAAkD;YAClD,MAAMU,eAAe,IAAIC,gBAAQ;YACjCD,aAAaE,IAAI,CAACvB,KAAKwB,MAAM;YAC7BH,aAAaE,IAAI,CAAC;YAClBF,aAAaI,IAAI,CAACpB;QACtB;IACJ;IAEA,MAAMqB,aAAaN,QAAgB,EAAiB;QAChD,MAAMd,cAAU,CAACC,QAAQ,CAACoB,OAAO,CAACP,UAAU;YAAEV,eAAe;QAAM;IACvE;IAxCA,aAAc;QACVJ,cAAU,CAACsB,MAAM,CAAC;YACdC,YAAYC,QAAQC,GAAG,CAACC,qBAAqB;YAC7CC,SAASH,QAAQC,GAAG,CAACG,kBAAkB;YACvCC,YAAYL,QAAQC,GAAG,CAACK,qBAAqB;QACjD;IACJ;AAmCJ"}