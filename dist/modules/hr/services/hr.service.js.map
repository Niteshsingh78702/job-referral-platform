{"version":3,"sources":["../../../../src/modules/hr/services/hr.service.ts"],"sourcesContent":["import {\r\n  Injectable,\r\n  UnauthorizedException,\r\n  ConflictException,\r\n  BadRequestException,\r\n  NotFoundException,\r\n  ForbiddenException,\r\n} from '@nestjs/common';\r\nimport * as bcrypt from 'bcrypt';\r\nimport * as crypto from 'crypto';\r\nimport { PrismaService } from '../../../prisma/prisma.service';\r\nimport { TokenService, JwtPayload } from '../../auth/services/token.service';\r\nimport {\r\n  HRRegisterDto,\r\n  HRLoginDto,\r\n  UpdateHRProfileDto,\r\n  CreateJobDto,\r\n  UpdateJobStatusDto,\r\n  UpdateJobDto,\r\n} from '../dto';\r\nimport {\r\n  UserRole,\r\n  UserStatus,\r\n  HRApprovalStatus,\r\n  AuditAction,\r\n} from '../../../common/constants';\r\nimport { JobStatus as PrismaJobStatus } from '@prisma/client';\r\n\r\n// Rate limiting constants\r\nconst MAX_LOGIN_ATTEMPTS = 5;\r\nconst LOCKOUT_DURATION_MS = 15 * 60 * 1000; // 15 minutes\r\n\r\n@Injectable()\r\nexport class HRService {\r\n  constructor(\r\n    private prisma: PrismaService,\r\n    private tokenService: TokenService,\r\n  ) { }\r\n\r\n  /**\r\n   * Register a new HR account\r\n   * - Validates corporate email domain\r\n   * - Creates user with HR role\r\n   * - Creates HR profile with pending approval status (auto-approved for dev)\r\n   */\r\n  async register(dto: HRRegisterDto, deviceInfo?: any) {\r\n    // Check if email already exists\r\n    const existingUser = await this.prisma.user.findUnique({\r\n      where: { email: dto.email },\r\n    });\r\n\r\n    if (existingUser) {\r\n      throw new ConflictException('Email already registered');\r\n    }\r\n\r\n    // Check phone if provided\r\n    if (dto.phone) {\r\n      const existingPhone = await this.prisma.user.findUnique({\r\n        where: { phone: dto.phone },\r\n      });\r\n      if (existingPhone) {\r\n        throw new ConflictException('Phone number already registered');\r\n      }\r\n    }\r\n\r\n    // Check company email already registered as HR\r\n    const existingHR = await this.prisma.hR.findFirst({\r\n      where: { companyEmail: dto.companyEmail },\r\n    });\r\n\r\n    if (existingHR) {\r\n      throw new ConflictException('Company email already registered');\r\n    }\r\n\r\n    // Hash password\r\n    const passwordHash = await bcrypt.hash(dto.password, 12);\r\n\r\n    // Create user and HR profile in transaction\r\n    const result = await this.prisma.$transaction(async (tx) => {\r\n      // Create user with HR role\r\n      const user = await tx.user.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          email: dto.email,\r\n          phone: dto.phone,\r\n          passwordHash,\r\n          role: UserRole.HR,\r\n          status: UserStatus.ACTIVE, // Auto-activate for dev\r\n          emailVerified: true, // Auto-verify for dev\r\n          updatedAt: new Date(),\r\n        },\r\n      });\r\n\r\n      // Create HR profile - Auto-approved for development\r\n      const hr = await tx.hR.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: user.id,\r\n          companyName: dto.companyName,\r\n          companyEmail: dto.companyEmail,\r\n          companyWebsite: dto.companyWebsite,\r\n          designation: dto.designation,\r\n          linkedinUrl: dto.linkedinUrl,\r\n          approvalStatus: HRApprovalStatus.APPROVED, // Auto-approve for dev\r\n          approvedAt: new Date(),\r\n          updatedAt: new Date(),\r\n        },\r\n      });\r\n\r\n      // Log device\r\n      if (deviceInfo) {\r\n        await tx.deviceLog.create({\r\n          data: {\r\n            id: crypto.randomUUID(),\r\n            userId: user.id,\r\n            deviceId: deviceInfo.deviceId || 'unknown',\r\n            ipAddress: deviceInfo.ip || 'unknown',\r\n            userAgent: deviceInfo.userAgent,\r\n          },\r\n        });\r\n      }\r\n\r\n      // Create audit log\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: user.id,\r\n          action: AuditAction.CREATE,\r\n          entityType: 'HR',\r\n          entityId: hr.id,\r\n          metadata: { registrationSource: 'hr_portal' },\r\n        },\r\n      });\r\n\r\n      return { user, hr };\r\n    });\r\n\r\n    // Generate tokens\r\n    const payload: JwtPayload = {\r\n      sub: result.user.id,\r\n      email: result.user.email,\r\n      role: result.user.role,\r\n    };\r\n\r\n    const tokens = await this.tokenService.generateTokenPair(payload);\r\n\r\n    return {\r\n      ...tokens,\r\n      User: {\r\n        id: result.user.id,\r\n        email: result.user.email,\r\n        role: result.user.role,\r\n        HR: {\r\n          id: result.hr.id,\r\n          companyName: result.hr.companyName,\r\n          approvalStatus: result.hr.approvalStatus,\r\n        },\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Login for HR users\r\n   * - Implements rate limiting (5 attempts per 15 min)\r\n   * - Checks HR approval status\r\n   */\r\n  async login(dto: HRLoginDto, deviceInfo?: any) {\r\n    const user = await this.prisma.user.findUnique({\r\n      where: { email: dto.email },\r\n      include: { HR: true },\r\n    });\r\n\r\n    if (!user || !user.passwordHash) {\r\n      throw new UnauthorizedException('Invalid credentials');\r\n    }\r\n\r\n    if (user.role !== UserRole.HR) {\r\n      throw new UnauthorizedException('This login is for HR accounts only');\r\n    }\r\n\r\n    if (user.status === UserStatus.BLOCKED) {\r\n      throw new UnauthorizedException(\r\n        'Account is blocked. Please contact support.',\r\n      );\r\n    }\r\n\r\n    // Check HR approval status\r\n    if (!user.HR) {\r\n      throw new BadRequestException('HR profile not found');\r\n    }\r\n\r\n    if (user.HR.approvalStatus === HRApprovalStatus.PENDING) {\r\n      throw new ForbiddenException(\r\n        'Your account is pending approval. Please wait for admin verification.',\r\n      );\r\n    }\r\n\r\n    if (user.HR.approvalStatus === HRApprovalStatus.REJECTED) {\r\n      throw new ForbiddenException(\r\n        `Account rejected: ${user.HR.rejectionReason || 'Please contact support.'}`,\r\n      );\r\n    }\r\n\r\n    // Verify password\r\n    const isValid = await bcrypt.compare(dto.password, user.passwordHash);\r\n    if (!isValid) {\r\n      throw new UnauthorizedException('Invalid credentials');\r\n    }\r\n\r\n    // Update last login\r\n    await this.prisma.$transaction(async (tx) => {\r\n      await tx.user.update({\r\n        where: { id: user.id },\r\n        data: { lastLoginAt: new Date() },\r\n      });\r\n\r\n      // Log device\r\n      if (deviceInfo) {\r\n        await tx.deviceLog.create({\r\n          data: {\r\n            id: crypto.randomUUID(),\r\n            userId: user.id,\r\n            deviceId: deviceInfo.deviceId || 'unknown',\r\n            ipAddress: deviceInfo.ip || 'unknown',\r\n            userAgent: deviceInfo.userAgent,\r\n          },\r\n        });\r\n      }\r\n\r\n      // Audit log\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: user.id,\r\n          action: AuditAction.LOGIN,\r\n          entityType: 'HR',\r\n          entityId: user.HR!.id,\r\n          metadata: { ip: deviceInfo?.ip, portal: 'hr' },\r\n        },\r\n      });\r\n    });\r\n\r\n    // Generate tokens\r\n    const payload: JwtPayload = {\r\n      sub: user.id,\r\n      email: user.email,\r\n      role: user.role,\r\n    };\r\n\r\n    const tokens = await this.tokenService.generateTokenPair(payload);\r\n\r\n    return {\r\n      ...tokens,\r\n      User: {\r\n        id: user.id,\r\n        email: user.email,\r\n        role: user.role,\r\n        HR: {\r\n          id: user.HR.id,\r\n          companyName: user.HR.companyName,\r\n          designation: user.HR.designation,\r\n        },\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get HR profile with stats\r\n   */\r\n  async getProfile(userId: string) {\r\n    const user = await this.prisma.user.findUnique({\r\n      where: { id: userId },\r\n      include: {\r\n        HR: {\r\n          include: {\r\n            Job: {\r\n              select: {\r\n                id: true,\r\n                title: true,\r\n                status: true,\r\n                applicationCount: true,\r\n              },\r\n            },\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!user || !user.HR) {\r\n      throw new NotFoundException('HR profile not found');\r\n    }\r\n\r\n    const { passwordHash, ...userWithoutPassword } = user;\r\n    return userWithoutPassword;\r\n  }\r\n\r\n  /**\r\n   * Update HR profile\r\n   */\r\n  async updateProfile(userId: string, dto: UpdateHRProfileDto) {\r\n    const user = await this.prisma.user.findUnique({\r\n      where: { id: userId },\r\n      include: { HR: true },\r\n    });\r\n\r\n    if (!user || !user.HR) {\r\n      throw new NotFoundException('HR profile not found');\r\n    }\r\n\r\n    const updated = await this.prisma.hR.update({\r\n      where: { id: user.HR.id },\r\n      data: {\r\n        companyName: dto.companyName,\r\n        companyWebsite: dto.companyWebsite,\r\n        designation: dto.designation,\r\n        linkedinUrl: dto.linkedinUrl,\r\n      },\r\n    });\r\n\r\n    return updated;\r\n  }\r\n\r\n  /**\r\n   * Get dashboard statistics\r\n   */\r\n  async getDashboardStats(userId: string) {\r\n    const user = await this.prisma.user.findUnique({\r\n      where: { id: userId },\r\n      include: { HR: true },\r\n    });\r\n\r\n    if (!user || !user.HR) {\r\n      throw new NotFoundException('HR profile not found');\r\n    }\r\n\r\n    const hrId = user.HR.id;\r\n\r\n    // Get job stats\r\n    const jobs = await this.prisma.job.findMany({\r\n      where: { hrId },\r\n      include: {\r\n        JobApplication: {\r\n          select: {\r\n            id: true,\r\n            status: true,\r\n            createdAt: true,\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    const now = new Date();\r\n    const thirtyDaysAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);\r\n\r\n    const totalJobs = jobs.length;\r\n    const activeJobs = jobs.filter(\r\n      (j) => j.status === PrismaJobStatus.ACTIVE,\r\n    ).length;\r\n    const totalApplications = jobs.reduce(\r\n      (acc, j) => acc + j.JobApplication.length,\r\n      0,\r\n    );\r\n    const recentApplications = jobs.reduce(\r\n      (acc, j) =>\r\n        acc +\r\n        j.JobApplication.filter((a) => a.createdAt >= thirtyDaysAgo).length,\r\n      0,\r\n    );\r\n\r\n    const pendingReferrals = await this.prisma.referral.count({\r\n      where: {\r\n        hrId,\r\n        status: 'PENDING',\r\n      },\r\n    });\r\n\r\n    const confirmedReferrals = await this.prisma.referral.count({\r\n      where: {\r\n        hrId,\r\n        status: 'CONFIRMED',\r\n      },\r\n    });\r\n\r\n    return {\r\n      totalJobs,\r\n      activeJobs,\r\n      totalApplications,\r\n      recentApplications,\r\n      pendingReferrals,\r\n      confirmedReferrals,\r\n      jobsByStatus: {\r\n        draft: jobs.filter((j) => j.status === PrismaJobStatus.DRAFT).length,\r\n        active: activeJobs,\r\n        closed: jobs.filter((j) => j.status === PrismaJobStatus.CLOSED).length,\r\n        expired: jobs.filter((j) => j.status === PrismaJobStatus.EXPIRED)\r\n          .length,\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get recent activity for dashboard\r\n   */\r\n  async getRecentActivity(userId: string, limit: number = 10) {\r\n    const user = await this.prisma.user.findUnique({\r\n      where: { id: userId },\r\n      include: { HR: true },\r\n    });\r\n\r\n    if (!user || !user.HR) {\r\n      throw new NotFoundException('HR profile not found');\r\n    }\r\n\r\n    // Get recent applications on HR's jobs\r\n    const recentApplications = await this.prisma.jobApplication.findMany({\r\n      where: {\r\n        Job: { hrId: user.HR.id },\r\n      },\r\n      orderBy: { createdAt: 'desc' },\r\n      take: limit,\r\n      include: {\r\n        Candidate: {\r\n          select: {\r\n            firstName: true,\r\n            lastName: true,\r\n          },\r\n        },\r\n        Job: {\r\n          select: {\r\n            title: true,\r\n            companyName: true,\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    return recentApplications.map((app) => ({\r\n      id: app.id,\r\n      type: 'application',\r\n      Candidate: `${app.Candidate.firstName} ${app.Candidate.lastName}`,\r\n      jobTitle: app.Job.title,\r\n      status: app.status,\r\n      createdAt: app.createdAt,\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Get HR's jobs\r\n   */\r\n  async getJobs(\r\n    userId: string,\r\n    filters?: { status?: string; page?: number; limit?: number },\r\n  ) {\r\n    const user = await this.prisma.user.findUnique({\r\n      where: { id: userId },\r\n      include: { HR: true },\r\n    });\r\n\r\n    if (!user || !user.HR) {\r\n      throw new NotFoundException('HR profile not found');\r\n    }\r\n\r\n    const page = filters?.page || 1;\r\n    const limit = filters?.limit || 10;\r\n    const skip = (page - 1) * limit;\r\n\r\n    const where: any = { hrId: user.HR.id };\r\n    if (filters?.status) {\r\n      where.status = filters.status;\r\n    }\r\n\r\n    const [jobs, total] = await Promise.all([\r\n      this.prisma.job.findMany({\r\n        where,\r\n        skip,\r\n        take: limit,\r\n        orderBy: { createdAt: 'desc' },\r\n        include: {\r\n          _count: {\r\n            select: { JobApplication: true },\r\n          },\r\n          JobSkill: true,\r\n        },\r\n      }),\r\n      this.prisma.job.count({ where }),\r\n    ]);\r\n\r\n    return {\r\n      jobs,\r\n      pagination: {\r\n        page,\r\n        limit,\r\n        total,\r\n        totalPages: Math.ceil(total / limit),\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Create a new job posting\r\n   */\r\n  async createJob(userId: string, dto: CreateJobDto) {\r\n    const user = await this.prisma.user.findUnique({\r\n      where: { id: userId },\r\n      include: { HR: true },\r\n    });\r\n\r\n    if (!user || !user.HR) {\r\n      throw new NotFoundException('HR profile not found');\r\n    }\r\n\r\n    // Generate slug from title\r\n    const baseSlug = dto.title\r\n      .toLowerCase()\r\n      .replace(/[^a-z0-9]+/g, '-')\r\n      .replace(/^-|-$/g, '');\r\n    const randomSuffix = Math.random().toString(36).substring(2, 8);\r\n    const slug = `${baseSlug}-${randomSuffix}`;\r\n\r\n    const job = await this.prisma.$transaction(async (tx) => {\r\n      const newJob = await tx.job.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          slug,\r\n          title: dto.title,\r\n          description: dto.description,\r\n          requirements: dto.requirements,\r\n          responsibilities: dto.responsibilities,\r\n          companyName: user.HR!.companyName,\r\n          location: dto.location,\r\n          isRemote: dto.isRemote ?? false,\r\n          salaryMin: dto.salaryMin,\r\n          salaryMax: dto.salaryMax,\r\n          experienceMin: dto.experienceMin,\r\n          experienceMax: dto.experienceMax,\r\n          educationLevel: dto.educationLevel,\r\n          maxApplications: dto.maxApplications ?? 100, // Ensure field name matches schema\r\n          referralFee: dto.referralFee ?? 499,\r\n          status: PrismaJobStatus.DRAFT,\r\n          hrId: user.HR!.id,\r\n          updatedAt: new Date(),\r\n        },\r\n      });\r\n\r\n      // Add skills\r\n      if (dto.skills && dto.skills.length > 0) {\r\n        await tx.jobSkill.createMany({\r\n          data: dto.skills.map((skill: string) => ({\r\n            id: crypto.randomUUID(),\r\n            jobId: newJob.id,\r\n            name: skill,\r\n            isRequired: true,\r\n          })),\r\n        });\r\n      }\r\n\r\n      // Update HR stats\r\n      await tx.hR.update({\r\n        where: { id: user.HR!.id },\r\n        data: { totalJobsPosted: { increment: 1 } },\r\n      });\r\n\r\n      // Audit log\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: user.id,\r\n          action: AuditAction.CREATE,\r\n          entityType: 'Job',\r\n          entityId: newJob.id,\r\n        },\r\n      });\r\n\r\n      return newJob;\r\n    });\r\n\r\n    return job;\r\n  }\r\n\r\n  /**\r\n   * Update job status (publish, close, etc.)\r\n   */\r\n  async updateJobStatus(\r\n    userId: string,\r\n    jobId: string,\r\n    dto: UpdateJobStatusDto,\r\n  ) {\r\n    const user = await this.prisma.user.findUnique({\r\n      where: { id: userId },\r\n      include: { HR: true },\r\n    });\r\n\r\n    if (!user || !user.HR) {\r\n      throw new NotFoundException('HR profile not found');\r\n    }\r\n\r\n    const job = await this.prisma.job.findUnique({\r\n      where: { id: jobId },\r\n    });\r\n\r\n    if (!job) {\r\n      throw new NotFoundException('Job not found');\r\n    }\r\n\r\n    if (job.hrId !== user.HR.id) {\r\n      throw new ForbiddenException('You can only modify your own jobs');\r\n    }\r\n\r\n    const newStatus = dto.status as PrismaJobStatus;\r\n    const originalStatus = job.status;\r\n\r\n    const updatedJob = await this.prisma.$transaction(async (tx) => {\r\n      const updated = await tx.job.update({\r\n        where: { id: jobId },\r\n        data: {\r\n          status: newStatus,\r\n          postedAt:\r\n            newStatus === PrismaJobStatus.ACTIVE ? new Date() : undefined,\r\n        },\r\n      });\r\n\r\n      // Update active jobs count\r\n      if (\r\n        newStatus === PrismaJobStatus.ACTIVE &&\r\n        originalStatus !== PrismaJobStatus.ACTIVE\r\n      ) {\r\n        await tx.hR.update({\r\n          where: { id: user.HR!.id },\r\n          data: { activeJobs: { increment: 1 } },\r\n        });\r\n      } else if (\r\n        originalStatus === PrismaJobStatus.ACTIVE &&\r\n        newStatus !== PrismaJobStatus.ACTIVE\r\n      ) {\r\n        await tx.hR.update({\r\n          where: { id: user.HR!.id },\r\n          data: { activeJobs: { decrement: 1 } },\r\n        });\r\n      }\r\n\r\n      // Audit log\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: user.id,\r\n          action: AuditAction.UPDATE,\r\n          entityType: 'Job',\r\n          entityId: jobId,\r\n          oldValue: { status: job.status },\r\n          newValue: { status: dto.status },\r\n        },\r\n      });\r\n\r\n      return updated;\r\n    });\r\n\r\n    return updatedJob;\r\n  }\r\n\r\n  /**\r\n   * Get a single job by ID\r\n   */\r\n  async getJobById(userId: string, jobId: string) {\r\n    const user = await this.prisma.user.findUnique({\r\n      where: { id: userId },\r\n      include: { HR: true },\r\n    });\r\n\r\n    if (!user || !user.HR) {\r\n      throw new NotFoundException('HR profile not found');\r\n    }\r\n\r\n    const job = await this.prisma.job.findUnique({\r\n      where: { id: jobId },\r\n      include: {\r\n        JobSkill: true,\r\n        JobApplication: {\r\n          select: {\r\n            id: true,\r\n            status: true,\r\n            createdAt: true,\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!job) {\r\n      throw new NotFoundException('Job not found');\r\n    }\r\n\r\n    if (job.hrId !== user.HR.id) {\r\n      throw new ForbiddenException('You can only view your own jobs');\r\n    }\r\n\r\n    return job;\r\n  }\r\n\r\n  /**\r\n   * Update a job (full edit)\r\n   */\r\n  async updateJob(userId: string, jobId: string, dto: UpdateJobDto) {\r\n    const user = await this.prisma.user.findUnique({\r\n      where: { id: userId },\r\n      include: { HR: true },\r\n    });\r\n\r\n    if (!user || !user.HR) {\r\n      throw new NotFoundException('HR profile not found');\r\n    }\r\n\r\n    const existingJob = await this.prisma.job.findUnique({\r\n      where: { id: jobId },\r\n      include: { JobSkill: true },\r\n    });\r\n\r\n    if (!existingJob) {\r\n      throw new NotFoundException('Job not found');\r\n    }\r\n\r\n    if (existingJob.hrId !== user.HR.id) {\r\n      throw new ForbiddenException('You can only modify your own jobs');\r\n    }\r\n\r\n    const updatedJob = await this.prisma.$transaction(async (tx) => {\r\n      // Update skills if provided\r\n      if (dto.skills && dto.skills.length > 0) {\r\n        // Delete existing skills\r\n        await tx.jobSkill.deleteMany({\r\n          where: { jobId },\r\n        });\r\n        // Add new skills\r\n        await tx.jobSkill.createMany({\r\n          data: dto.skills.map((skill: string) => ({\r\n            id: crypto.randomUUID(),\r\n            jobId,\r\n            name: skill,\r\n            isRequired: true,\r\n          })),\r\n        });\r\n      }\r\n\r\n      // Update job data\r\n      const updated = await tx.job.update({\r\n        where: { id: jobId },\r\n        data: {\r\n          title: dto.title,\r\n          description: dto.description,\r\n          requirements: dto.requirements,\r\n          responsibilities: dto.responsibilities,\r\n          location: dto.location,\r\n          isRemote: dto.isRemote,\r\n          salaryMin: dto.salaryMin,\r\n          salaryMax: dto.salaryMax,\r\n          experienceMin: dto.experienceMin,\r\n          experienceMax: dto.experienceMax,\r\n          educationLevel: dto.educationLevel,\r\n          maxApplications: dto.maxApplications,\r\n          referralFee: dto.referralFee,\r\n          status: dto.status ? (dto.status as PrismaJobStatus) : undefined,\r\n        },\r\n        include: { JobSkill: true },\r\n      });\r\n\r\n      // Audit log\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: user.id,\r\n          action: AuditAction.UPDATE,\r\n          entityType: 'Job',\r\n          entityId: jobId,\r\n          oldValue: { title: existingJob.title, status: existingJob.status },\r\n          newValue: {\r\n            title: dto.title || existingJob.title,\r\n            status: dto.status || existingJob.status,\r\n          },\r\n        },\r\n      });\r\n\r\n      return updated;\r\n    });\r\n\r\n    return updatedJob;\r\n  }\r\n\r\n  /**\r\n   * Delete a job\r\n   */\r\n  async deleteJob(userId: string, jobId: string) {\r\n    const user = await this.prisma.user.findUnique({\r\n      where: { id: userId },\r\n      include: { HR: true },\r\n    });\r\n\r\n    if (!user || !user.HR) {\r\n      throw new NotFoundException('HR profile not found');\r\n    }\r\n\r\n    const job = await this.prisma.job.findUnique({\r\n      where: { id: jobId },\r\n    });\r\n\r\n    if (!job) {\r\n      throw new NotFoundException('Job not found');\r\n    }\r\n\r\n    if (job.hrId !== user.HR.id) {\r\n      throw new ForbiddenException('You can only delete your own jobs');\r\n    }\r\n\r\n    await this.prisma.$transaction(async (tx) => {\r\n      // Delete related records first\r\n      await tx.jobSkill.deleteMany({ where: { jobId } });\r\n      await tx.jobApplication.deleteMany({ where: { jobId } });\r\n\r\n      // Delete the job\r\n      await tx.job.delete({ where: { id: jobId } });\r\n\r\n      // Update HR stats\r\n      await tx.hR.update({\r\n        where: { id: user.HR!.id },\r\n        data: {\r\n          totalJobsPosted: { decrement: 1 },\r\n          activeJobs:\r\n            job.status === PrismaJobStatus.ACTIVE\r\n              ? { decrement: 1 }\r\n              : undefined,\r\n        },\r\n      });\r\n\r\n      // Audit log\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: user.id,\r\n          action: AuditAction.DELETE,\r\n          entityType: 'Job',\r\n          entityId: jobId,\r\n          oldValue: { title: job.title, status: job.status },\r\n        },\r\n      });\r\n    });\r\n\r\n    return { message: 'Job deleted successfully' };\r\n  }\r\n\r\n  /**\r\n   * Get applications for HR's jobs\r\n   */\r\n  async getApplications(\r\n    userId: string,\r\n    filters?: {\r\n      jobId?: string;\r\n      status?: string;\r\n      page?: number;\r\n      limit?: number;\r\n    },\r\n  ) {\r\n    const user = await this.prisma.user.findUnique({\r\n      where: { id: userId },\r\n      include: { HR: true },\r\n    });\r\n\r\n    if (!user || !user.HR) {\r\n      throw new NotFoundException('HR profile not found');\r\n    }\r\n\r\n    const page = filters?.page || 1;\r\n    const limit = filters?.limit || 20;\r\n    const skip = (page - 1) * limit;\r\n\r\n    const where: any = {\r\n      Job: { hrId: user.HR.id },\r\n    };\r\n\r\n    if (filters?.jobId) {\r\n      where.jobId = filters.jobId;\r\n    }\r\n\r\n    if (filters?.status) {\r\n      where.status = filters.status;\r\n    }\r\n\r\n    const [applications, total] = await Promise.all([\r\n      this.prisma.jobApplication.findMany({\r\n        where,\r\n        skip,\r\n        take: limit,\r\n        orderBy: { createdAt: 'desc' },\r\n        select: {\r\n          id: true,\r\n          status: true,\r\n          testScore: true,\r\n          testPassedAt: true,\r\n          createdAt: true,\r\n          Candidate: {\r\n            select: {\r\n              firstName: true,\r\n              lastName: true,\r\n              headline: true,\r\n              totalExperience: true,\r\n              currentCompany: true,\r\n              resumeUrl: true, // Resume link for HR\r\n              city: true, // Location components\r\n              state: true,\r\n              country: true,\r\n              User: {\r\n                select: {\r\n                  email: true, // Contact info from User model\r\n                  phone: true,\r\n                },\r\n              },\r\n              CandidateSkill: {\r\n                select: {\r\n                  name: true,\r\n                  level: true,\r\n                },\r\n              },\r\n              Experience: {\r\n                select: {\r\n                  role: true,\r\n                  company: true,\r\n                  startDate: true,\r\n                  endDate: true,\r\n                  isCurrent: true,\r\n                },\r\n                orderBy: { startDate: 'desc' },\r\n                take: 3,\r\n              },\r\n              Education: {\r\n                select: {\r\n                  degree: true,\r\n                  institution: true,\r\n                  endYear: true,\r\n                },\r\n                orderBy: { endYear: 'desc' },\r\n                take: 2,\r\n              },\r\n            },\r\n          },\r\n          Job: {\r\n            select: {\r\n              id: true,\r\n              title: true,\r\n              companyName: true,\r\n            },\r\n          },\r\n          Interview: {\r\n            select: {\r\n              id: true,\r\n              status: true,\r\n              paymentStatus: true,\r\n              paidAt: true,\r\n              scheduledDate: true,\r\n              scheduledTime: true,\r\n              mode: true,\r\n            },\r\n          },\r\n        },\r\n      }),\r\n      this.prisma.jobApplication.count({ where }),\r\n    ]);\r\n\r\n    // Filter out applications with missing candidate or job data\r\n    const validApplications = applications.filter(\r\n      (app) => app.Candidate && app.Job,\r\n    );\r\n\r\n    return {\r\n      applications: validApplications,\r\n      pagination: {\r\n        page,\r\n        limit,\r\n        total: validApplications.length,\r\n        totalPages: Math.ceil(validApplications.length / limit),\r\n      },\r\n    };\r\n  }\r\n\r\n  // Reject an application\r\n  async rejectApplication(\r\n    userId: string,\r\n    applicationId: string,\r\n    reason?: string,\r\n  ) {\r\n    // First verify the HR has access to this application\r\n    const hr = await this.prisma.hR.findUnique({\r\n      where: { userId },\r\n    });\r\n\r\n    if (!hr) {\r\n      throw new NotFoundException('HR profile not found');\r\n    }\r\n\r\n    // Find the application and verify it belongs to one of HR's jobs\r\n    const application = await this.prisma.jobApplication.findUnique({\r\n      where: { id: applicationId },\r\n      include: {\r\n        Job: true,\r\n      },\r\n    });\r\n\r\n    if (!application) {\r\n      throw new NotFoundException('Application not found');\r\n    }\r\n\r\n    if (application.Job.hrId !== hr.id) {\r\n      throw new ForbiddenException(\r\n        'You do not have access to this application',\r\n      );\r\n    }\r\n\r\n    // Update the application status to REJECTED\r\n    const updatedApplication = await this.prisma.jobApplication.update({\r\n      where: { id: applicationId },\r\n      data: {\r\n        status: 'REJECTED' as any,\r\n        updatedAt: new Date(),\r\n      },\r\n    });\r\n\r\n    return {\r\n      message: 'Application rejected successfully',\r\n      applicationId: updatedApplication.id,\r\n      status: 'REJECTED',\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Shortlist an application - moves candidate from TEST_PASSED_WAITING_HR to INTERVIEW_CONFIRMED\r\n   * Creates an Interview record for the candidate\r\n   */\r\n  async shortlistApplication(\r\n    userId: string,\r\n    applicationId: string,\r\n  ) {\r\n    // First verify the HR has access to this application\r\n    const hr = await this.prisma.hR.findUnique({\r\n      where: { userId },\r\n    });\r\n\r\n    if (!hr) {\r\n      throw new NotFoundException('HR profile not found');\r\n    }\r\n\r\n    // Find the application and verify it belongs to one of HR's jobs\r\n    const application = await this.prisma.jobApplication.findUnique({\r\n      where: { id: applicationId },\r\n      include: {\r\n        Job: true,\r\n        Candidate: true,\r\n      },\r\n    });\r\n\r\n    if (!application) {\r\n      throw new NotFoundException('Application not found');\r\n    }\r\n\r\n    if (application.Job.hrId !== hr.id) {\r\n      throw new ForbiddenException(\r\n        'You do not have access to this application',\r\n      );\r\n    }\r\n\r\n    // Only allow shortlisting if status is TEST_PASSED_WAITING_HR\r\n    if (application.status !== 'TEST_PASSED_WAITING_HR') {\r\n      throw new BadRequestException(\r\n        `Cannot shortlist application with status: ${application.status}. Only applications with TEST_PASSED_WAITING_HR status can be shortlisted.`,\r\n      );\r\n    }\r\n\r\n    // Update application status and create interview in a transaction\r\n    const result = await this.prisma.$transaction(async (tx) => {\r\n      // Update the application status to INTERVIEW_CONFIRMED\r\n      const updatedApplication = await tx.jobApplication.update({\r\n        where: { id: applicationId },\r\n        data: {\r\n          status: 'INTERVIEW_CONFIRMED' as any,\r\n          updatedAt: new Date(),\r\n        },\r\n      });\r\n\r\n      // Create an Interview record for this application\r\n      const interview = await tx.interview.create({\r\n        data: {\r\n          applicationId: applicationId,\r\n          status: 'INTERVIEW_CONFIRMED',\r\n          paymentStatus: 'PENDING',\r\n        },\r\n      });\r\n\r\n      // Audit log\r\n      await tx.auditLog.create({\r\n        data: {\r\n          id: crypto.randomUUID(),\r\n          userId: userId,\r\n          action: AuditAction.UPDATE,\r\n          entityType: 'JobApplication',\r\n          entityId: applicationId,\r\n          oldValue: { status: application.status },\r\n          newValue: { status: 'INTERVIEW_CONFIRMED' },\r\n          metadata: { action: 'shortlist' },\r\n        },\r\n      });\r\n\r\n      return { updatedApplication, interview };\r\n    });\r\n\r\n    return {\r\n      message: 'Candidate shortlisted successfully! They will be notified to pay â‚¹99 to proceed with the interview.',\r\n      applicationId: result.updatedApplication.id,\r\n      interviewId: result.interview.id,\r\n      status: 'INTERVIEW_CONFIRMED',\r\n    };\r\n  }\r\n}\r\n"],"names":["HRService","MAX_LOGIN_ATTEMPTS","LOCKOUT_DURATION_MS","register","dto","deviceInfo","existingUser","prisma","user","findUnique","where","email","ConflictException","phone","existingPhone","existingHR","hR","findFirst","companyEmail","passwordHash","bcrypt","hash","password","result","$transaction","tx","create","data","id","crypto","randomUUID","role","UserRole","HR","status","UserStatus","ACTIVE","emailVerified","updatedAt","Date","hr","userId","companyName","companyWebsite","designation","linkedinUrl","approvalStatus","HRApprovalStatus","APPROVED","approvedAt","deviceLog","deviceId","ipAddress","ip","userAgent","auditLog","action","AuditAction","CREATE","entityType","entityId","metadata","registrationSource","payload","sub","tokens","tokenService","generateTokenPair","User","login","include","UnauthorizedException","BLOCKED","BadRequestException","PENDING","ForbiddenException","REJECTED","rejectionReason","isValid","compare","update","lastLoginAt","LOGIN","portal","getProfile","Job","select","title","applicationCount","NotFoundException","userWithoutPassword","updateProfile","updated","getDashboardStats","hrId","jobs","job","findMany","JobApplication","createdAt","now","thirtyDaysAgo","getTime","totalJobs","length","activeJobs","filter","j","PrismaJobStatus","totalApplications","reduce","acc","recentApplications","a","pendingReferrals","referral","count","confirmedReferrals","jobsByStatus","draft","DRAFT","active","closed","CLOSED","expired","EXPIRED","getRecentActivity","limit","jobApplication","orderBy","take","Candidate","firstName","lastName","map","app","type","jobTitle","getJobs","filters","page","skip","total","Promise","all","_count","JobSkill","pagination","totalPages","Math","ceil","createJob","baseSlug","toLowerCase","replace","randomSuffix","random","toString","substring","slug","newJob","description","requirements","responsibilities","location","isRemote","salaryMin","salaryMax","experienceMin","experienceMax","educationLevel","maxApplications","referralFee","skills","jobSkill","createMany","skill","jobId","name","isRequired","totalJobsPosted","increment","updateJobStatus","newStatus","originalStatus","updatedJob","postedAt","undefined","decrement","UPDATE","oldValue","newValue","getJobById","updateJob","existingJob","deleteMany","deleteJob","delete","DELETE","message","getApplications","applications","testScore","testPassedAt","headline","totalExperience","currentCompany","resumeUrl","city","state","country","CandidateSkill","level","Experience","company","startDate","endDate","isCurrent","Education","degree","institution","endYear","Interview","paymentStatus","paidAt","scheduledDate","scheduledTime","mode","validApplications","rejectApplication","applicationId","reason","application","updatedApplication","shortlistApplication","interview","interviewId"],"mappings":";;;;+BAiCaA;;;eAAAA;;;wBA1BN;gEACiB;gEACA;+BACM;8BACW;2BAclC;wBACsC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAE7C,0BAA0B;AAC1B,MAAMC,qBAAqB;AAC3B,MAAMC,sBAAsB,KAAK,KAAK,MAAM,aAAa;AAGlD,IAAA,AAAMF,YAAN,MAAMA;IAMX;;;;;GAKC,GACD,MAAMG,SAASC,GAAkB,EAAEC,UAAgB,EAAE;QACnD,gCAAgC;QAChC,MAAMC,eAAe,MAAM,IAAI,CAACC,MAAM,CAACC,IAAI,CAACC,UAAU,CAAC;YACrDC,OAAO;gBAAEC,OAAOP,IAAIO,KAAK;YAAC;QAC5B;QAEA,IAAIL,cAAc;YAChB,MAAM,IAAIM,yBAAiB,CAAC;QAC9B;QAEA,0BAA0B;QAC1B,IAAIR,IAAIS,KAAK,EAAE;YACb,MAAMC,gBAAgB,MAAM,IAAI,CAACP,MAAM,CAACC,IAAI,CAACC,UAAU,CAAC;gBACtDC,OAAO;oBAAEG,OAAOT,IAAIS,KAAK;gBAAC;YAC5B;YACA,IAAIC,eAAe;gBACjB,MAAM,IAAIF,yBAAiB,CAAC;YAC9B;QACF;QAEA,+CAA+C;QAC/C,MAAMG,aAAa,MAAM,IAAI,CAACR,MAAM,CAACS,EAAE,CAACC,SAAS,CAAC;YAChDP,OAAO;gBAAEQ,cAAcd,IAAIc,YAAY;YAAC;QAC1C;QAEA,IAAIH,YAAY;YACd,MAAM,IAAIH,yBAAiB,CAAC;QAC9B;QAEA,gBAAgB;QAChB,MAAMO,eAAe,MAAMC,QAAOC,IAAI,CAACjB,IAAIkB,QAAQ,EAAE;QAErD,4CAA4C;QAC5C,MAAMC,SAAS,MAAM,IAAI,CAAChB,MAAM,CAACiB,YAAY,CAAC,OAAOC;YACnD,2BAA2B;YAC3B,MAAMjB,OAAO,MAAMiB,GAAGjB,IAAI,CAACkB,MAAM,CAAC;gBAChCC,MAAM;oBACJC,IAAIC,QAAOC,UAAU;oBACrBnB,OAAOP,IAAIO,KAAK;oBAChBE,OAAOT,IAAIS,KAAK;oBAChBM;oBACAY,MAAMC,mBAAQ,CAACC,EAAE;oBACjBC,QAAQC,qBAAU,CAACC,MAAM;oBACzBC,eAAe;oBACfC,WAAW,IAAIC;gBACjB;YACF;YAEA,oDAAoD;YACpD,MAAMC,KAAK,MAAMf,GAAGT,EAAE,CAACU,MAAM,CAAC;gBAC5BC,MAAM;oBACJC,IAAIC,QAAOC,UAAU;oBACrBW,QAAQjC,KAAKoB,EAAE;oBACfc,aAAatC,IAAIsC,WAAW;oBAC5BxB,cAAcd,IAAIc,YAAY;oBAC9ByB,gBAAgBvC,IAAIuC,cAAc;oBAClCC,aAAaxC,IAAIwC,WAAW;oBAC5BC,aAAazC,IAAIyC,WAAW;oBAC5BC,gBAAgBC,2BAAgB,CAACC,QAAQ;oBACzCC,YAAY,IAAIV;oBAChBD,WAAW,IAAIC;gBACjB;YACF;YAEA,aAAa;YACb,IAAIlC,YAAY;gBACd,MAAMoB,GAAGyB,SAAS,CAACxB,MAAM,CAAC;oBACxBC,MAAM;wBACJC,IAAIC,QAAOC,UAAU;wBACrBW,QAAQjC,KAAKoB,EAAE;wBACfuB,UAAU9C,WAAW8C,QAAQ,IAAI;wBACjCC,WAAW/C,WAAWgD,EAAE,IAAI;wBAC5BC,WAAWjD,WAAWiD,SAAS;oBACjC;gBACF;YACF;YAEA,mBAAmB;YACnB,MAAM7B,GAAG8B,QAAQ,CAAC7B,MAAM,CAAC;gBACvBC,MAAM;oBACJC,IAAIC,QAAOC,UAAU;oBACrBW,QAAQjC,KAAKoB,EAAE;oBACf4B,QAAQC,sBAAW,CAACC,MAAM;oBAC1BC,YAAY;oBACZC,UAAUpB,GAAGZ,EAAE;oBACfiC,UAAU;wBAAEC,oBAAoB;oBAAY;gBAC9C;YACF;YAEA,OAAO;gBAAEtD;gBAAMgC;YAAG;QACpB;QAEA,kBAAkB;QAClB,MAAMuB,UAAsB;YAC1BC,KAAKzC,OAAOf,IAAI,CAACoB,EAAE;YACnBjB,OAAOY,OAAOf,IAAI,CAACG,KAAK;YACxBoB,MAAMR,OAAOf,IAAI,CAACuB,IAAI;QACxB;QAEA,MAAMkC,SAAS,MAAM,IAAI,CAACC,YAAY,CAACC,iBAAiB,CAACJ;QAEzD,OAAO;YACL,GAAGE,MAAM;YACTG,MAAM;gBACJxC,IAAIL,OAAOf,IAAI,CAACoB,EAAE;gBAClBjB,OAAOY,OAAOf,IAAI,CAACG,KAAK;gBACxBoB,MAAMR,OAAOf,IAAI,CAACuB,IAAI;gBACtBE,IAAI;oBACFL,IAAIL,OAAOiB,EAAE,CAACZ,EAAE;oBAChBc,aAAanB,OAAOiB,EAAE,CAACE,WAAW;oBAClCI,gBAAgBvB,OAAOiB,EAAE,CAACM,cAAc;gBAC1C;YACF;QACF;IACF;IAEA;;;;GAIC,GACD,MAAMuB,MAAMjE,GAAe,EAAEC,UAAgB,EAAE;QAC7C,MAAMG,OAAO,MAAM,IAAI,CAACD,MAAM,CAACC,IAAI,CAACC,UAAU,CAAC;YAC7CC,OAAO;gBAAEC,OAAOP,IAAIO,KAAK;YAAC;YAC1B2D,SAAS;gBAAErC,IAAI;YAAK;QACtB;QAEA,IAAI,CAACzB,QAAQ,CAACA,KAAKW,YAAY,EAAE;YAC/B,MAAM,IAAIoD,6BAAqB,CAAC;QAClC;QAEA,IAAI/D,KAAKuB,IAAI,KAAKC,mBAAQ,CAACC,EAAE,EAAE;YAC7B,MAAM,IAAIsC,6BAAqB,CAAC;QAClC;QAEA,IAAI/D,KAAK0B,MAAM,KAAKC,qBAAU,CAACqC,OAAO,EAAE;YACtC,MAAM,IAAID,6BAAqB,CAC7B;QAEJ;QAEA,2BAA2B;QAC3B,IAAI,CAAC/D,KAAKyB,EAAE,EAAE;YACZ,MAAM,IAAIwC,2BAAmB,CAAC;QAChC;QAEA,IAAIjE,KAAKyB,EAAE,CAACa,cAAc,KAAKC,2BAAgB,CAAC2B,OAAO,EAAE;YACvD,MAAM,IAAIC,0BAAkB,CAC1B;QAEJ;QAEA,IAAInE,KAAKyB,EAAE,CAACa,cAAc,KAAKC,2BAAgB,CAAC6B,QAAQ,EAAE;YACxD,MAAM,IAAID,0BAAkB,CAC1B,CAAC,kBAAkB,EAAEnE,KAAKyB,EAAE,CAAC4C,eAAe,IAAI,2BAA2B;QAE/E;QAEA,kBAAkB;QAClB,MAAMC,UAAU,MAAM1D,QAAO2D,OAAO,CAAC3E,IAAIkB,QAAQ,EAAEd,KAAKW,YAAY;QACpE,IAAI,CAAC2D,SAAS;YACZ,MAAM,IAAIP,6BAAqB,CAAC;QAClC;QAEA,oBAAoB;QACpB,MAAM,IAAI,CAAChE,MAAM,CAACiB,YAAY,CAAC,OAAOC;YACpC,MAAMA,GAAGjB,IAAI,CAACwE,MAAM,CAAC;gBACnBtE,OAAO;oBAAEkB,IAAIpB,KAAKoB,EAAE;gBAAC;gBACrBD,MAAM;oBAAEsD,aAAa,IAAI1C;gBAAO;YAClC;YAEA,aAAa;YACb,IAAIlC,YAAY;gBACd,MAAMoB,GAAGyB,SAAS,CAACxB,MAAM,CAAC;oBACxBC,MAAM;wBACJC,IAAIC,QAAOC,UAAU;wBACrBW,QAAQjC,KAAKoB,EAAE;wBACfuB,UAAU9C,WAAW8C,QAAQ,IAAI;wBACjCC,WAAW/C,WAAWgD,EAAE,IAAI;wBAC5BC,WAAWjD,WAAWiD,SAAS;oBACjC;gBACF;YACF;YAEA,YAAY;YACZ,MAAM7B,GAAG8B,QAAQ,CAAC7B,MAAM,CAAC;gBACvBC,MAAM;oBACJC,IAAIC,QAAOC,UAAU;oBACrBW,QAAQjC,KAAKoB,EAAE;oBACf4B,QAAQC,sBAAW,CAACyB,KAAK;oBACzBvB,YAAY;oBACZC,UAAUpD,KAAKyB,EAAE,CAAEL,EAAE;oBACrBiC,UAAU;wBAAER,IAAIhD,YAAYgD;wBAAI8B,QAAQ;oBAAK;gBAC/C;YACF;QACF;QAEA,kBAAkB;QAClB,MAAMpB,UAAsB;YAC1BC,KAAKxD,KAAKoB,EAAE;YACZjB,OAAOH,KAAKG,KAAK;YACjBoB,MAAMvB,KAAKuB,IAAI;QACjB;QAEA,MAAMkC,SAAS,MAAM,IAAI,CAACC,YAAY,CAACC,iBAAiB,CAACJ;QAEzD,OAAO;YACL,GAAGE,MAAM;YACTG,MAAM;gBACJxC,IAAIpB,KAAKoB,EAAE;gBACXjB,OAAOH,KAAKG,KAAK;gBACjBoB,MAAMvB,KAAKuB,IAAI;gBACfE,IAAI;oBACFL,IAAIpB,KAAKyB,EAAE,CAACL,EAAE;oBACdc,aAAalC,KAAKyB,EAAE,CAACS,WAAW;oBAChCE,aAAapC,KAAKyB,EAAE,CAACW,WAAW;gBAClC;YACF;QACF;IACF;IAEA;;GAEC,GACD,MAAMwC,WAAW3C,MAAc,EAAE;QAC/B,MAAMjC,OAAO,MAAM,IAAI,CAACD,MAAM,CAACC,IAAI,CAACC,UAAU,CAAC;YAC7CC,OAAO;gBAAEkB,IAAIa;YAAO;YACpB6B,SAAS;gBACPrC,IAAI;oBACFqC,SAAS;wBACPe,KAAK;4BACHC,QAAQ;gCACN1D,IAAI;gCACJ2D,OAAO;gCACPrD,QAAQ;gCACRsD,kBAAkB;4BACpB;wBACF;oBACF;gBACF;YACF;QACF;QAEA,IAAI,CAAChF,QAAQ,CAACA,KAAKyB,EAAE,EAAE;YACrB,MAAM,IAAIwD,yBAAiB,CAAC;QAC9B;QAEA,MAAM,EAAEtE,YAAY,EAAE,GAAGuE,qBAAqB,GAAGlF;QACjD,OAAOkF;IACT;IAEA;;GAEC,GACD,MAAMC,cAAclD,MAAc,EAAErC,GAAuB,EAAE;QAC3D,MAAMI,OAAO,MAAM,IAAI,CAACD,MAAM,CAACC,IAAI,CAACC,UAAU,CAAC;YAC7CC,OAAO;gBAAEkB,IAAIa;YAAO;YACpB6B,SAAS;gBAAErC,IAAI;YAAK;QACtB;QAEA,IAAI,CAACzB,QAAQ,CAACA,KAAKyB,EAAE,EAAE;YACrB,MAAM,IAAIwD,yBAAiB,CAAC;QAC9B;QAEA,MAAMG,UAAU,MAAM,IAAI,CAACrF,MAAM,CAACS,EAAE,CAACgE,MAAM,CAAC;YAC1CtE,OAAO;gBAAEkB,IAAIpB,KAAKyB,EAAE,CAACL,EAAE;YAAC;YACxBD,MAAM;gBACJe,aAAatC,IAAIsC,WAAW;gBAC5BC,gBAAgBvC,IAAIuC,cAAc;gBAClCC,aAAaxC,IAAIwC,WAAW;gBAC5BC,aAAazC,IAAIyC,WAAW;YAC9B;QACF;QAEA,OAAO+C;IACT;IAEA;;GAEC,GACD,MAAMC,kBAAkBpD,MAAc,EAAE;QACtC,MAAMjC,OAAO,MAAM,IAAI,CAACD,MAAM,CAACC,IAAI,CAACC,UAAU,CAAC;YAC7CC,OAAO;gBAAEkB,IAAIa;YAAO;YACpB6B,SAAS;gBAAErC,IAAI;YAAK;QACtB;QAEA,IAAI,CAACzB,QAAQ,CAACA,KAAKyB,EAAE,EAAE;YACrB,MAAM,IAAIwD,yBAAiB,CAAC;QAC9B;QAEA,MAAMK,OAAOtF,KAAKyB,EAAE,CAACL,EAAE;QAEvB,gBAAgB;QAChB,MAAMmE,OAAO,MAAM,IAAI,CAACxF,MAAM,CAACyF,GAAG,CAACC,QAAQ,CAAC;YAC1CvF,OAAO;gBAAEoF;YAAK;YACdxB,SAAS;gBACP4B,gBAAgB;oBACdZ,QAAQ;wBACN1D,IAAI;wBACJM,QAAQ;wBACRiE,WAAW;oBACb;gBACF;YACF;QACF;QAEA,MAAMC,MAAM,IAAI7D;QAChB,MAAM8D,gBAAgB,IAAI9D,KAAK6D,IAAIE,OAAO,KAAK,KAAK,KAAK,KAAK,KAAK;QAEnE,MAAMC,YAAYR,KAAKS,MAAM;QAC7B,MAAMC,aAAaV,KAAKW,MAAM,CAC5B,CAACC,IAAMA,EAAEzE,MAAM,KAAK0E,iBAAe,CAACxE,MAAM,EAC1CoE,MAAM;QACR,MAAMK,oBAAoBd,KAAKe,MAAM,CACnC,CAACC,KAAKJ,IAAMI,MAAMJ,EAAET,cAAc,CAACM,MAAM,EACzC;QAEF,MAAMQ,qBAAqBjB,KAAKe,MAAM,CACpC,CAACC,KAAKJ,IACJI,MACAJ,EAAET,cAAc,CAACQ,MAAM,CAAC,CAACO,IAAMA,EAAEd,SAAS,IAAIE,eAAeG,MAAM,EACrE;QAGF,MAAMU,mBAAmB,MAAM,IAAI,CAAC3G,MAAM,CAAC4G,QAAQ,CAACC,KAAK,CAAC;YACxD1G,OAAO;gBACLoF;gBACA5D,QAAQ;YACV;QACF;QAEA,MAAMmF,qBAAqB,MAAM,IAAI,CAAC9G,MAAM,CAAC4G,QAAQ,CAACC,KAAK,CAAC;YAC1D1G,OAAO;gBACLoF;gBACA5D,QAAQ;YACV;QACF;QAEA,OAAO;YACLqE;YACAE;YACAI;YACAG;YACAE;YACAG;YACAC,cAAc;gBACZC,OAAOxB,KAAKW,MAAM,CAAC,CAACC,IAAMA,EAAEzE,MAAM,KAAK0E,iBAAe,CAACY,KAAK,EAAEhB,MAAM;gBACpEiB,QAAQhB;gBACRiB,QAAQ3B,KAAKW,MAAM,CAAC,CAACC,IAAMA,EAAEzE,MAAM,KAAK0E,iBAAe,CAACe,MAAM,EAAEnB,MAAM;gBACtEoB,SAAS7B,KAAKW,MAAM,CAAC,CAACC,IAAMA,EAAEzE,MAAM,KAAK0E,iBAAe,CAACiB,OAAO,EAC7DrB,MAAM;YACX;QACF;IACF;IAEA;;GAEC,GACD,MAAMsB,kBAAkBrF,MAAc,EAAEsF,QAAgB,EAAE,EAAE;QAC1D,MAAMvH,OAAO,MAAM,IAAI,CAACD,MAAM,CAACC,IAAI,CAACC,UAAU,CAAC;YAC7CC,OAAO;gBAAEkB,IAAIa;YAAO;YACpB6B,SAAS;gBAAErC,IAAI;YAAK;QACtB;QAEA,IAAI,CAACzB,QAAQ,CAACA,KAAKyB,EAAE,EAAE;YACrB,MAAM,IAAIwD,yBAAiB,CAAC;QAC9B;QAEA,uCAAuC;QACvC,MAAMuB,qBAAqB,MAAM,IAAI,CAACzG,MAAM,CAACyH,cAAc,CAAC/B,QAAQ,CAAC;YACnEvF,OAAO;gBACL2E,KAAK;oBAAES,MAAMtF,KAAKyB,EAAE,CAACL,EAAE;gBAAC;YAC1B;YACAqG,SAAS;gBAAE9B,WAAW;YAAO;YAC7B+B,MAAMH;YACNzD,SAAS;gBACP6D,WAAW;oBACT7C,QAAQ;wBACN8C,WAAW;wBACXC,UAAU;oBACZ;gBACF;gBACAhD,KAAK;oBACHC,QAAQ;wBACNC,OAAO;wBACP7C,aAAa;oBACf;gBACF;YACF;QACF;QAEA,OAAOsE,mBAAmBsB,GAAG,CAAC,CAACC,MAAS,CAAA;gBACtC3G,IAAI2G,IAAI3G,EAAE;gBACV4G,MAAM;gBACNL,WAAW,GAAGI,IAAIJ,SAAS,CAACC,SAAS,CAAC,CAAC,EAAEG,IAAIJ,SAAS,CAACE,QAAQ,EAAE;gBACjEI,UAAUF,IAAIlD,GAAG,CAACE,KAAK;gBACvBrD,QAAQqG,IAAIrG,MAAM;gBAClBiE,WAAWoC,IAAIpC,SAAS;YAC1B,CAAA;IACF;IAEA;;GAEC,GACD,MAAMuC,QACJjG,MAAc,EACdkG,OAA4D,EAC5D;QACA,MAAMnI,OAAO,MAAM,IAAI,CAACD,MAAM,CAACC,IAAI,CAACC,UAAU,CAAC;YAC7CC,OAAO;gBAAEkB,IAAIa;YAAO;YACpB6B,SAAS;gBAAErC,IAAI;YAAK;QACtB;QAEA,IAAI,CAACzB,QAAQ,CAACA,KAAKyB,EAAE,EAAE;YACrB,MAAM,IAAIwD,yBAAiB,CAAC;QAC9B;QAEA,MAAMmD,OAAOD,SAASC,QAAQ;QAC9B,MAAMb,QAAQY,SAASZ,SAAS;QAChC,MAAMc,OAAO,AAACD,CAAAA,OAAO,CAAA,IAAKb;QAE1B,MAAMrH,QAAa;YAAEoF,MAAMtF,KAAKyB,EAAE,CAACL,EAAE;QAAC;QACtC,IAAI+G,SAASzG,QAAQ;YACnBxB,MAAMwB,MAAM,GAAGyG,QAAQzG,MAAM;QAC/B;QAEA,MAAM,CAAC6D,MAAM+C,MAAM,GAAG,MAAMC,QAAQC,GAAG,CAAC;YACtC,IAAI,CAACzI,MAAM,CAACyF,GAAG,CAACC,QAAQ,CAAC;gBACvBvF;gBACAmI;gBACAX,MAAMH;gBACNE,SAAS;oBAAE9B,WAAW;gBAAO;gBAC7B7B,SAAS;oBACP2E,QAAQ;wBACN3D,QAAQ;4BAAEY,gBAAgB;wBAAK;oBACjC;oBACAgD,UAAU;gBACZ;YACF;YACA,IAAI,CAAC3I,MAAM,CAACyF,GAAG,CAACoB,KAAK,CAAC;gBAAE1G;YAAM;SAC/B;QAED,OAAO;YACLqF;YACAoD,YAAY;gBACVP;gBACAb;gBACAe;gBACAM,YAAYC,KAAKC,IAAI,CAACR,QAAQf;YAChC;QACF;IACF;IAEA;;GAEC,GACD,MAAMwB,UAAU9G,MAAc,EAAErC,GAAiB,EAAE;QACjD,MAAMI,OAAO,MAAM,IAAI,CAACD,MAAM,CAACC,IAAI,CAACC,UAAU,CAAC;YAC7CC,OAAO;gBAAEkB,IAAIa;YAAO;YACpB6B,SAAS;gBAAErC,IAAI;YAAK;QACtB;QAEA,IAAI,CAACzB,QAAQ,CAACA,KAAKyB,EAAE,EAAE;YACrB,MAAM,IAAIwD,yBAAiB,CAAC;QAC9B;QAEA,2BAA2B;QAC3B,MAAM+D,WAAWpJ,IAAImF,KAAK,CACvBkE,WAAW,GACXC,OAAO,CAAC,eAAe,KACvBA,OAAO,CAAC,UAAU;QACrB,MAAMC,eAAeN,KAAKO,MAAM,GAAGC,QAAQ,CAAC,IAAIC,SAAS,CAAC,GAAG;QAC7D,MAAMC,OAAO,GAAGP,SAAS,CAAC,EAAEG,cAAc;QAE1C,MAAM3D,MAAM,MAAM,IAAI,CAACzF,MAAM,CAACiB,YAAY,CAAC,OAAOC;YAChD,MAAMuI,SAAS,MAAMvI,GAAGuE,GAAG,CAACtE,MAAM,CAAC;gBACjCC,MAAM;oBACJC,IAAIC,QAAOC,UAAU;oBACrBiI;oBACAxE,OAAOnF,IAAImF,KAAK;oBAChB0E,aAAa7J,IAAI6J,WAAW;oBAC5BC,cAAc9J,IAAI8J,YAAY;oBAC9BC,kBAAkB/J,IAAI+J,gBAAgB;oBACtCzH,aAAalC,KAAKyB,EAAE,CAAES,WAAW;oBACjC0H,UAAUhK,IAAIgK,QAAQ;oBACtBC,UAAUjK,IAAIiK,QAAQ,IAAI;oBAC1BC,WAAWlK,IAAIkK,SAAS;oBACxBC,WAAWnK,IAAImK,SAAS;oBACxBC,eAAepK,IAAIoK,aAAa;oBAChCC,eAAerK,IAAIqK,aAAa;oBAChCC,gBAAgBtK,IAAIsK,cAAc;oBAClCC,iBAAiBvK,IAAIuK,eAAe,IAAI;oBACxCC,aAAaxK,IAAIwK,WAAW,IAAI;oBAChC1I,QAAQ0E,iBAAe,CAACY,KAAK;oBAC7B1B,MAAMtF,KAAKyB,EAAE,CAAEL,EAAE;oBACjBU,WAAW,IAAIC;gBACjB;YACF;YAEA,aAAa;YACb,IAAInC,IAAIyK,MAAM,IAAIzK,IAAIyK,MAAM,CAACrE,MAAM,GAAG,GAAG;gBACvC,MAAM/E,GAAGqJ,QAAQ,CAACC,UAAU,CAAC;oBAC3BpJ,MAAMvB,IAAIyK,MAAM,CAACvC,GAAG,CAAC,CAAC0C,QAAmB,CAAA;4BACvCpJ,IAAIC,QAAOC,UAAU;4BACrBmJ,OAAOjB,OAAOpI,EAAE;4BAChBsJ,MAAMF;4BACNG,YAAY;wBACd,CAAA;gBACF;YACF;YAEA,kBAAkB;YAClB,MAAM1J,GAAGT,EAAE,CAACgE,MAAM,CAAC;gBACjBtE,OAAO;oBAAEkB,IAAIpB,KAAKyB,EAAE,CAAEL,EAAE;gBAAC;gBACzBD,MAAM;oBAAEyJ,iBAAiB;wBAAEC,WAAW;oBAAE;gBAAE;YAC5C;YAEA,YAAY;YACZ,MAAM5J,GAAG8B,QAAQ,CAAC7B,MAAM,CAAC;gBACvBC,MAAM;oBACJC,IAAIC,QAAOC,UAAU;oBACrBW,QAAQjC,KAAKoB,EAAE;oBACf4B,QAAQC,sBAAW,CAACC,MAAM;oBAC1BC,YAAY;oBACZC,UAAUoG,OAAOpI,EAAE;gBACrB;YACF;YAEA,OAAOoI;QACT;QAEA,OAAOhE;IACT;IAEA;;GAEC,GACD,MAAMsF,gBACJ7I,MAAc,EACdwI,KAAa,EACb7K,GAAuB,EACvB;QACA,MAAMI,OAAO,MAAM,IAAI,CAACD,MAAM,CAACC,IAAI,CAACC,UAAU,CAAC;YAC7CC,OAAO;gBAAEkB,IAAIa;YAAO;YACpB6B,SAAS;gBAAErC,IAAI;YAAK;QACtB;QAEA,IAAI,CAACzB,QAAQ,CAACA,KAAKyB,EAAE,EAAE;YACrB,MAAM,IAAIwD,yBAAiB,CAAC;QAC9B;QAEA,MAAMO,MAAM,MAAM,IAAI,CAACzF,MAAM,CAACyF,GAAG,CAACvF,UAAU,CAAC;YAC3CC,OAAO;gBAAEkB,IAAIqJ;YAAM;QACrB;QAEA,IAAI,CAACjF,KAAK;YACR,MAAM,IAAIP,yBAAiB,CAAC;QAC9B;QAEA,IAAIO,IAAIF,IAAI,KAAKtF,KAAKyB,EAAE,CAACL,EAAE,EAAE;YAC3B,MAAM,IAAI+C,0BAAkB,CAAC;QAC/B;QAEA,MAAM4G,YAAYnL,IAAI8B,MAAM;QAC5B,MAAMsJ,iBAAiBxF,IAAI9D,MAAM;QAEjC,MAAMuJ,aAAa,MAAM,IAAI,CAAClL,MAAM,CAACiB,YAAY,CAAC,OAAOC;YACvD,MAAMmE,UAAU,MAAMnE,GAAGuE,GAAG,CAAChB,MAAM,CAAC;gBAClCtE,OAAO;oBAAEkB,IAAIqJ;gBAAM;gBACnBtJ,MAAM;oBACJO,QAAQqJ;oBACRG,UACEH,cAAc3E,iBAAe,CAACxE,MAAM,GAAG,IAAIG,SAASoJ;gBACxD;YACF;YAEA,2BAA2B;YAC3B,IACEJ,cAAc3E,iBAAe,CAACxE,MAAM,IACpCoJ,mBAAmB5E,iBAAe,CAACxE,MAAM,EACzC;gBACA,MAAMX,GAAGT,EAAE,CAACgE,MAAM,CAAC;oBACjBtE,OAAO;wBAAEkB,IAAIpB,KAAKyB,EAAE,CAAEL,EAAE;oBAAC;oBACzBD,MAAM;wBAAE8E,YAAY;4BAAE4E,WAAW;wBAAE;oBAAE;gBACvC;YACF,OAAO,IACLG,mBAAmB5E,iBAAe,CAACxE,MAAM,IACzCmJ,cAAc3E,iBAAe,CAACxE,MAAM,EACpC;gBACA,MAAMX,GAAGT,EAAE,CAACgE,MAAM,CAAC;oBACjBtE,OAAO;wBAAEkB,IAAIpB,KAAKyB,EAAE,CAAEL,EAAE;oBAAC;oBACzBD,MAAM;wBAAE8E,YAAY;4BAAEmF,WAAW;wBAAE;oBAAE;gBACvC;YACF;YAEA,YAAY;YACZ,MAAMnK,GAAG8B,QAAQ,CAAC7B,MAAM,CAAC;gBACvBC,MAAM;oBACJC,IAAIC,QAAOC,UAAU;oBACrBW,QAAQjC,KAAKoB,EAAE;oBACf4B,QAAQC,sBAAW,CAACoI,MAAM;oBAC1BlI,YAAY;oBACZC,UAAUqH;oBACVa,UAAU;wBAAE5J,QAAQ8D,IAAI9D,MAAM;oBAAC;oBAC/B6J,UAAU;wBAAE7J,QAAQ9B,IAAI8B,MAAM;oBAAC;gBACjC;YACF;YAEA,OAAO0D;QACT;QAEA,OAAO6F;IACT;IAEA;;GAEC,GACD,MAAMO,WAAWvJ,MAAc,EAAEwI,KAAa,EAAE;QAC9C,MAAMzK,OAAO,MAAM,IAAI,CAACD,MAAM,CAACC,IAAI,CAACC,UAAU,CAAC;YAC7CC,OAAO;gBAAEkB,IAAIa;YAAO;YACpB6B,SAAS;gBAAErC,IAAI;YAAK;QACtB;QAEA,IAAI,CAACzB,QAAQ,CAACA,KAAKyB,EAAE,EAAE;YACrB,MAAM,IAAIwD,yBAAiB,CAAC;QAC9B;QAEA,MAAMO,MAAM,MAAM,IAAI,CAACzF,MAAM,CAACyF,GAAG,CAACvF,UAAU,CAAC;YAC3CC,OAAO;gBAAEkB,IAAIqJ;YAAM;YACnB3G,SAAS;gBACP4E,UAAU;gBACVhD,gBAAgB;oBACdZ,QAAQ;wBACN1D,IAAI;wBACJM,QAAQ;wBACRiE,WAAW;oBACb;gBACF;YACF;QACF;QAEA,IAAI,CAACH,KAAK;YACR,MAAM,IAAIP,yBAAiB,CAAC;QAC9B;QAEA,IAAIO,IAAIF,IAAI,KAAKtF,KAAKyB,EAAE,CAACL,EAAE,EAAE;YAC3B,MAAM,IAAI+C,0BAAkB,CAAC;QAC/B;QAEA,OAAOqB;IACT;IAEA;;GAEC,GACD,MAAMiG,UAAUxJ,MAAc,EAAEwI,KAAa,EAAE7K,GAAiB,EAAE;QAChE,MAAMI,OAAO,MAAM,IAAI,CAACD,MAAM,CAACC,IAAI,CAACC,UAAU,CAAC;YAC7CC,OAAO;gBAAEkB,IAAIa;YAAO;YACpB6B,SAAS;gBAAErC,IAAI;YAAK;QACtB;QAEA,IAAI,CAACzB,QAAQ,CAACA,KAAKyB,EAAE,EAAE;YACrB,MAAM,IAAIwD,yBAAiB,CAAC;QAC9B;QAEA,MAAMyG,cAAc,MAAM,IAAI,CAAC3L,MAAM,CAACyF,GAAG,CAACvF,UAAU,CAAC;YACnDC,OAAO;gBAAEkB,IAAIqJ;YAAM;YACnB3G,SAAS;gBAAE4E,UAAU;YAAK;QAC5B;QAEA,IAAI,CAACgD,aAAa;YAChB,MAAM,IAAIzG,yBAAiB,CAAC;QAC9B;QAEA,IAAIyG,YAAYpG,IAAI,KAAKtF,KAAKyB,EAAE,CAACL,EAAE,EAAE;YACnC,MAAM,IAAI+C,0BAAkB,CAAC;QAC/B;QAEA,MAAM8G,aAAa,MAAM,IAAI,CAAClL,MAAM,CAACiB,YAAY,CAAC,OAAOC;YACvD,4BAA4B;YAC5B,IAAIrB,IAAIyK,MAAM,IAAIzK,IAAIyK,MAAM,CAACrE,MAAM,GAAG,GAAG;gBACvC,yBAAyB;gBACzB,MAAM/E,GAAGqJ,QAAQ,CAACqB,UAAU,CAAC;oBAC3BzL,OAAO;wBAAEuK;oBAAM;gBACjB;gBACA,iBAAiB;gBACjB,MAAMxJ,GAAGqJ,QAAQ,CAACC,UAAU,CAAC;oBAC3BpJ,MAAMvB,IAAIyK,MAAM,CAACvC,GAAG,CAAC,CAAC0C,QAAmB,CAAA;4BACvCpJ,IAAIC,QAAOC,UAAU;4BACrBmJ;4BACAC,MAAMF;4BACNG,YAAY;wBACd,CAAA;gBACF;YACF;YAEA,kBAAkB;YAClB,MAAMvF,UAAU,MAAMnE,GAAGuE,GAAG,CAAChB,MAAM,CAAC;gBAClCtE,OAAO;oBAAEkB,IAAIqJ;gBAAM;gBACnBtJ,MAAM;oBACJ4D,OAAOnF,IAAImF,KAAK;oBAChB0E,aAAa7J,IAAI6J,WAAW;oBAC5BC,cAAc9J,IAAI8J,YAAY;oBAC9BC,kBAAkB/J,IAAI+J,gBAAgB;oBACtCC,UAAUhK,IAAIgK,QAAQ;oBACtBC,UAAUjK,IAAIiK,QAAQ;oBACtBC,WAAWlK,IAAIkK,SAAS;oBACxBC,WAAWnK,IAAImK,SAAS;oBACxBC,eAAepK,IAAIoK,aAAa;oBAChCC,eAAerK,IAAIqK,aAAa;oBAChCC,gBAAgBtK,IAAIsK,cAAc;oBAClCC,iBAAiBvK,IAAIuK,eAAe;oBACpCC,aAAaxK,IAAIwK,WAAW;oBAC5B1I,QAAQ9B,IAAI8B,MAAM,GAAI9B,IAAI8B,MAAM,GAAuByJ;gBACzD;gBACArH,SAAS;oBAAE4E,UAAU;gBAAK;YAC5B;YAEA,YAAY;YACZ,MAAMzH,GAAG8B,QAAQ,CAAC7B,MAAM,CAAC;gBACvBC,MAAM;oBACJC,IAAIC,QAAOC,UAAU;oBACrBW,QAAQjC,KAAKoB,EAAE;oBACf4B,QAAQC,sBAAW,CAACoI,MAAM;oBAC1BlI,YAAY;oBACZC,UAAUqH;oBACVa,UAAU;wBAAEvG,OAAO2G,YAAY3G,KAAK;wBAAErD,QAAQgK,YAAYhK,MAAM;oBAAC;oBACjE6J,UAAU;wBACRxG,OAAOnF,IAAImF,KAAK,IAAI2G,YAAY3G,KAAK;wBACrCrD,QAAQ9B,IAAI8B,MAAM,IAAIgK,YAAYhK,MAAM;oBAC1C;gBACF;YACF;YAEA,OAAO0D;QACT;QAEA,OAAO6F;IACT;IAEA;;GAEC,GACD,MAAMW,UAAU3J,MAAc,EAAEwI,KAAa,EAAE;QAC7C,MAAMzK,OAAO,MAAM,IAAI,CAACD,MAAM,CAACC,IAAI,CAACC,UAAU,CAAC;YAC7CC,OAAO;gBAAEkB,IAAIa;YAAO;YACpB6B,SAAS;gBAAErC,IAAI;YAAK;QACtB;QAEA,IAAI,CAACzB,QAAQ,CAACA,KAAKyB,EAAE,EAAE;YACrB,MAAM,IAAIwD,yBAAiB,CAAC;QAC9B;QAEA,MAAMO,MAAM,MAAM,IAAI,CAACzF,MAAM,CAACyF,GAAG,CAACvF,UAAU,CAAC;YAC3CC,OAAO;gBAAEkB,IAAIqJ;YAAM;QACrB;QAEA,IAAI,CAACjF,KAAK;YACR,MAAM,IAAIP,yBAAiB,CAAC;QAC9B;QAEA,IAAIO,IAAIF,IAAI,KAAKtF,KAAKyB,EAAE,CAACL,EAAE,EAAE;YAC3B,MAAM,IAAI+C,0BAAkB,CAAC;QAC/B;QAEA,MAAM,IAAI,CAACpE,MAAM,CAACiB,YAAY,CAAC,OAAOC;YACpC,+BAA+B;YAC/B,MAAMA,GAAGqJ,QAAQ,CAACqB,UAAU,CAAC;gBAAEzL,OAAO;oBAAEuK;gBAAM;YAAE;YAChD,MAAMxJ,GAAGuG,cAAc,CAACmE,UAAU,CAAC;gBAAEzL,OAAO;oBAAEuK;gBAAM;YAAE;YAEtD,iBAAiB;YACjB,MAAMxJ,GAAGuE,GAAG,CAACqG,MAAM,CAAC;gBAAE3L,OAAO;oBAAEkB,IAAIqJ;gBAAM;YAAE;YAE3C,kBAAkB;YAClB,MAAMxJ,GAAGT,EAAE,CAACgE,MAAM,CAAC;gBACjBtE,OAAO;oBAAEkB,IAAIpB,KAAKyB,EAAE,CAAEL,EAAE;gBAAC;gBACzBD,MAAM;oBACJyJ,iBAAiB;wBAAEQ,WAAW;oBAAE;oBAChCnF,YACET,IAAI9D,MAAM,KAAK0E,iBAAe,CAACxE,MAAM,GACjC;wBAAEwJ,WAAW;oBAAE,IACfD;gBACR;YACF;YAEA,YAAY;YACZ,MAAMlK,GAAG8B,QAAQ,CAAC7B,MAAM,CAAC;gBACvBC,MAAM;oBACJC,IAAIC,QAAOC,UAAU;oBACrBW,QAAQjC,KAAKoB,EAAE;oBACf4B,QAAQC,sBAAW,CAAC6I,MAAM;oBAC1B3I,YAAY;oBACZC,UAAUqH;oBACVa,UAAU;wBAAEvG,OAAOS,IAAIT,KAAK;wBAAErD,QAAQ8D,IAAI9D,MAAM;oBAAC;gBACnD;YACF;QACF;QAEA,OAAO;YAAEqK,SAAS;QAA2B;IAC/C;IAEA;;GAEC,GACD,MAAMC,gBACJ/J,MAAc,EACdkG,OAKC,EACD;QACA,MAAMnI,OAAO,MAAM,IAAI,CAACD,MAAM,CAACC,IAAI,CAACC,UAAU,CAAC;YAC7CC,OAAO;gBAAEkB,IAAIa;YAAO;YACpB6B,SAAS;gBAAErC,IAAI;YAAK;QACtB;QAEA,IAAI,CAACzB,QAAQ,CAACA,KAAKyB,EAAE,EAAE;YACrB,MAAM,IAAIwD,yBAAiB,CAAC;QAC9B;QAEA,MAAMmD,OAAOD,SAASC,QAAQ;QAC9B,MAAMb,QAAQY,SAASZ,SAAS;QAChC,MAAMc,OAAO,AAACD,CAAAA,OAAO,CAAA,IAAKb;QAE1B,MAAMrH,QAAa;YACjB2E,KAAK;gBAAES,MAAMtF,KAAKyB,EAAE,CAACL,EAAE;YAAC;QAC1B;QAEA,IAAI+G,SAASsC,OAAO;YAClBvK,MAAMuK,KAAK,GAAGtC,QAAQsC,KAAK;QAC7B;QAEA,IAAItC,SAASzG,QAAQ;YACnBxB,MAAMwB,MAAM,GAAGyG,QAAQzG,MAAM;QAC/B;QAEA,MAAM,CAACuK,cAAc3D,MAAM,GAAG,MAAMC,QAAQC,GAAG,CAAC;YAC9C,IAAI,CAACzI,MAAM,CAACyH,cAAc,CAAC/B,QAAQ,CAAC;gBAClCvF;gBACAmI;gBACAX,MAAMH;gBACNE,SAAS;oBAAE9B,WAAW;gBAAO;gBAC7Bb,QAAQ;oBACN1D,IAAI;oBACJM,QAAQ;oBACRwK,WAAW;oBACXC,cAAc;oBACdxG,WAAW;oBACXgC,WAAW;wBACT7C,QAAQ;4BACN8C,WAAW;4BACXC,UAAU;4BACVuE,UAAU;4BACVC,iBAAiB;4BACjBC,gBAAgB;4BAChBC,WAAW;4BACXC,MAAM;4BACNC,OAAO;4BACPC,SAAS;4BACT9I,MAAM;gCACJkB,QAAQ;oCACN3E,OAAO;oCACPE,OAAO;gCACT;4BACF;4BACAsM,gBAAgB;gCACd7H,QAAQ;oCACN4F,MAAM;oCACNkC,OAAO;gCACT;4BACF;4BACAC,YAAY;gCACV/H,QAAQ;oCACNvD,MAAM;oCACNuL,SAAS;oCACTC,WAAW;oCACXC,SAAS;oCACTC,WAAW;gCACb;gCACAxF,SAAS;oCAAEsF,WAAW;gCAAO;gCAC7BrF,MAAM;4BACR;4BACAwF,WAAW;gCACTpI,QAAQ;oCACNqI,QAAQ;oCACRC,aAAa;oCACbC,SAAS;gCACX;gCACA5F,SAAS;oCAAE4F,SAAS;gCAAO;gCAC3B3F,MAAM;4BACR;wBACF;oBACF;oBACA7C,KAAK;wBACHC,QAAQ;4BACN1D,IAAI;4BACJ2D,OAAO;4BACP7C,aAAa;wBACf;oBACF;oBACAoL,WAAW;wBACTxI,QAAQ;4BACN1D,IAAI;4BACJM,QAAQ;4BACR6L,eAAe;4BACfC,QAAQ;4BACRC,eAAe;4BACfC,eAAe;4BACfC,MAAM;wBACR;oBACF;gBACF;YACF;YACA,IAAI,CAAC5N,MAAM,CAACyH,cAAc,CAACZ,KAAK,CAAC;gBAAE1G;YAAM;SAC1C;QAED,6DAA6D;QAC7D,MAAM0N,oBAAoB3B,aAAa/F,MAAM,CAC3C,CAAC6B,MAAQA,IAAIJ,SAAS,IAAII,IAAIlD,GAAG;QAGnC,OAAO;YACLoH,cAAc2B;YACdjF,YAAY;gBACVP;gBACAb;gBACAe,OAAOsF,kBAAkB5H,MAAM;gBAC/B4C,YAAYC,KAAKC,IAAI,CAAC8E,kBAAkB5H,MAAM,GAAGuB;YACnD;QACF;IACF;IAEA,wBAAwB;IACxB,MAAMsG,kBACJ5L,MAAc,EACd6L,aAAqB,EACrBC,MAAe,EACf;QACA,qDAAqD;QACrD,MAAM/L,KAAK,MAAM,IAAI,CAACjC,MAAM,CAACS,EAAE,CAACP,UAAU,CAAC;YACzCC,OAAO;gBAAE+B;YAAO;QAClB;QAEA,IAAI,CAACD,IAAI;YACP,MAAM,IAAIiD,yBAAiB,CAAC;QAC9B;QAEA,iEAAiE;QACjE,MAAM+I,cAAc,MAAM,IAAI,CAACjO,MAAM,CAACyH,cAAc,CAACvH,UAAU,CAAC;YAC9DC,OAAO;gBAAEkB,IAAI0M;YAAc;YAC3BhK,SAAS;gBACPe,KAAK;YACP;QACF;QAEA,IAAI,CAACmJ,aAAa;YAChB,MAAM,IAAI/I,yBAAiB,CAAC;QAC9B;QAEA,IAAI+I,YAAYnJ,GAAG,CAACS,IAAI,KAAKtD,GAAGZ,EAAE,EAAE;YAClC,MAAM,IAAI+C,0BAAkB,CAC1B;QAEJ;QAEA,4CAA4C;QAC5C,MAAM8J,qBAAqB,MAAM,IAAI,CAAClO,MAAM,CAACyH,cAAc,CAAChD,MAAM,CAAC;YACjEtE,OAAO;gBAAEkB,IAAI0M;YAAc;YAC3B3M,MAAM;gBACJO,QAAQ;gBACRI,WAAW,IAAIC;YACjB;QACF;QAEA,OAAO;YACLgK,SAAS;YACT+B,eAAeG,mBAAmB7M,EAAE;YACpCM,QAAQ;QACV;IACF;IAEA;;;GAGC,GACD,MAAMwM,qBACJjM,MAAc,EACd6L,aAAqB,EACrB;QACA,qDAAqD;QACrD,MAAM9L,KAAK,MAAM,IAAI,CAACjC,MAAM,CAACS,EAAE,CAACP,UAAU,CAAC;YACzCC,OAAO;gBAAE+B;YAAO;QAClB;QAEA,IAAI,CAACD,IAAI;YACP,MAAM,IAAIiD,yBAAiB,CAAC;QAC9B;QAEA,iEAAiE;QACjE,MAAM+I,cAAc,MAAM,IAAI,CAACjO,MAAM,CAACyH,cAAc,CAACvH,UAAU,CAAC;YAC9DC,OAAO;gBAAEkB,IAAI0M;YAAc;YAC3BhK,SAAS;gBACPe,KAAK;gBACL8C,WAAW;YACb;QACF;QAEA,IAAI,CAACqG,aAAa;YAChB,MAAM,IAAI/I,yBAAiB,CAAC;QAC9B;QAEA,IAAI+I,YAAYnJ,GAAG,CAACS,IAAI,KAAKtD,GAAGZ,EAAE,EAAE;YAClC,MAAM,IAAI+C,0BAAkB,CAC1B;QAEJ;QAEA,8DAA8D;QAC9D,IAAI6J,YAAYtM,MAAM,KAAK,0BAA0B;YACnD,MAAM,IAAIuC,2BAAmB,CAC3B,CAAC,0CAA0C,EAAE+J,YAAYtM,MAAM,CAAC,0EAA0E,CAAC;QAE/I;QAEA,kEAAkE;QAClE,MAAMX,SAAS,MAAM,IAAI,CAAChB,MAAM,CAACiB,YAAY,CAAC,OAAOC;YACnD,uDAAuD;YACvD,MAAMgN,qBAAqB,MAAMhN,GAAGuG,cAAc,CAAChD,MAAM,CAAC;gBACxDtE,OAAO;oBAAEkB,IAAI0M;gBAAc;gBAC3B3M,MAAM;oBACJO,QAAQ;oBACRI,WAAW,IAAIC;gBACjB;YACF;YAEA,kDAAkD;YAClD,MAAMoM,YAAY,MAAMlN,GAAGkN,SAAS,CAACjN,MAAM,CAAC;gBAC1CC,MAAM;oBACJ2M,eAAeA;oBACfpM,QAAQ;oBACR6L,eAAe;gBACjB;YACF;YAEA,YAAY;YACZ,MAAMtM,GAAG8B,QAAQ,CAAC7B,MAAM,CAAC;gBACvBC,MAAM;oBACJC,IAAIC,QAAOC,UAAU;oBACrBW,QAAQA;oBACRe,QAAQC,sBAAW,CAACoI,MAAM;oBAC1BlI,YAAY;oBACZC,UAAU0K;oBACVxC,UAAU;wBAAE5J,QAAQsM,YAAYtM,MAAM;oBAAC;oBACvC6J,UAAU;wBAAE7J,QAAQ;oBAAsB;oBAC1C2B,UAAU;wBAAEL,QAAQ;oBAAY;gBAClC;YACF;YAEA,OAAO;gBAAEiL;gBAAoBE;YAAU;QACzC;QAEA,OAAO;YACLpC,SAAS;YACT+B,eAAe/M,OAAOkN,kBAAkB,CAAC7M,EAAE;YAC3CgN,aAAarN,OAAOoN,SAAS,CAAC/M,EAAE;YAChCM,QAAQ;QACV;IACF;IAxjCA,YACE,AAAQ3B,MAAqB,EAC7B,AAAQ2D,YAA0B,CAClC;aAFQ3D,SAAAA;aACA2D,eAAAA;IACN;AAsjCN"}