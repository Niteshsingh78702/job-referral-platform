{"version":3,"sources":["../../../src/modules/payment/payment.controller.ts"],"sourcesContent":["import {\r\n  Controller,\r\n  Get,\r\n  Post,\r\n  Body,\r\n  Param,\r\n  Req,\r\n  Headers,\r\n  HttpCode,\r\n  HttpStatus,\r\n} from '@nestjs/common';\r\nimport { Request } from 'express';\r\nimport { PaymentService } from './payment.service';\r\nimport {\r\n  CreatePaymentOrderDto,\r\n  VerifyPaymentDto,\r\n  RequestRefundDto,\r\n} from './dto';\r\nimport { Public, CurrentUser, Roles } from '../../common/decorators';\r\nimport { UserRole } from '../../common/constants';\r\n\r\n@Controller('payments')\r\nexport class PaymentController {\r\n  constructor(private readonly paymentService: PaymentService) {}\r\n\r\n  @Post('create-order')\r\n  @Roles(UserRole.CANDIDATE)\r\n  async createOrder(\r\n    @CurrentUser('sub') userId: string,\r\n    @Body() dto: CreatePaymentOrderDto,\r\n  ) {\r\n    return this.paymentService.createOrder(userId, dto);\r\n  }\r\n\r\n  @Post('verify')\r\n  @Roles(UserRole.CANDIDATE)\r\n  async verifyPayment(\r\n    @CurrentUser('sub') userId: string,\r\n    @Body() dto: VerifyPaymentDto,\r\n  ) {\r\n    return this.paymentService.verifyPayment(userId, dto);\r\n  }\r\n\r\n  @Public()\r\n  @Post('webhook')\r\n  @HttpCode(HttpStatus.OK)\r\n  async handleWebhook(\r\n    @Body() payload: any,\r\n    @Headers('x-razorpay-signature') signature: string,\r\n  ) {\r\n    return this.paymentService.handleWebhook(payload, signature);\r\n  }\r\n\r\n  @Get('history')\r\n  @Roles(UserRole.CANDIDATE)\r\n  async getPaymentHistory(@CurrentUser('sub') userId: string) {\r\n    return this.paymentService.getPaymentHistory(userId);\r\n  }\r\n\r\n  @Get(':id')\r\n  @Roles(UserRole.CANDIDATE)\r\n  async getPayment(\r\n    @CurrentUser('sub') userId: string,\r\n    @Param('id') paymentId: string,\r\n  ) {\r\n    return this.paymentService.getPaymentById(userId, paymentId);\r\n  }\r\n\r\n  @Post('refund/request')\r\n  @Roles(UserRole.CANDIDATE)\r\n  async requestRefund(\r\n    @CurrentUser('sub') userId: string,\r\n    @Body() dto: RequestRefundDto,\r\n  ) {\r\n    return this.paymentService.requestRefund(userId, dto);\r\n  }\r\n\r\n  // =============================================\r\n  // INTERVIEW PAYMENT ENDPOINTS (â‚¹99)\r\n  // =============================================\r\n\r\n  @Post('interview/create-order')\r\n  @Roles(UserRole.CANDIDATE)\r\n  async createInterviewOrder(\r\n    @CurrentUser('sub') userId: string,\r\n    @Body() dto: { applicationId: string },\r\n  ) {\r\n    const result = await this.paymentService.createInterviewOrder(\r\n      userId,\r\n      dto.applicationId,\r\n    );\r\n    return { success: true, data: result };\r\n  }\r\n\r\n  @Post('interview/verify')\r\n  @Roles(UserRole.CANDIDATE)\r\n  async verifyInterviewPayment(\r\n    @CurrentUser('sub') userId: string,\r\n    @Body() dto: VerifyPaymentDto,\r\n  ) {\r\n    const result = await this.paymentService.verifyInterviewPayment(\r\n      userId,\r\n      dto,\r\n    );\r\n    return { success: true, data: result };\r\n  }\r\n}\r\n"],"names":["PaymentController","createOrder","userId","dto","paymentService","verifyPayment","handleWebhook","payload","signature","getPaymentHistory","getPayment","paymentId","getPaymentById","requestRefund","createInterviewOrder","result","applicationId","success","data","verifyInterviewPayment","CANDIDATE","OK"],"mappings":";;;;+BAsBaA;;;eAAAA;;;wBAZN;gCAEwB;qBAKxB;4BACoC;2BAClB;;;;;;;;;;;;;;;AAGlB,IAAA,AAAMA,oBAAN,MAAMA;IAGX,MAEMC,YACJ,AAAoBC,MAAc,EAClC,AAAQC,GAA0B,EAClC;QACA,OAAO,IAAI,CAACC,cAAc,CAACH,WAAW,CAACC,QAAQC;IACjD;IAEA,MAEME,cACJ,AAAoBH,MAAc,EAClC,AAAQC,GAAqB,EAC7B;QACA,OAAO,IAAI,CAACC,cAAc,CAACC,aAAa,CAACH,QAAQC;IACnD;IAEA,MAGMG,cACJ,AAAQC,OAAY,EACpB,AAAiCC,SAAiB,EAClD;QACA,OAAO,IAAI,CAACJ,cAAc,CAACE,aAAa,CAACC,SAASC;IACpD;IAEA,MAEMC,kBAAkB,AAAoBP,MAAc,EAAE;QAC1D,OAAO,IAAI,CAACE,cAAc,CAACK,iBAAiB,CAACP;IAC/C;IAEA,MAEMQ,WACJ,AAAoBR,MAAc,EAClC,AAAaS,SAAiB,EAC9B;QACA,OAAO,IAAI,CAACP,cAAc,CAACQ,cAAc,CAACV,QAAQS;IACpD;IAEA,MAEME,cACJ,AAAoBX,MAAc,EAClC,AAAQC,GAAqB,EAC7B;QACA,OAAO,IAAI,CAACC,cAAc,CAACS,aAAa,CAACX,QAAQC;IACnD;IAEA,gDAAgD;IAChD,oCAAoC;IACpC,gDAAgD;IAEhD,MAEMW,qBACJ,AAAoBZ,MAAc,EAClC,AAAQC,GAA8B,EACtC;QACA,MAAMY,SAAS,MAAM,IAAI,CAACX,cAAc,CAACU,oBAAoB,CAC3DZ,QACAC,IAAIa,aAAa;QAEnB,OAAO;YAAEC,SAAS;YAAMC,MAAMH;QAAO;IACvC;IAEA,MAEMI,uBACJ,AAAoBjB,MAAc,EAClC,AAAQC,GAAqB,EAC7B;QACA,MAAMY,SAAS,MAAM,IAAI,CAACX,cAAc,CAACe,sBAAsB,CAC7DjB,QACAC;QAEF,OAAO;YAAEc,SAAS;YAAMC,MAAMH;QAAO;IACvC;IAlFA,YAAY,AAAiBX,cAA8B,CAAE;aAAhCA,iBAAAA;IAAiC;AAmFhE;;;+CAhFkBgB;;;;;;;;;;;;+CASAA;;;;;;;;;;;;;6CAUKC;;;;;;;;;;;;+CASLD;;;;;;;;;;+CAMAA;;;;;;;;;;;;+CASAA;;;;;;;;;;;;+CAaAA;;;;;;;;;;;;+CAaAA"}