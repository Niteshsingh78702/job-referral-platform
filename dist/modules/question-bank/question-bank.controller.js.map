{"version":3,"sources":["../../../src/modules/question-bank/question-bank.controller.ts"],"sourcesContent":["import {\r\n  Controller,\r\n  Get,\r\n  Post,\r\n  Put,\r\n  Delete,\r\n  Body,\r\n  Param,\r\n  Query,\r\n  UseGuards,\r\n} from '@nestjs/common';\r\nimport { JwtAuthGuard } from '../../common/guards/jwt-auth.guard';\r\nimport { RolesGuard } from '../../common/guards/roles.guard';\r\nimport { Roles } from '../../common/decorators/roles.decorator';\r\nimport { UserRole } from '../../common/constants';\r\nimport { CurrentUser } from '../../common/decorators/current-user.decorator';\r\nimport { QuestionBankService } from './question-bank.service';\r\nimport {\r\n  CreateQuestionDto,\r\n  UpdateQuestionDto,\r\n  QuestionFiltersDto,\r\n  BulkUploadDto,\r\n} from './dto';\r\n\r\n@Controller('admin/questions')\r\n@UseGuards(JwtAuthGuard, RolesGuard)\r\n@Roles(UserRole.ADMIN)\r\nexport class QuestionBankController {\r\n  constructor(private questionBankService: QuestionBankService) {}\r\n\r\n  /**\r\n   * Create a new question\r\n   */\r\n  @Post()\r\n  async createQuestion(\r\n    @Body() dto: CreateQuestionDto,\r\n    @CurrentUser() user: any,\r\n  ) {\r\n    const question = await this.questionBankService.createQuestion(\r\n      dto,\r\n      user.sub,\r\n    );\r\n    return {\r\n      success: true,\r\n      message: 'Question created successfully',\r\n      data: question,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Bulk upload questions from CSV\r\n   */\r\n  @Post('bulk')\r\n  async bulkUpload(@Body() dto: BulkUploadDto, @CurrentUser() user: any) {\r\n    const result = await this.questionBankService.bulkUpload(\r\n      dto.QuestionBank,\r\n      user.sub,\r\n    );\r\n    return {\r\n      success: true,\r\n      message: `Uploaded ${result.success} questions, ${result.failed} failed`,\r\n      data: result,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get questions with filters and pagination\r\n   */\r\n  @Get()\r\n  async getQuestions(@Query() filters: QuestionFiltersDto) {\r\n    const result = await this.questionBankService.getQuestions(filters);\r\n    return {\r\n      success: true,\r\n      data: result.questions,\r\n      pagination: result.pagination,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get question bank statistics\r\n   */\r\n  @Get('stats')\r\n  async getStats() {\r\n    const stats = await this.questionBankService.getStats();\r\n    return {\r\n      success: true,\r\n      data: stats,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get unique role types for dropdown\r\n   */\r\n  @Get('role-types')\r\n  async getRoleTypes() {\r\n    const roleTypes = await this.questionBankService.getRoleTypes();\r\n    return {\r\n      success: true,\r\n      data: roleTypes,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get a single question by ID\r\n   */\r\n  @Get(':id')\r\n  async getQuestion(@Param('id') id: string) {\r\n    const question = await this.questionBankService.getQuestionById(id);\r\n    return {\r\n      success: true,\r\n      data: question,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Update a question\r\n   */\r\n  @Put(':id')\r\n  async updateQuestion(\r\n    @Param('id') id: string,\r\n    @Body() dto: UpdateQuestionDto,\r\n  ) {\r\n    const question = await this.questionBankService.updateQuestion(id, dto);\r\n    return {\r\n      success: true,\r\n      message: 'Question updated successfully',\r\n      data: question,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Bulk delete all questions by role type\r\n   * NOTE: This route must be before :id routes to avoid conflict\r\n   */\r\n  @Delete('bulk/role/:roleType')\r\n  async deleteByRole(@Param('roleType') roleType: string) {\r\n    const count = await this.questionBankService.deleteByRole(roleType);\r\n    return {\r\n      success: true,\r\n      message: `Deleted ${count} questions for role ${roleType}`,\r\n      data: { deletedCount: count },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Delete a question (soft delete)\r\n   */\r\n  @Delete(':id')\r\n  async deleteQuestion(@Param('id') id: string) {\r\n    await this.questionBankService.deleteQuestion(id);\r\n    return {\r\n      success: true,\r\n      message: 'Question deleted successfully',\r\n    };\r\n  }\r\n}\r\n"],"names":["QuestionBankController","createQuestion","dto","user","question","questionBankService","sub","success","message","data","bulkUpload","result","QuestionBank","failed","getQuestions","filters","questions","pagination","getStats","stats","getRoleTypes","roleTypes","getQuestion","id","getQuestionById","updateQuestion","deleteByRole","roleType","count","deletedCount","deleteQuestion","ADMIN"],"mappings":";;;;+BA2BaA;;;eAAAA;;;wBAjBN;8BACsB;4BACF;gCACL;2BACG;sCACG;qCACQ;qBAM7B;;;;;;;;;;;;;;;AAKA,IAAA,AAAMA,yBAAN,MAAMA;IAGX;;GAEC,GACD,MACMC,eACJ,AAAQC,GAAsB,EAC9B,AAAeC,IAAS,EACxB;QACA,MAAMC,WAAW,MAAM,IAAI,CAACC,mBAAmB,CAACJ,cAAc,CAC5DC,KACAC,KAAKG,GAAG;QAEV,OAAO;YACLC,SAAS;YACTC,SAAS;YACTC,MAAML;QACR;IACF;IAEA;;GAEC,GACD,MACMM,WAAW,AAAQR,GAAkB,EAAE,AAAeC,IAAS,EAAE;QACrE,MAAMQ,SAAS,MAAM,IAAI,CAACN,mBAAmB,CAACK,UAAU,CACtDR,IAAIU,YAAY,EAChBT,KAAKG,GAAG;QAEV,OAAO;YACLC,SAAS;YACTC,SAAS,CAAC,SAAS,EAAEG,OAAOJ,OAAO,CAAC,YAAY,EAAEI,OAAOE,MAAM,CAAC,OAAO,CAAC;YACxEJ,MAAME;QACR;IACF;IAEA;;GAEC,GACD,MACMG,aAAa,AAASC,OAA2B,EAAE;QACvD,MAAMJ,SAAS,MAAM,IAAI,CAACN,mBAAmB,CAACS,YAAY,CAACC;QAC3D,OAAO;YACLR,SAAS;YACTE,MAAME,OAAOK,SAAS;YACtBC,YAAYN,OAAOM,UAAU;QAC/B;IACF;IAEA;;GAEC,GACD,MACMC,WAAW;QACf,MAAMC,QAAQ,MAAM,IAAI,CAACd,mBAAmB,CAACa,QAAQ;QACrD,OAAO;YACLX,SAAS;YACTE,MAAMU;QACR;IACF;IAEA;;GAEC,GACD,MACMC,eAAe;QACnB,MAAMC,YAAY,MAAM,IAAI,CAAChB,mBAAmB,CAACe,YAAY;QAC7D,OAAO;YACLb,SAAS;YACTE,MAAMY;QACR;IACF;IAEA;;GAEC,GACD,MACMC,YAAY,AAAaC,EAAU,EAAE;QACzC,MAAMnB,WAAW,MAAM,IAAI,CAACC,mBAAmB,CAACmB,eAAe,CAACD;QAChE,OAAO;YACLhB,SAAS;YACTE,MAAML;QACR;IACF;IAEA;;GAEC,GACD,MACMqB,eACJ,AAAaF,EAAU,EACvB,AAAQrB,GAAsB,EAC9B;QACA,MAAME,WAAW,MAAM,IAAI,CAACC,mBAAmB,CAACoB,cAAc,CAACF,IAAIrB;QACnE,OAAO;YACLK,SAAS;YACTC,SAAS;YACTC,MAAML;QACR;IACF;IAEA;;;GAGC,GACD,MACMsB,aAAa,AAAmBC,QAAgB,EAAE;QACtD,MAAMC,QAAQ,MAAM,IAAI,CAACvB,mBAAmB,CAACqB,YAAY,CAACC;QAC1D,OAAO;YACLpB,SAAS;YACTC,SAAS,CAAC,QAAQ,EAAEoB,MAAM,oBAAoB,EAAED,UAAU;YAC1DlB,MAAM;gBAAEoB,cAAcD;YAAM;QAC9B;IACF;IAEA;;GAEC,GACD,MACME,eAAe,AAAaP,EAAU,EAAE;QAC5C,MAAM,IAAI,CAAClB,mBAAmB,CAACyB,cAAc,CAACP;QAC9C,OAAO;YACLhB,SAAS;YACTC,SAAS;QACX;IACF;IA9HA,YAAY,AAAQH,mBAAwC,CAAE;aAA1CA,sBAAAA;IAA2C;AA+HjE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;mDAjIgB0B"}