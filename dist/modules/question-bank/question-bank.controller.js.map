{"version":3,"sources":["../../../src/modules/question-bank/question-bank.controller.ts"],"sourcesContent":["import {\r\n    Controller,\r\n    Get,\r\n    Post,\r\n    Put,\r\n    Delete,\r\n    Body,\r\n    Param,\r\n    Query,\r\n    UseGuards,\r\n} from '@nestjs/common';\r\nimport { JwtAuthGuard } from '../../common/guards/jwt-auth.guard';\r\nimport { RolesGuard } from '../../common/guards/roles.guard';\r\nimport { Roles } from '../../common/decorators/roles.decorator';\r\nimport { UserRole } from '../../common/constants';\r\nimport { CurrentUser } from '../../common/decorators/current-user.decorator';\r\nimport { QuestionBankService } from './question-bank.service';\r\nimport {\r\n    CreateQuestionDto,\r\n    UpdateQuestionDto,\r\n    QuestionFiltersDto,\r\n    BulkUploadDto,\r\n} from './dto';\r\n\r\n@Controller('admin/questions')\r\n@UseGuards(JwtAuthGuard, RolesGuard)\r\n@Roles(UserRole.ADMIN)\r\nexport class QuestionBankController {\r\n    constructor(private questionBankService: QuestionBankService) { }\r\n\r\n    /**\r\n     * Create a new question\r\n     */\r\n    @Post()\r\n    async createQuestion(\r\n        @Body() dto: CreateQuestionDto,\r\n        @CurrentUser() user: any,\r\n    ) {\r\n        const question = await this.questionBankService.createQuestion(dto, user.sub);\r\n        return {\r\n            success: true,\r\n            message: 'Question created successfully',\r\n            data: question,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Bulk upload questions from CSV\r\n     */\r\n    @Post('bulk')\r\n    async bulkUpload(\r\n        @Body() dto: BulkUploadDto,\r\n        @CurrentUser() user: any,\r\n    ) {\r\n        const result = await this.questionBankService.bulkUpload(dto.QuestionBank, user.sub);\r\n        return {\r\n            success: true,\r\n            message: `Uploaded ${result.success} questions, ${result.failed} failed`,\r\n            data: result,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get questions with filters and pagination\r\n     */\r\n    @Get()\r\n    async getQuestions(@Query() filters: QuestionFiltersDto) {\r\n        const result = await this.questionBankService.getQuestions(filters);\r\n        return {\r\n            success: true,\r\n            data: result.questions,\r\n            pagination: result.pagination,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get question bank statistics\r\n     */\r\n    @Get('stats')\r\n    async getStats() {\r\n        const stats = await this.questionBankService.getStats();\r\n        return {\r\n            success: true,\r\n            data: stats,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get unique role types for dropdown\r\n     */\r\n    @Get('role-types')\r\n    async getRoleTypes() {\r\n        const roleTypes = await this.questionBankService.getRoleTypes();\r\n        return {\r\n            success: true,\r\n            data: roleTypes,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Get a single question by ID\r\n     */\r\n    @Get(':id')\r\n    async getQuestion(@Param('id') id: string) {\r\n        const question = await this.questionBankService.getQuestionById(id);\r\n        return {\r\n            success: true,\r\n            data: question,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Update a question\r\n     */\r\n    @Put(':id')\r\n    async updateQuestion(\r\n        @Param('id') id: string,\r\n        @Body() dto: UpdateQuestionDto,\r\n    ) {\r\n        const question = await this.questionBankService.updateQuestion(id, dto);\r\n        return {\r\n            success: true,\r\n            message: 'Question updated successfully',\r\n            data: question,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Delete a question (soft delete)\r\n     */\r\n    @Delete(':id')\r\n    async deleteQuestion(@Param('id') id: string) {\r\n        await this.questionBankService.deleteQuestion(id);\r\n        return {\r\n            success: true,\r\n            message: 'Question deleted successfully',\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Bulk delete all questions by role type\r\n     */\r\n    @Delete('bulk/role/:roleType')\r\n    async deleteByRole(@Param('roleType') roleType: string) {\r\n        const count = await this.questionBankService.deleteByRole(roleType);\r\n        return {\r\n            success: true,\r\n            message: `Deleted ${count} questions for role ${roleType}`,\r\n            data: { deletedCount: count },\r\n        };\r\n    }\r\n}\r\n"],"names":["QuestionBankController","createQuestion","dto","user","question","questionBankService","sub","success","message","data","bulkUpload","result","QuestionBank","failed","getQuestions","filters","questions","pagination","getStats","stats","getRoleTypes","roleTypes","getQuestion","id","getQuestionById","updateQuestion","deleteQuestion","deleteByRole","roleType","count","deletedCount","ADMIN"],"mappings":";;;;+BA2BaA;;;eAAAA;;;wBAjBN;8BACsB;4BACF;gCACL;2BACG;sCACG;qCACQ;qBAM7B;;;;;;;;;;;;;;;AAKA,IAAA,AAAMA,yBAAN,MAAMA;IAGT;;KAEC,GACD,MACMC,eACF,AAAQC,GAAsB,EAC9B,AAAeC,IAAS,EAC1B;QACE,MAAMC,WAAW,MAAM,IAAI,CAACC,mBAAmB,CAACJ,cAAc,CAACC,KAAKC,KAAKG,GAAG;QAC5E,OAAO;YACHC,SAAS;YACTC,SAAS;YACTC,MAAML;QACV;IACJ;IAEA;;KAEC,GACD,MACMM,WACF,AAAQR,GAAkB,EAC1B,AAAeC,IAAS,EAC1B;QACE,MAAMQ,SAAS,MAAM,IAAI,CAACN,mBAAmB,CAACK,UAAU,CAACR,IAAIU,YAAY,EAAET,KAAKG,GAAG;QACnF,OAAO;YACHC,SAAS;YACTC,SAAS,CAAC,SAAS,EAAEG,OAAOJ,OAAO,CAAC,YAAY,EAAEI,OAAOE,MAAM,CAAC,OAAO,CAAC;YACxEJ,MAAME;QACV;IACJ;IAEA;;KAEC,GACD,MACMG,aAAa,AAASC,OAA2B,EAAE;QACrD,MAAMJ,SAAS,MAAM,IAAI,CAACN,mBAAmB,CAACS,YAAY,CAACC;QAC3D,OAAO;YACHR,SAAS;YACTE,MAAME,OAAOK,SAAS;YACtBC,YAAYN,OAAOM,UAAU;QACjC;IACJ;IAEA;;KAEC,GACD,MACMC,WAAW;QACb,MAAMC,QAAQ,MAAM,IAAI,CAACd,mBAAmB,CAACa,QAAQ;QACrD,OAAO;YACHX,SAAS;YACTE,MAAMU;QACV;IACJ;IAEA;;KAEC,GACD,MACMC,eAAe;QACjB,MAAMC,YAAY,MAAM,IAAI,CAAChB,mBAAmB,CAACe,YAAY;QAC7D,OAAO;YACHb,SAAS;YACTE,MAAMY;QACV;IACJ;IAEA;;KAEC,GACD,MACMC,YAAY,AAAaC,EAAU,EAAE;QACvC,MAAMnB,WAAW,MAAM,IAAI,CAACC,mBAAmB,CAACmB,eAAe,CAACD;QAChE,OAAO;YACHhB,SAAS;YACTE,MAAML;QACV;IACJ;IAEA;;KAEC,GACD,MACMqB,eACF,AAAaF,EAAU,EACvB,AAAQrB,GAAsB,EAChC;QACE,MAAME,WAAW,MAAM,IAAI,CAACC,mBAAmB,CAACoB,cAAc,CAACF,IAAIrB;QACnE,OAAO;YACHK,SAAS;YACTC,SAAS;YACTC,MAAML;QACV;IACJ;IAEA;;KAEC,GACD,MACMsB,eAAe,AAAaH,EAAU,EAAE;QAC1C,MAAM,IAAI,CAAClB,mBAAmB,CAACqB,cAAc,CAACH;QAC9C,OAAO;YACHhB,SAAS;YACTC,SAAS;QACb;IACJ;IAEA;;KAEC,GACD,MACMmB,aAAa,AAAmBC,QAAgB,EAAE;QACpD,MAAMC,QAAQ,MAAM,IAAI,CAACxB,mBAAmB,CAACsB,YAAY,CAACC;QAC1D,OAAO;YACHrB,SAAS;YACTC,SAAS,CAAC,QAAQ,EAAEqB,MAAM,oBAAoB,EAAED,UAAU;YAC1DnB,MAAM;gBAAEqB,cAAcD;YAAM;QAChC;IACJ;IA1HA,YAAY,AAAQxB,mBAAwC,CAAE;aAA1CA,sBAAAA;IAA4C;AA2HpE;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;mDA7HgB0B"}