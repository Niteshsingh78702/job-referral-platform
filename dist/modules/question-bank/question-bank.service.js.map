{"version":3,"sources":["../../../src/modules/question-bank/question-bank.service.ts"],"sourcesContent":["import {\r\n  Injectable,\r\n  NotFoundException,\r\n  BadRequestException,\r\n} from '@nestjs/common';\r\nimport { PrismaService } from '../../prisma/prisma.service';\r\nimport * as crypto from 'crypto';\r\nimport {\r\n  CreateQuestionDto,\r\n  UpdateQuestionDto,\r\n  QuestionFiltersDto,\r\n  BulkQuestionDto,\r\n} from './dto';\r\n\r\n@Injectable()\r\nexport class QuestionBankService {\r\n  constructor(private prisma: PrismaService) {}\r\n\r\n  /**\r\n   * Create a single question\r\n   */\r\n  async createQuestion(dto: CreateQuestionDto, createdById: string) {\r\n    // Validate options count\r\n    if (dto.options.length !== 4) {\r\n      throw new BadRequestException('Questions must have exactly 4 options');\r\n    }\r\n\r\n    return this.prisma.questionBank.create({\r\n      data: {\r\n        id: crypto.randomUUID(),\r\n        question: dto.question,\r\n        options: dto.options,\r\n        correctAnswer: dto.correctAnswer,\r\n        explanation: dto.explanation,\r\n        difficulty: dto.difficulty,\r\n        category: dto.category,\r\n        tags: dto.tags,\r\n        roleType: dto.roleType,\r\n        createdById,\r\n      },\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Bulk upload questions (for CSV import)\r\n   */\r\n  async bulkUpload(questions: BulkQuestionDto[], createdById: string) {\r\n    const createdQuestions: any[] = [];\r\n    const errors: { row: number; error: string }[] = [];\r\n\r\n    for (let i = 0; i < questions.length; i++) {\r\n      const q = questions[i];\r\n      try {\r\n        const options = [q.optionA, q.optionB, q.optionC, q.optionD];\r\n        const tags = q.tags ? q.tags.split('|').map((t) => t.trim()) : [];\r\n\r\n        const created = await this.prisma.questionBank.create({\r\n          data: {\r\n            id: crypto.randomUUID(),\r\n            question: q.question,\r\n            options,\r\n            correctAnswer: q.correctAnswer,\r\n            explanation: q.explanation,\r\n            difficulty: q.difficulty as any,\r\n            category: q.category as any,\r\n            tags,\r\n            roleType: q.roleType,\r\n            createdById,\r\n            updatedAt: new Date(),\r\n          },\r\n        });\r\n        createdQuestions.push(created);\r\n      } catch (error) {\r\n        errors.push({ row: i + 1, error: error.message });\r\n      }\r\n    }\r\n\r\n    return {\r\n      success: createdQuestions.length,\r\n      failed: errors.length,\r\n      errors,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get questions with filters and pagination\r\n   * Uses efficient indexed queries for performance\r\n   */\r\n  async getQuestions(filters: QuestionFiltersDto) {\r\n    const {\r\n      page = 1,\r\n      limit = 20,\r\n      roleType,\r\n      difficulty,\r\n      category,\r\n      search,\r\n      tags,\r\n    } = filters;\r\n    const skip = (page - 1) * limit;\r\n\r\n    const where: any = {\r\n      isActive: true,\r\n    };\r\n\r\n    // Use indexed fields for filtering\r\n    if (roleType) where.roleType = roleType;\r\n    if (difficulty) where.difficulty = difficulty;\r\n    if (category) where.category = category;\r\n\r\n    // Search by question text\r\n    if (search) {\r\n      where.question = {\r\n        contains: search,\r\n        mode: 'insensitive',\r\n      };\r\n    }\r\n\r\n    // Filter by tags (any match)\r\n    if (tags && tags.length > 0) {\r\n      where.tags = {\r\n        hasSome: tags,\r\n      };\r\n    }\r\n\r\n    const [questions, total] = await Promise.all([\r\n      this.prisma.questionBank.findMany({\r\n        where,\r\n        skip,\r\n        take: limit,\r\n        orderBy: { createdAt: 'desc' },\r\n        select: {\r\n          id: true,\r\n          question: true,\r\n          options: true,\r\n          correctAnswer: true,\r\n          difficulty: true,\r\n          category: true,\r\n          tags: true,\r\n          roleType: true,\r\n          createdAt: true,\r\n          // Don't include explanation in list view for performance\r\n        },\r\n      }),\r\n      this.prisma.questionBank.count({ where }),\r\n    ]);\r\n\r\n    return {\r\n      questions,\r\n      pagination: {\r\n        page,\r\n        limit,\r\n        total,\r\n        totalPages: Math.ceil(total / limit),\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get a single question by ID\r\n   */\r\n  async getQuestionById(id: string) {\r\n    const question = await this.prisma.questionBank.findUnique({\r\n      where: { id },\r\n    });\r\n\r\n    if (!question) {\r\n      throw new NotFoundException('Question not found');\r\n    }\r\n\r\n    return question;\r\n  }\r\n\r\n  /**\r\n   * Update a question\r\n   */\r\n  async updateQuestion(id: string, dto: UpdateQuestionDto) {\r\n    await this.getQuestionById(id); // Verify exists\r\n\r\n    if (dto.options && dto.options.length !== 4) {\r\n      throw new BadRequestException('Questions must have exactly 4 options');\r\n    }\r\n\r\n    return this.prisma.questionBank.update({\r\n      where: { id },\r\n      data: dto as any,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Soft delete a question\r\n   */\r\n  async deleteQuestion(id: string) {\r\n    await this.getQuestionById(id); // Verify exists\r\n\r\n    return this.prisma.questionBank.update({\r\n      where: { id },\r\n      data: { isActive: false },\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get random questions for rapid fire test\r\n   * Uses efficient query to avoid loading all questions\r\n   */\r\n  async getRandomQuestions(params: {\r\n    count: number;\r\n    roleType?: string;\r\n    tags?: string[];\r\n    difficulty?: string;\r\n  }) {\r\n    const { count, roleType, tags, difficulty } = params;\r\n\r\n    const where: any = { isActive: true };\r\n    if (roleType) where.roleType = roleType;\r\n    if (difficulty) where.difficulty = difficulty;\r\n    if (tags && tags.length > 0) {\r\n      where.tags = { hasSome: tags };\r\n    }\r\n\r\n    // Get total count\r\n    const totalCount = await this.prisma.questionBank.count({ where });\r\n\r\n    if (totalCount === 0) {\r\n      return [];\r\n    }\r\n\r\n    // For large pools, use random skip strategy\r\n    // For small pools, fetch all and shuffle\r\n    if (totalCount > count * 2) {\r\n      // Random sampling for large pools\r\n      const questions: any[] = [];\r\n      const usedIds = new Set<string>();\r\n\r\n      while (questions.length < count && questions.length < totalCount) {\r\n        const skip = Math.floor(Math.random() * totalCount);\r\n        const [question] = await this.prisma.questionBank.findMany({\r\n          where,\r\n          skip,\r\n          take: 1,\r\n        });\r\n\r\n        if (question && !usedIds.has(question.id)) {\r\n          usedIds.add(question.id);\r\n          questions.push(question);\r\n        }\r\n      }\r\n\r\n      return questions;\r\n    } else {\r\n      // Fetch all and shuffle for small pools\r\n      const allQuestions = await this.prisma.questionBank.findMany({ where });\r\n      return this.shuffleArray(allQuestions).slice(0, count);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get statistics for admin dashboard\r\n   */\r\n  async getStats() {\r\n    const [total, byRole, byDifficulty, byCategory] = await Promise.all([\r\n      this.prisma.questionBank.count({ where: { isActive: true } }),\r\n      this.prisma.questionBank.groupBy({\r\n        by: ['roleType'],\r\n        where: { isActive: true },\r\n        _count: true,\r\n      }),\r\n      this.prisma.questionBank.groupBy({\r\n        by: ['difficulty'],\r\n        where: { isActive: true },\r\n        _count: true,\r\n      }),\r\n      this.prisma.questionBank.groupBy({\r\n        by: ['category'],\r\n        where: { isActive: true },\r\n        _count: true,\r\n      }),\r\n    ]);\r\n\r\n    return {\r\n      total,\r\n      byRole: byRole.map((r) => ({\r\n        roleType: r.roleType || 'Unassigned',\r\n        count: r._count,\r\n      })),\r\n      byDifficulty: byDifficulty.map((d) => ({\r\n        difficulty: d.difficulty,\r\n        count: d._count,\r\n      })),\r\n      byCategory: byCategory.map((c) => ({\r\n        category: c.category,\r\n        count: c._count,\r\n      })),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get unique role types for dropdown\r\n   */\r\n  async getRoleTypes() {\r\n    const roles = await this.prisma.questionBank.findMany({\r\n      where: { isActive: true, roleType: { not: null } },\r\n      select: { roleType: true },\r\n      distinct: ['roleType'],\r\n    });\r\n\r\n    return roles.map((r) => r.roleType).filter(Boolean);\r\n  }\r\n\r\n  /**\r\n   * Fisher-Yates shuffle algorithm\r\n   */\r\n  private shuffleArray<T>(array: T[]): T[] {\r\n    const shuffled = [...array];\r\n    for (let i = shuffled.length - 1; i > 0; i--) {\r\n      const j = Math.floor(Math.random() * (i + 1));\r\n      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\r\n    }\r\n    return shuffled;\r\n  }\r\n\r\n  /**\r\n   * Bulk delete all questions by role type\r\n   */\r\n  async deleteByRole(roleType: string): Promise<number> {\r\n    const result = await this.prisma.questionBank.deleteMany({\r\n      where: { roleType },\r\n    });\r\n    return result.count;\r\n  }\r\n}\r\n"],"names":["QuestionBankService","createQuestion","dto","createdById","options","length","BadRequestException","prisma","questionBank","create","data","id","crypto","randomUUID","question","correctAnswer","explanation","difficulty","category","tags","roleType","bulkUpload","questions","createdQuestions","errors","i","q","optionA","optionB","optionC","optionD","split","map","t","trim","created","updatedAt","Date","push","error","row","message","success","failed","getQuestions","filters","page","limit","search","skip","where","isActive","contains","mode","hasSome","total","Promise","all","findMany","take","orderBy","createdAt","select","count","pagination","totalPages","Math","ceil","getQuestionById","findUnique","NotFoundException","updateQuestion","update","deleteQuestion","getRandomQuestions","params","totalCount","usedIds","Set","floor","random","has","add","allQuestions","shuffleArray","slice","getStats","byRole","byDifficulty","byCategory","groupBy","by","_count","r","d","c","getRoleTypes","roles","not","distinct","filter","Boolean","array","shuffled","j","deleteByRole","result","deleteMany"],"mappings":"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"}