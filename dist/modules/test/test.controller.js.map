{"version":3,"sources":["../../../src/modules/test/test.controller.ts"],"sourcesContent":["import {\r\n    Controller,\r\n    Get,\r\n    Post,\r\n    Patch,\r\n    Body,\r\n    Param,\r\n} from '@nestjs/common';\r\nimport { TestService } from './test.service';\r\nimport { CreateTestDto, CreateRoleTestDto, UpdateTestDto, AddQuestionDto, SubmitAnswerDto, TestEventDto } from './dto';\r\nimport { CurrentUser, Roles } from '../../common/decorators';\r\nimport { UserRole } from '../../common/constants';\r\n\r\n@Controller('tests')\r\nexport class TestController {\r\n    constructor(private readonly testService: TestService) { }\r\n\r\n    // ===========================================\r\n    // ADMIN: Test Management\r\n    // ===========================================\r\n\r\n    @Post()\r\n    @Roles(UserRole.ADMIN)\r\n    async createTest(@Body() dto: CreateTestDto) {\r\n        return this.testService.createTest(dto);\r\n    }\r\n\r\n    @Post(':testId/questions')\r\n    @Roles(UserRole.ADMIN)\r\n    async addQuestion(\r\n        @Param('testId') testId: string,\r\n        @Body() dto: AddQuestionDto,\r\n    ) {\r\n        return this.testService.addQuestion(testId, dto);\r\n    }\r\n\r\n    @Get(':testId')\r\n    @Roles(UserRole.ADMIN)\r\n    async getTest(@Param('testId') testId: string) {\r\n        return this.testService.getTestById(testId);\r\n    }\r\n\r\n    // ===========================================\r\n    // ADMIN: Role-Based Test Management\r\n    // ===========================================\r\n\r\n    @Post('role-tests')\r\n    @Roles(UserRole.ADMIN)\r\n    async createRoleTest(@Body() dto: CreateRoleTestDto) {\r\n        return this.testService.createRoleTest(dto);\r\n    }\r\n\r\n    @Get('role-tests/all')\r\n    @Roles(UserRole.ADMIN)\r\n    async getAllRoleTests() {\r\n        return this.testService.getAllRoleTests();\r\n    }\r\n\r\n    @Get('role-tests/skill-bucket/:skillBucketId')\r\n    @Roles(UserRole.ADMIN)\r\n    async getTestBySkillBucket(@Param('skillBucketId') skillBucketId: string) {\r\n        return this.testService.getTestBySkillBucket(skillBucketId);\r\n    }\r\n\r\n    @Patch(':testId')\r\n    @Roles(UserRole.ADMIN)\r\n    async updateTest(\r\n        @Param('testId') testId: string,\r\n        @Body() dto: UpdateTestDto,\r\n    ) {\r\n        return this.testService.updateTest(testId, dto);\r\n    }\r\n\r\n    @Patch(':testId/activate')\r\n    @Roles(UserRole.ADMIN)\r\n    async activateTest(@Param('testId') testId: string) {\r\n        return this.testService.activateTest(testId);\r\n    }\r\n\r\n    @Patch(':testId/deactivate')\r\n    @Roles(UserRole.ADMIN)\r\n    async deactivateTest(@Param('testId') testId: string) {\r\n        return this.testService.deactivateTest(testId);\r\n    }\r\n\r\n    // ===========================================\r\n    // CANDIDATE: Test Eligibility\r\n    // ===========================================\r\n\r\n    @Get('eligibility/:jobId')\r\n    @Roles(UserRole.CANDIDATE)\r\n    async checkTestEligibility(\r\n        @Param('jobId') jobId: string,\r\n        @CurrentUser('sub') userId: string,\r\n    ) {\r\n        // Get candidate ID from user ID\r\n        const candidate = await this.testService['prisma'].candidate.findUnique({\r\n            where: { userId },\r\n        });\r\n        if (!candidate) {\r\n            return { eligible: false, reason: 'NO_PROFILE', message: 'Candidate profile not found' };\r\n        }\r\n        return this.testService.getTestEligibility(candidate.id, jobId);\r\n    }\r\n\r\n    // ===========================================\r\n    // CANDIDATE: Test Taking\r\n    // ===========================================\r\n\r\n    @Post('application/:applicationId/start')\r\n    @Roles(UserRole.CANDIDATE)\r\n    async startTest(\r\n        @Param('applicationId') applicationId: string,\r\n        @CurrentUser('sub') userId: string,\r\n    ) {\r\n        return this.testService.startTest(applicationId, userId);\r\n    }\r\n\r\n    @Get('session/:sessionId')\r\n    @Roles(UserRole.CANDIDATE)\r\n    async getSession(\r\n        @Param('sessionId') sessionId: string,\r\n        @CurrentUser('sub') userId: string,\r\n    ) {\r\n        return this.testService.getTestSession(sessionId, userId);\r\n    }\r\n\r\n    @Post('session/:sessionId/answer')\r\n    @Roles(UserRole.CANDIDATE)\r\n    async submitAnswer(\r\n        @Param('sessionId') sessionId: string,\r\n        @CurrentUser('sub') userId: string,\r\n        @Body() dto: SubmitAnswerDto,\r\n    ) {\r\n        return this.testService.submitAnswer(sessionId, userId, dto);\r\n    }\r\n\r\n    @Post('session/:sessionId/submit')\r\n    @Roles(UserRole.CANDIDATE)\r\n    async submitTest(\r\n        @Param('sessionId') sessionId: string,\r\n        @CurrentUser('sub') userId: string,\r\n    ) {\r\n        return this.testService.submitTest(sessionId, userId);\r\n    }\r\n\r\n    @Post('session/:sessionId/event')\r\n    @Roles(UserRole.CANDIDATE)\r\n    async logEvent(\r\n        @Param('sessionId') sessionId: string,\r\n        @CurrentUser('sub') userId: string,\r\n        @Body() dto: TestEventDto,\r\n    ) {\r\n        return this.testService.logTestEvent(sessionId, userId, dto);\r\n    }\r\n}\r\n"],"names":["TestController","createTest","dto","testService","addQuestion","testId","getTest","getTestById","createRoleTest","getAllRoleTests","getTestBySkillBucket","skillBucketId","updateTest","activateTest","deactivateTest","checkTestEligibility","jobId","userId","candidate","findUnique","where","eligible","reason","message","getTestEligibility","id","startTest","applicationId","getSession","sessionId","getTestSession","submitAnswer","submitTest","logEvent","logTestEvent","ADMIN","CANDIDATE"],"mappings":"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"}